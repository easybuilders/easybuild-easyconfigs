easyblock = 'ConfigureMake'

name = 'vowpal_wabbit'
version = '8.5.0'

homepage = 'https://github.com/JohnLangford/vowpal_wabbit'
description = """Vowpal Wabbit is a machine learning system which pushes the frontier of
 machine learning with techniques such as online, hashing, allreduce,
 reductions, learning2search, active, and interactive learning."""

toolchain = {'name': 'foss', 'version': '2017b'}

sources = ['%(version)s.tar.gz']
source_urls = ['https://github.com/JohnLangford/vowpal_wabbit/archive/']
checksums = ['f90167312b0e12e85331e4fdd790268eab508c2a59764ae164bacc7cd6149732']

builddependencies = [
    ('Autotools', '20170619'),
]

dependencies = [
    ('Boost', '1.66.0'),
    ('zlib', '1.2.11'),
]

# Beware: The Makefile in the source was _not_ generated by autotools, but is
# a hand-rolled alternative, which doesn't work for us (hard-coded install
# paths, etc.).  Also, there's an autogen.sh script that also doesn't work.
# Ignore both of them.
preconfigopts = 'autoreconf -fvi && '

configopts = '--with-boost=$EBROOTBOOST --with-zlib=$EBROOTZLIB'

# At the moment, a couple of these fail.  Guessing not meaningful.
# runtest = 'test'

sanity_check_paths = {
    'files': ['lib/libvw.%s' % SHLIB_EXT, 'lib/libvw.a'],
    'dirs': ['include/vowpalwabbit']
}

moduleclass = 'math'
