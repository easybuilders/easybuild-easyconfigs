easyblock = 'PythonBundle'

name = 'jax-triton'
version = '0.1.1'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://pypi.org/project/jax-triton'
description = """The jax-triton repository contains integrations between JAX and Triton."""

toolchain = {'name': 'foss', 'version': '2024a'}

dependencies = [
    ('Python', '3.12.3'),
    ('CUDA', '12.6.0', '', SYSTEM),
    ('jax', '0.4.35', versionsuffix),
    ('Triton', '3.1.0', versionsuffix),
]

use_pip = True

_preinstallopts = 'sed -i "s/^requires-python/#&/g" pyproject.toml &&'

exts_list = [
    (name, version, {
        'modulename': 'jax_triton',
        'patches': ['jax-triton-0.1.1_ignore_missing_torch.patch'],
        'preinstallopts': _preinstallopts,
        'checksums': [
            {'jax-triton-0.1.1.tar.gz': '1d3406e81bf8a2268a4d7688a8ab7e2c10893c5939f5ba56c1d706fa4c377fa0'},
            {'jax-triton-0.1.1_ignore_missing_torch.patch':
             '22ddca25d2b1c2e80685367b0b8aea97328f9bbca96f7444574034eafa03f154'},
        ],
    }),
]

sanity_pip_check = True

sanity_check_paths = {
    'files': [],
    'dirs': ['lib'],
}

moduleclass = 'ai'
