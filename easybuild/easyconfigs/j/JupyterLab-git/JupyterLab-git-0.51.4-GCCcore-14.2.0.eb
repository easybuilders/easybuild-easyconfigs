# Author: Ehsan Moravveji (VSC - KU Leuven)

easyblock = 'PythonBundle'

name = 'JupyterLab-git'
version = '0.51.4'

homepage = 'https://github.com/jupyterlab/jupyterlab-git'
description = """A JupyterLab extension for version control using Git"""

toolchain = {'name': 'GCCcore', 'version': '14.2.0'}

builddependencies = [
    ('binutils', '2.42.'),
    ('hatchling', '1.27.0'),
    ('hatch-jupyter-builder', '0.9.1'),
    ('nodejs', '22.16.0'),
]

dependencies = [
    ('Python', '3.13.1'),
    ('Python-bundle-PyPI', '2025.04'),
    ('IPython', '9.3.0'),
    ('jupyter-server', '2.16.0'),
    ('JupyterLab', '4.4.4'),
    ('GitPython', '3.1.45'),
]

exts_list = [
    ('jupyter-server-mathjax', '0.2.6', {
        'modulename': 'jupyter_server_mathjax',
        'source_tmpl': 'jupyter_server_mathjax-%(version)s.tar.gz',
        'checksums': ['bb1e6b6dc0686c1fe386a22b5886163db548893a99c2810c36399e9c4ca23943'],
    }),
    ('nbdime', '4.0.4', {
        'checksums': ['8cd25ecfeeb5105d563237d7f64eb4748058fba9bba9ab3892a1ff61e177ce16'],
    }),
    ('jupyterlab-git', version, {
        'modulename': 'jupyterlab_git',
        'source_tmpl': 'jupyterlab_git-%(version)s.tar.gz',
        'checksums': ['fc5a9d53a7034da12df8e33f1f40864e5fcbf001eeb78948de30fea47579bfcc'],
    }),
]

# 'jlpm' installation is needed as specified in:
# https://github.com/jupyterlab/jupyterlab-git/blob/main/pyproject.toml#L86
postinstallcmds = [
    'jlpm install',
    'jlpm build:prod',
]

local_json_dir = 'etc/jupyter/jupyter_server_config.d'
sanity_check_paths = {
    'files': [f'{local_json_dir}/{x}.json' for x in ['jupyterlab_git', 'jupyter_server_mathjax', 'nbdime']],
    'dirs': [
        'share/jupyter/labextensions/@jupyterlab/git',
        'share/jupyter/nbextensions',
        'etc/jupyter/jupyter_notebook_config.d'
    ],
}

modextrapaths = {
    'JUPYTER_PATH': 'share/jupyter',
    # For this specific extension, another environment variable is needed to expose the tool
    'JUPYTER_CONFIG_PATH': 'etc/jupyter',
}

moduleclass = 'tools'
