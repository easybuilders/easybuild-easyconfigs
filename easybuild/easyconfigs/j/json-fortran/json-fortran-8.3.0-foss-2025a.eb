easyblock = 'CMakeMake'

name = 'json-fortran'
version = '8.3.0'

homepage = 'https://github.com/jacobwilliams/json-fortran'
description = "JSON-Fortran: A Modern Fortran JSON API"

toolchain = {'name': 'foss', 'version': '2025a'}

source_urls = ['https://github.com/jacobwilliams/json-fortran/archive/']
sources = ['%(version)s.tar.gz']

builddependencies = [
    ('CMake', '3.31.3-GCCcore-14.2.0', '', True),
]

# Important: Set proper installation directories
configopts = ' '.join([
    '-DUSE_GNU_INSTALL_CONVENTION=TRUE',
    '-DCMAKE_INSTALL_LIBDIR=lib',
    '-DCMAKE_INSTALL_INCLUDEDIR=include',
    '-DCMAKE_INSTALL_PREFIX=%(installdir)s',
])

runtest = 'check'

sanity_check_paths = {
    'files': [
        'lib/libjsonfortran.a',
        'lib/libjsonfortran.%s' % SHLIB_EXT,
        'include/json_module.mod',
        'include/json_parameters.mod',
        'include/json_kinds.mod',
        'include/json_string_utilities.mod',
    ],
    'dirs': ['include', 'lib'],
}

sanity_check_commands = [
    'test -f %(installdir)s/include/json_module.mod',
]

moduleclass = 'lib'