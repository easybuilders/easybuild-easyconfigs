# This file is an EasyBuild reciPY as per https://easybuilders.github.io/easybuild/
# Author: Pablo Escobar Lopez
# sciCORE - University of Basel
# SIB Swiss Institute of Bioinformatics
# Updated by: Dugan Witherick, University of Warwick
#             Robert Mijakovic <robert.mijakovic@lxp.lu>
#             Wahid Mainassara <wahid.mainassara@lxp.lu>
#             Paul Melis <paul.melis@surf.nl>

easyblock = 'Tarball'

name = 'Julia'
version = '1.11.3'
versionsuffix = '-linux-x86_64'

homepage = 'https://julialang.org'
description = "Julia is a high-level, high-performance dynamic programming language for numerical computing"

toolchain = SYSTEM

source_urls = ['https://julialang-s3.julialang.org/bin/linux/x64/%(version_major_minor)s/']
sources = ['%(namelower)s-%(version)s%(versionsuffix)s.tar.gz']
checksums = [
    {'julia-1.11.3-linux-x86_64.tar.gz': '7d48da416c8cb45582a1285d60127ee31ef7092ded3ec594a9f2cf58431c07fd'},
]

builddependencies = [
    ('imkl', '2023.2.0', '', SYSTEM),
]

keepsymlinks = True

postinstallcmds = [
    'setrpaths.sh --path %(installdir)s',
    # so that the Pardiso Julia package can find MKL
    'patchelf --add-rpath "$MKLROOT/lib/intel64" %(installdir)s/lib/%(namelower)s/libjulia-internal.so.%(version_major_minor)s',
]

# : means the default path, this way extension modules can append to it
modluafooter = """
append_path("JULIA_DEPOT_PATH", ":")
"""

sanity_check_paths = {
    'files': ['bin/julia', 'include/julia/julia.h', 'lib/libjulia.%s' % SHLIB_EXT],
    'dirs': ['bin', 'etc', 'include', 'lib', 'lib/julia', 'share']
}
sanity_check_commands = ['julia --help']

moduleclass = 'lang'
