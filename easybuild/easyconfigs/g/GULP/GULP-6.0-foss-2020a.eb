# Contribution from the NIHR Biomedical Research Centre
# Guy's and St Thomas' NHS Foundation Trust and King's College London
# Based on GULP-5.1-intel-2019a.eb
# patch for mkgulp to change hard-coded paths included
# uploaded by J. Sassmannshausen

easyblock = 'MakeCp'

name = 'GULP'
version = '6.0'

homepage = 'https://gulp.curtin.edu.au/gulp/'
description = """GULP is a program for performing a variety of types of simulation on materials
 using boundary conditions of 0-D (molecules and clusters), 1-D (polymers), 2-D (surfaces, slabs
 and grain boundaries), or 3-D (periodic solids)Band Unfolding code for Plane-wave based calculations"""

toolchain = {'name': 'foss', 'version': '2020a'}
toolchainopts = {'openmp': True}

# download requires registration, https://gulp.curtin.edu.au/gulp/request.cfm?rel=download
sources = [SOURCELOWER_TGZ]
patches = ['gulp-6.0-fftw-blas-linking-gcc-9.3.patch']
checksums = [
    'b63cff96300356728ee641e7bac8f065a01f108a2289711c3d3d11d4050527f6',  # gulp-6.0.tgz
    '1ee6ebf5ea61998f714d943c7a19eebc8c0c72929fc42671ad4a7335368e4715',  # gulp-6.0-fftw-blas-linking-gcc-9.3.patch
]

start_dir = 'Src'

build_cmd = "./mkgulp -f -m -c gfortran"

files_to_copy = [
    (['gulp'], 'bin'),
    (['../Docs', '../Examples', '../Libraries', '../Utils'], ''),
]

sanity_check_paths = {
    'files': ['bin/gulp'],
    'dirs': ['Docs', 'Examples', 'Libraries', 'Utils'],
}

modextrapaths = {
    'GULP_LIB': 'Libraries',
    'GULP_DOC': 'Docs',
    'GULP_EXAMPLES': 'Examples',
    'GULP_UTILS': 'Utils',
}

moduleclass = 'chem'
