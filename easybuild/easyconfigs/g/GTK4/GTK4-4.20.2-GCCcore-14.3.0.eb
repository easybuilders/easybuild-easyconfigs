easyblock = 'Bundle'

name = 'GTK4'
version = '4.20.2'

homepage = 'https://docs.gtk.org/gtk4/'
description = """GTK+ is the primary library used to construct user interfaces in GNOME. It
 provides all the user interface controls, or widgets, used in a common
 graphical application. Its object-oriented API allows you to construct
 user interfaces without dealing with the low-level details of drawing and
 device interaction.
"""

toolchain = {'name': 'GCCcore', 'version': '14.3.0'}

builddependencies = [
    ('binutils', '2.44'),
    ('GObject-Introspection', '1.84.0'),
    ('gettext', '0.25'),
    ('pkgconf', '2.4.3'),
    ('cairo', '1.18.4'),
    ('Perl', '5.40.2'),
    ('Meson', '1.8.2'),
    ('Ninja', '1.13.0'),
    ('shared-mime-info', '2.4'),
]

dependencies = [
    ('ATK', '2.38.0'),
    ('at-spi2-atk', '2.38.0'),
    ('Gdk-Pixbuf', '2.42.12'),
    ('Pango', '1.57.0'),
    ('libepoxy', '1.5.10'),
    ('X11', '20250608'),
    ('FriBidi', '1.0.16'),
    ('GST-plugins-bad', '1.26.6'),
    ('Wayland', '1.24.0'),
    ('PyGObject', '3.54.3'),
    ('fontconfig', '2.17.0'),
    ('librsvg', '2.61.0'),
    ('libcroco', '0.6.13'),
]

default_easyblock = 'MesonNinja'

default_component_specs = {
    'sources': [SOURCELOWER_TAR_XZ],
    'start_dir': '%(namelower)s-%(version)s',
}

components = [
    ('GTK', version, {
        'source_urls': [FTPGNOME_SOURCE],
        'patches': ['GTK4-4.21.0_conditionally-disable-dma-buf-test.patch'],
        'preconfigopts': "sed -i 's/dma-buf.h/udmabuf.h/' ../%(namelower)s-%(version)s/meson.build &&",
        'configopts': "-Dintrospection=enabled -Dvulkan=disabled",
        'checksums': ['5e8240edecafaff2b8baf4663bdceaa668ef10a207bee4d7f90e010e10bddc5c',
                      '7918b49cf72682d7673a728be5707ab7ea1159b7df7666e18733b4bc9e458fd5']
    }),
    ('hicolor-icon-theme', '0.18', {
        'source_urls': ['https://icon-theme.freedesktop.org/releases/'],
        'checksums': ['db0e50a80aa3bf64bb45cbca5cf9f75efd9348cf2ac690b907435238c3cf81d7']
    }),
    ('adwaita-icon-theme', '49.0', {
        'source_urls': ['https://download.gnome.org/sources/adwaita-icon-theme/%(version_major)s'],
        'checksums': ['65166461d1b278aa942f59aa8d0fccf1108d71c65f372c6266e172449791755c']
    }),
]

postinstallcmds = ['gtk4-update-icon-cache']

sanity_check_paths = {
    'files': ['bin/%s' % x for x in ['gtk4-demo', 'gtk4-demo-application', 'gtk4-widget-factory',
                                     'gtk4-builder-tool', 'gtk4-launch', 'gtk4-query-settings',
                                     'gtk4-update-icon-cache', 'gtk4-widget-factory']] +
             ['lib/libgtk-4.%s' % SHLIB_EXT],
    'dirs': ['include/%s-%%(version_major)s.0/%s' % ('gtk', x) for x in ['gdk', 'gsk', 'gtk']] +
            ['share/icons/hicolor', 'share/icons/Adwaita'],
}


moduleclass = 'vis'
