From 3428819a282c17c80627095c7081635450b33de7 Mon Sep 17 00:00:00 2001
From: Ask Hjorth Larsen <asklarsen@gmail.com>
Date: Fri, 11 Jan 2019 18:35:28 +0000
Subject: [PATCH 2/2] fix same bug also in regular tpss

---
 c/xc/tpss.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/c/xc/tpss.c b/c/xc/tpss.c
index d98e2c7..dc7f0df 100644
--- a/c/xc/tpss.c
+++ b/c/xc/tpss.c
@@ -427,12 +427,11 @@ static void c_tpss_12(XC(func_type) *aux1, XC(func_type) *aux2, int nspin, const
   int nder = (nspin==XC_UNPOLARIZED) ? 1 : 3;
   for(i=0; i<nder; i++){
     if(nspin==XC_UNPOLARIZED) dauxdsigma[i] /= 2.;
-    double dCdsigma[i];
-    dCdsigma[i]=  dCdcsi*dcsidsigma[i];
+    double dCdsigma = dCdcsi*dcsidsigma[i];
 
     /* partial derivatives*/
-    de_PKZBdsigma[i] = de_PBEdsigma[i] * (1.0 + C * zsq) + dens * e_PBE * dCdsigma[i] * zsq
-      - zsq * (dens * dCdsigma[i] * aux + (1.0 + C) * dauxdsigma[i]);
+    de_PKZBdsigma[i] = de_PBEdsigma[i] * (1.0 + C * zsq) + dens * e_PBE * dCdsigma * zsq
+      - zsq * (dens * dCdsigma * aux + (1.0 + C) * dauxdsigma[i]);
 
   }
 }
-- 
1.8.3.1

