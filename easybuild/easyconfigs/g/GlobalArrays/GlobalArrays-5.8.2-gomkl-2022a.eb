easyblock = 'ConfigureMake'

name = 'GlobalArrays'
version = '5.8.2'

homepage = 'https://hpc.pnl.gov/globalarrays'
description = "Global Arrays (GA) is a Partitioned Global Address Space (PGAS) programming model"

toolchain = {'name': 'gomkl', 'version': '2022a'}
toolchainopts = {'usempi': True}

source_urls = ['https://github.com/GlobalArrays/ga/releases/download/']
sources = ['v%(version)s/ga-%(version)s.tar.gz']
checksums = ['51599e4abfe36f05cecfaffa33be19efbe9e9fa42d035fd3f866469b663c22a2']

builddependencies = [('Perl', '5.34.1', '-minimal')]

configopts = ' --with-mpi --enable-i8 '
configopts += '--with-blas8="-L$MLROOT/lib/intel64 -Wl,--no-as-needed -lmkl_gf_ilp64 -lmkl_sequential '
configopts += '-lmkl_core -lpthread -lm -ldl" '
configopts += '--with-scalapack8="L$MKLROOT/lib/intel64 -Wl,--no-as-needed -lmkl_scalapack_ilp64 -lmkl_gf_ilp64 '
configopts += '-lmkl_sequential -lmkl_core -lmkl_blacs_openmpi_ilp64 -lmkl_gnu_thread -lpthread -lm -ldl "'

# select armci network as (Comex) MPI-1 two-sided
configopts += ' --with-mpi-ts'

runtest = 'check'

sanity_check_paths = {
    'files': ['bin/adjust.x', 'bin/collisions.x', 'bin/ga-config', 'lib/libarmci.a',
              'lib/libcomex.a', 'lib/libga.a'],
    'dirs': ['include'],
}

moduleclass = 'lib'
