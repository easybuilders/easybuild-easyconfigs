# Contribution from Imperial College London, UK
# uploaded by J. Sassmannshausen

easyblock = 'Bundle'

name = 'GCAM'
version = '5.4'
versionsuffix = '-Java-%(javaver)s'

homepage = 'https://github.com/JGCRI/gcam-core'
description = """GCAM is a dynamic-recursive model with technology-rich representations 
of the economy, energy sector, land use and water linked to a climate model that can be 
used to explore climate change mitigation policies including carbon taxes, carbon trading, 
regulations and accelerated deployment of energy technology. Regional population and labor 
productivity growth assumptions drive the energy and land-use systems employing numerous 
technology options to produce, transform, and provide energy services as well as to produce 
agriculture and forest products, and to determine land use and land cover. Using a run period 
extending from 1990 – 2100 at 5 year intervals, GCAM has been used to explore the potential 
role of emerging energy supply technologies and the greenhouse gas consequences of specific 
policy measures or energy technology adoption including; CO2 capture and storage, bioenergy, 
hydrogen systems, nuclear energy, renewable energy technology, and energy use technology in 
buildings, industry and the transportation sectors. GCAM is an Representative Concentration 
Pathway (RCP)-class model. This means it can be used to simulate scenarios, policies, and emission 
targets from various sources including the Intergovernmental Panel on Climate Change (IPCC). 
Output includes projections of future energy supply and demand and the resulting greenhouse 
gas emissions, radiative forcing and climate effects of 16 greenhouse gases, aerosols and 
short-lived species at 0.5×0.5 degree resolution, contingent on assumptions about future 
population, economy, technology, and climate mitigation policy."""

toolchain = {'name': 'GCC', 'version': '11.2.0'}
toolchainopts = {'openmp': True}

# We install the Java jar-files as a component so we don't need a specific EC file for that.
# This means, we also install GCAM as a component. 
components = [
    ('GCAM-model-interfaces', '5.1', {
        'easyblock': 'CmdCp',
        'source_urls': ['https://github.com/JGCRI/modelinterface/releases/download'],
        'sources': ['v5.1/jars.zip'],
        'checksums': ['734b75cc5843c8fc1eaa84152964886ac35cdac12d1976b1fc3cfc2db0275ae3'],
        'skipsteps': ['configure', 'build'],
        'install_cmd': 'unzip jars.zip',
        'files_to_copy': [
            (['jars/*'], 'jars'),
        ],
        'sanity_check_paths': {
            'files': ['jars/BaseX-8.6.7.jar'],
            'dirs': []
        }}),

    (name, version, {
        'easyblock': 'MakeCp',
        'source_urls': ['https://github.com/JGCRI/gcam-core/archive'],
        'sources': ['%(namelower)s-v%(version)s.tar.gz'],
        'patches': ['GCAM-5.4-environment.patch'],
        'checksums': [
            '0194714cf30b96de1a202c9204b3079a40eee123f2dc1600fa57825c61e8d8f9',  # gcam-v5.4.tar.gz
            '45f335ceff780237cfad5527422f4367f791fe0e2898a989f80abc129ca61efd',  # GCAM-5.4-environment.patch
        ],
        'start_dir': 'gcam-core-%(namelower)s-v%(version)s',
        'prebuildopts': 'cd cvs/objects/build/linux && ',
        'files_to_copy': [
            (['exe/gcam.exe'], 'bin'),
            'input', 'output', 'exe'
        ]}),
]

builddependencies = [
    ('Eigen', '3.4.0'),
    ('Zip', '3.0'),
    ('binutils', '2.37'),
]

dependencies = [
    ('Boost', '1.79.0'),
    ('imkl', '2021.4.0', '', True),
    ('hector', '2.5.0'),
    ('tbb', '2021.4.0'),
    ('Java', '17', '', True),
    ('Xerces-C++', '3.2.3'),
    ('Java', '17', '', True),
]

sanity_check_paths = {
    'files': ['bin/gcam.exe'],
    'dirs': [],
}

sanity_check_commands = ["gcam.exe --version"]

moduleclass = 'tools'
