# High Energy Physics (HEP) Python bundle
# This bundle is based on scikit_hep-2024.8.1
# The limiting factor is the PyTorch version, which is determining the toolchain etc.
# Author: J. Sassmannshausen (Imperial College London/UK)

easyblock = 'PythonBundle'

name = 'Scikit-HEP'
version = '2024.8.1'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://python.org/'
description = "Bundle of Python packages for HEP, based on Scikit-HEP meta package"

toolchain = {'name': 'foss', 'version': '2023a'}
toolchainopts = {'pic': True}

builddependencies = [
    ('UnZip', '6.0'),
    ('pkgconf', '1.9.5'),
    ('hatchling', '1.18.0'),
    ('poetry', '1.5.1'),
    ('scikit-build', '0.17.6'),
    ('scikit-build-core', '0.5.0'),
    ('flit', '3.9.0'),
    ('maturin', '1.1.0'),  # required for awkward-cpp
    ('pybind11', '2.11.1'),
    ('Ninja', '1.11.1'),  # needed by awkward-cpp-35
]

dependencies = [
    ('CUDA', '12.1.1', '', SYSTEM),
    ('Python', '3.11.3'),
    ('SciPy-bundle', '2023.07'),
    ('cryptography', '41.0.1'),
    ('virtualenv', '20.23.1'),
    ('PyYAML', '6.0'),
    ('tqdm', '4.66.1'),  # required for openai-whisper, peft, hepstats
    ('Graphviz', '8.1.0'),
    ('matplotlib', '3.7.2'),
    ('PyTorch', '2.1.2', versionsuffix),
    ('numba', '0.58.1'),  # required for openai-whisper
    ('tiktoken', '0.7.0'),  # required for openai-whisper, plu
    ('Triton', '2.1.0', versionsuffix),  # required for openai-whisper
    ('Transformers', '4.39.3'),  # required for peft, accelerate, plu
    ('whisper-ctranslate2', '0.5.2', versionsuffix),
    ('aiohttp', '3.8.5'),
    ('HF-Datasets', '2.18.0'),  # required for plu
    ('fastparquet', '2024.11.0'),
    ('libsndfile', '1.2.2'),
    ('Safetensors', '0.4.3'),  # required for peft, accelerate
    ('graphviz-python', '0.20.1'),
]

# order is important!
# package versions taken from scikit_hep-2024.8.1
exts_list = [
    ('awkward-cpp', '35', {
        'sources': ['awkward-cpp-%(version)s.tar.gz'],
        'checksums': ['1f8b112a597bd2438794e1a721a63aa61869fa9598a17ac6bd811ad6f6400d06'],
    }),
    ('awkward', '2.6.6', {
        'checksums': ['6eeb426ca41b51fe3c36fbe767b90259979b08c14e3562497a71195a447c8b3c'],
    }),
    ('boost_histogram', '1.4.1', {
        'checksums': ['97146f735f467d506976a047f3f237ce59840a952fd231f5f431f897fb006cdd'],
    }),
    ('uhi', '0.4.0', {
        'checksums': ['0dcb6b19775087d38a31ee388cb2c70f2ecfe04c4ffe2ca63223410cae5beefa'],
    }),
    ('histoprint', '2.4.0', {
        'checksums': ['328f789d186e3bd76882d57b5aad3fa08c7870a856cc83bcdbad9f4aefbda94d'],
    }),
    ('asdf-standard', '1.1.1', {
        'sources': ['asdf_standard-%(version)s.tar.gz'],
        'checksums': ['01535bc2b15bfc09ec8a62d4999f9cf32dc49dc71660c8425640228fd8776102'],
    }),
    ('asdf-transform-schemas', '0.5.0', {
        'sources': ['asdf_transform_schemas-%(version)s.tar.gz'],
        'checksums': ['82cf4c782575734a895327f25ff583ce9499d7e2b836fe8880b2d7961c6b462b'],
    }),
    ('asdf-unit-schemas', '0.2.0', {
        'sources': ['asdf_unit_schemas-%(version)s.tar.gz'],
        'checksums': ['d995c45b5531ef1fe2e0525db30c7fc8b36df9447116ee067ce4461eea7e4440'],
    }),
    ('jmespath', '1.0.1', {
        'checksums': ['90261b206d6defd58fdd5e85f478bf633a2901798906be2ad389150c5c60edbe'],
    }),
    ('asdf', '3.1.0', {
        'checksums': ['c4907ae3242b59a2d0e363dc5fd8337d5f82d4c01b1908be1d1e305cdff04639'],
    }),
    ('hepstats', '0.8.1', {
        'checksums': ['ebb890496d7aebbf1d717de15d073be31d6775065308a4e0f263ed4051992b3f'],
    }),
    ('hepunits', '2.3.4', {
        'checksums': ['a842b886a67ba0563a347155277cfdc8fb670208233661bcbab9f28a9df8cd60'],
    }),
    ('lark', '1.2.2', {
        'source_urls': ['https://github.com/lark-parser/lark/archive/'],
        'sources': ['%(version)s.tar.gz'],
        'checksums': ['472a686b2cf8034938e9fd5df98afd09ae8781e837bfd74abb18d161cc504a82'],
    }),
    ('accelerate', '1.3.0', {
        'checksums': ['518631c0adb80bd3d42fb29e7e2dc2256bcd7c786b0ba9119bbaa08611b36d9c'],
    }),
    ('openai-whisper', '20240930', {
        'modulename': 'whisper',
        'checksums': ['b7178e9c1615576807a300024f4daa6353f7e1a815dac5e38c33f1ef055dd2d2'],
    }),
    ('peft', '0.10.0', {
        'checksums': ['36a7628c15f88d37abb26cfc74c22468f9037ee02e9c9b65de943cfe7c672049'],
    }),
    ('soundfile', '0.12.1', {
        'patches': ['soundfile-0.12.1.patch'],
        'checksums': [
            {'soundfile-0.12.1.tar.gz': 'e8e1017b2cf1dda767aef19d2fd9ee5ebe07e050d430f77a0a7c66ba08b8cdae'},
            {'soundfile-0.12.1.patch': 'fb1f14cf7b40cee698520896f0acd2aa8091af7be1777669263787817035ea76'},
        ],
    }),
    ('plu', '0.1.18', {
        'checksums': ['c2f03582db2f4030e459325f233c5133e2f067b91c7e3e15e36e55d900d93200'],
    }),
    ('particle', '0.25.0', {
        'checksums': ['8e2d5fa36555e6af218b66e97b9585b1d4f52085785d96c067736f0b2e57f5ad'],
    }),
    ('plumbum', '1.8.2', {
        'checksums': ['9e6dc032f4af952665f32f3206567bc23b7858b1413611afe603a3f8ad9bfd75'],
    }),
    ('decaylanguage', '0.18.3', {
        'checksums': ['aabfa66bf0a89a48aae911bfc68153e2bb3380d4cb331f7120e19de6a1b9cd06'],
    }),
    ('iminuit', '2.28.0', {
        'checksums': ['6646ae0b66a4760e02cd73711d460a6cf2375382b78ce8344141751595596aad'],
    }),
    ('mplhep-data', '0.0.4', {
        'sources': ['mplhep_data-%(version)s.tar.gz'],
        'checksums': ['cd1f3ad3af9dbff33aef9e7406d2130d624a0bd1d5aa5970fc713a6421165a4e'],
    }),
    ('mplhep', '0.3.50', {
        'checksums': ['c4775975f4e229b0c6bbaa182224ddf0ffe7a47da4523cfbb3c03df820493740'],
    }),
    ('pylhe', '0.8.0', {
        'checksums': ['cbae891b8cbbef977c2d80797e37a5d81dd70d0cc97baa694403c60e840113d6'],
    }),
    ('resample', '1.10.0', {
        'checksums': ['4bb4780340b83cc9097b2ba2f5d5b81a52dd1bbd40689ad80dd0437addb40b22'],
    }),
    ('uproot', '5.3.13', {
        'checksums': ['4af7cd874e7c1cd0703f17de70b52c9f2492cf0bca27d962c4a3f2755bb89fa9'],
    }),
    ('vector', '1.4.3', {
        'checksums': ['eb0d9472f4b0907a0cf603e98a0e8b90f0ac05593f7b4d10268daa25aa38cbd9'],
    }),
    ('hist', '2.7.3', {
        'checksums': ['f9f9b56809b190bb546698789cc0d7d040934fc5141d2763c6e49d65e81dbc0b'],
    }),
    (name, version, {
        'modulename': 'skhep',
        'sources': ['scikit_hep-%(version)s.tar.gz'],
        'checksums': ['157307b4f5c133c3c7c096df949d4add1f4bbe2598df95cf4e39ded93ee58a66'],
    }),
]

moduleclass = 'lang'
