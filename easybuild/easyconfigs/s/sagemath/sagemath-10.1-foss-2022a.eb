easyblock = 'PythonBundle'

name = 'sagemath'
version = '10.1'

homepage = 'https://www.sagemath.org/'
description = """SageMath is a free open-source mathematics software system licensed under the GPL. It builds on
 top of many existing open-source packages: NumPy, SciPy, matplotlib, Sympy, Maxima, GAP, FLINT, R and many more.
 Access their combined power through a common, Python-based language or directly via interfaces or wrappers.

 This installation method is based on https://github.com/sagemath/sage#alternative-installation-using-pypi
 but providing the mandatory dependencies via eb instead of building the wheels via sage_conf.
"""

toolchain = {'name': 'foss', 'version': '2022a'}

builddependencies = [
    ('CMake', '3.24.3'),
]

dependencies = [
    ('SYMMETRICA', '2.0'),
    ('Arb', '2.23.0'),
    ('Boost', '1.79.0'),
    ('BRiAl', '1.2.12'),
    ('ECL', '23.9.9'),
    ('GSL', '2.7'),
    ('JupyterLab', '3.5.0'),
    ('LinBox', '1.7.0'),
    ('MPFI', '1.5.4'),
    ('PARI-GP', '2.15.4'),
    ('Python', '3.10.4'),
    ('SciPy-bundle', '2022.05'),
    ('SuiteSparse', '5.13.0', '-METIS-5.1.0'),
    ('cliquer', '1.21'),
    ('eclib', '20230424'),
    ('fpylll', '0.5.9'),
    ('gap', '4.12.2'),
    ('giac', '1.9.0-69'),
    ('lcalc', '2.0.5'),
    ('lrcalc', '2.1'),
    ('libbraiding', '1.2'),
    ('libgd', '2.3.3'),
    ('libhomfly', '1.02r6'),
    ('libpng', '1.6.37'),
    ('matplotlib', '3.5.2'),
    ('m4rie', '20200125'),
    ('networkx', '2.8.4'),
    ('pkgconfig', '1.5.5', '-python'),
    ('planarity', '3.0.2.0'),
    ('pplpy', '0.8.9'),
    ('poetry', '1.2.2'),
    ('primecountpy', '0.1.0'),
    ('rankwidth', '0.9'),
    ('sympy', '1.11.1'),
]

use_pip = True
sanity_pip_check = True

exts_list = [
    ('cypari2', '2.1.3', {
        'checksums': ['17beb467d3cb39fffec3227c468f0dd8db8a09129faeb95a6bb4c84b2b6c6683'],
    }),
    ('memory-allocator', '0.1.3', {
        'source_tmpl': 'memory_allocator-%(version)s.tar.gz',
        'checksums': ['13805c2ae1c01b7489fab5e8eac9361662b4f2c02412e3652eece48ff6953162'],
    }),
    ('importlib-metadata', '4.13.0', {
        'modulename': 'importlib_metadata',
        'source_tmpl': 'importlib_metadata-%(version)s.tar.gz',
        'checksums': ['dd0173e8f150d6815e098fd354f6414b0f079af4644ddfe90c71e2fc6174346d'],
    }),
    ('packaging', '23.2', {
        'checksums': ['048fb0e9405036518eaaf48a55953c750c11e1a1b68e0dd1a9d62ed0c092cfc5'],
    }),
    ('Sphinx', '5.2.0', {
        'checksums': ['1790c2098937dcfa7871c9d102c24eccd4a8b883b67c5c1e26892fb52d102542'],
    }),
    ('typing-extensions', '4.4.0', {
        'modulename': 'typing_extensions',
        'source_tmpl': 'typing_extensions-%(version)s.tar.gz',
        'checksums': ['1511434bb92bf8dd198c12b1cc812e800d4181cfcb867674e0f8279cc93087aa'],
    }),
    ('ptyprocess', '0.5.1', {
        'checksums': ['0530ce63a9295bfae7bd06edc02b6aa935619f486f0f1dc0972f516265ee81a6'],
    }),
    ('sage-setup', version, {
        'checksums': ['9b9d66072adeb930b4d9dc134a7822aa54cc45a41d1011a52bf1a44154dc6507'],
    }),
    ('sage-conf', version, {
        'modulename': False,
        'checksums': ['23a38c8c4979895a5e35d96e547d2f7fc414eedc8dc7d2f38bc269ce5b6c2dd3'],
    }),
    ('sagemath-standard', version, {
        'modulename': 'sage',
        'patches': ['sagemath-10.1_ecl.patch'],
        'checksums': [
            {'sagemath-standard-10.1.tar.gz': '4edbace8880b7ff3aa63bd5381ead0400820a68a929f43c68e93a4f28ee13c52'},
            {'sagemath-10.1_ecl.patch': '3535b1cf9ed6f375c66a6f2273e16a92c0ac6a9a2371684b79039a2530cdb1ab'},
        ],
    }),
]

sanity_check_paths = {
    'files': ['bin/sage%s' % x for x in ['', '-config', '-env', '-eval', '-ipython', '-list-packages', '-notebook']],
    'dirs': ['lib/python%(pyshortver)s/site-packages/', 'share/jupyter/kernels/sagemath'],
}

sanity_check_commands = [
    "sage --help",
    "sage-list-packages --installed-only all",
    "python -c 'from sage.all import *'",
]

modextrapaths = {'SAGE_ROOT': '', 'SAGE_LOCAL': ''}

moduleclass = 'math'
