# This file is an EasyBuild reciPY as per https://easybuilders.github.io/easybuild/
# Author: Pablo Escobar Lopez
# sciCORE - University of Basel
# SIB Swiss Institute of Bioinformatics

easyblock = 'PythonPackage'

name = 'SignalP'
version = '6.0h'
_suffix = 'fast'
versionsuffix = '-CUDA-%(cudaver)s-' + _suffix

homepage = 'https://services.healthtech.dtu.dk/software.php'
description = """SignalP predicts the presence  and  location of signal peptide  cleavage sites
in  amino acid  sequences  from  different organisms"""

toolchain = {'name': 'foss', 'version': '2023a'}

download_instructions = """
SignalP requires registration and acceptance of licence terms (academic use only).
 [1] go to: https://services.healthtech.dtu.dk/service.php?SignalP-6.0
 [2] navigate to the "Downloads" tab
 [3] select "%s" type under version "%%(version)s"
 [4] complete the form; you should receive a download link via email
""" % _suffix

sources = ['%%(namelower)s-%%(version)s.%s.tar.gz' % _suffix]
checksums = ['4afe3c004e23a1d6518cefb23448b4d5ede5f1c5b276db541f839f0615822125']

unpack_options = '--strip-components=1'

dependencies = [
    ('CUDA', '12.1.1', '', SYSTEM),
    ('Python', '3.11.3'),
    ('SciPy-bundle', '2023.07'),
    ('tqdm', '4.66.1'),
    ('PyTorch', '2.1.2', '-CUDA-%(cudaver)s'),
    ('matplotlib', '3.7.2'),
]

preinstallopts = "sed -i 's/torch.*/torch/g' requirements.txt && "

use_pip = True
download_dep_fail = True
sanity_pip_check = True

_bin = '%%(namelower)s%s' % version[0]
sanity_check_paths = {
    'files': ['bin/%s' % _bin],
    'dirs': ['lib/python%(pyshortver)s/site-packages/%(namelower)s'],
}

sanity_check_commands = ['%s --help' % _bin]

moduleclass = 'bio'
