# #
# This is a contribution from HPCNow! (http://hpcnow.com)
# Copyright::   HPCNow!
# Authors::     Leah Han <leah.han@hpcnow.com>
# License::     GPL-v3.0
# #

easyblock = 'MakeCp'

name = 'femtic'
version = '4.2'

homepage = 'https://github.com/yoshiya-usui/femtic'
description = """FEMTIC is a 3-D magnetotelluric inversion code based on the following studies,
enabling us to incorporate topography and bathymetry into an inversion model.
FEMTIC was made with C++. FEMTIC is applicable to land magnetotelluric survey data as well as
ocean bottom magnetotelluric survey data.
"""

toolchain = {'name': 'intel', 'version': '2023a'}

source_urls = ['https://github.com/yoshiya-usui/femtic/archive/refs/tags']
sources = ['v%(version)s.tar.gz']
checksums = ['afd79715ca4ac9f00d406bd7f44f8f9499a337fca2e2210de4678691e0b3eeb2']

prebuildopts = 'cd src && cp Makefile_IntelMPI Makefile_IntelMPI.orig && '
prebuildopts += r"sed -i '/^INTEL_DIR.*/c\INTEL_DIR=$(EBROOTINTEL)' Makefile_IntelMPI  && "

build_cmd = 'make -f Makefile_IntelMPI'

files_to_copy = [(['src/femtic'], 'bin')]

sanity_check_paths = {
    'files': ['bin/femtic'],
    'dirs': [],
}

moduleclass = 'geo'
