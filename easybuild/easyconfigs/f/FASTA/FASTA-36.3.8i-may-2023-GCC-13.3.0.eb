# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild

easyblock = 'MakeCp'

name = "FASTA"
# versioning of fasta:
# check releases of fasta here https://fasta.bioch.virginia.edu/wrpearson/fasta/fasta36/
# Latest changes to 36.3.8i, that had an official release were in may 2023
# There have not been new tag since november 22 so should go with `local_commit` instead of `local_version_date`
version = "36.3.8i-may-2023"
local_commit = "71b8993"

homepage = 'https://fasta.bioch.virginia.edu/fasta_www2/fasta_list2.shtml'
description = """The FASTA programs find regions of local or global (new) similarity between
protein or DNA sequences, either by searching Protein or DNA databases, or by identifying
local duplications within a sequence."""

toolchain = {'name': 'GCC', 'version': '13.3.0'}

source_urls = ['https://github.com/wrpearson/fasta36/archive/']
sources = ['%s.tar.gz' % local_commit]
checksums = ['49148e1b45285a89a7a76a1354ee57fa747e32468cd460831ca6d2a28cc33861']

buildopts = '-C ./src -f ../make/Makefile.linux_sse2 all'

files_to_copy = ["bin", "conf", "data", "doc", "FASTA_LIST", "misc", "README", "seq", "sql", "test"]

postinstallcmds = ["cd %(installdir)s/bin && ln -s fasta%(version_major)s fasta"]

sanity_check_paths = {
    'files': ["FASTA_LIST", "README"] + ['bin/%s' % x for x in ['map_db']] +
             ['bin/%s%%(version_major)s' % x for x in ['fasta', 'fastm', 'fastx', 'ggsearch', 'lalign', 'tfastf',
                                                       'tfasts', 'tfasty', 'fastf', 'fasts', 'fasty', 'glsearch',
                                                       'ssearch', 'tfastm', 'tfastx']],
    'dirs': ["conf", "data", "doc", "misc", "seq", "sql", "test"]
}

sanity_check_commands = ["fasta --help"]

moduleclass = 'bio'
