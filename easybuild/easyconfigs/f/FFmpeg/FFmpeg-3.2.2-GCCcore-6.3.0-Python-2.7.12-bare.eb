easyblock = 'ConfigureMake'

name = 'FFmpeg'
version = '3.2.2'
pyver = '2.7.12'
pyshortver = '2.7'
pysubver = '-bare'
versionsuffix = '-Python-%s%s' % (pyver, pysubver)

homepage = 'https://www.ffmpeg.org/'

description = """
 A complete, cross-platform solution to record, convert and stream
 audio and video.
"""

toolchain = {'name': 'GCCcore', 'version': '6.3.0'}

sources = [SOURCELOWER_TAR_BZ2]
source_urls = ['http://ffmpeg.org/releases/']

builddependencies = [
    ('X11', '20161215', versionsuffix),
]

dependencies = [
    ('bzip2', '1.0.6'),
    ('NASM', '2.12.02'),
    ('x264', '20161215'),
]

osdependencies = [
    ('binutils'),
    ('zlib-devel'),
]

configopts = """\
    --cc="$CC"\
    --cxx="$CXX"\
    --enable-gpl\
    --enable-libx264\
    --enable-nonfree\
    --enable-pic\
    --enable-shared\
    --enable-version3\
"""

sanity_check_paths = {
    'dirs': ['bin', 'include', 'lib'],
    'files': ['bin/ff%s' % x for x in ['mpeg', 'probe', 'server']] +
             ['lib/lib%s.%s' % (x, y) for x in
              ['avdevice', 'avfilter', 'avformat', 'avcodec', 'postproc',
               'swresample', 'swscale', 'avutil'] for y in [SHLIB_EXT, 'a']],
}

moduleclass = 'vis'
