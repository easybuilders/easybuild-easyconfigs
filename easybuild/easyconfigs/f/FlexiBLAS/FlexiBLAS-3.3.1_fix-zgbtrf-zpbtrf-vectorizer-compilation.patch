# make some work matrices allocatable to bypass errors generated by -ftree-vectorize with gcc 13.2 on zen4/zen5
# author: Bart Oldeman (Digital Research Alliance of Canada)
# author: Ariel Lozano (ULB)
diff -ur flexiblas-3.3.1_orig/contributed/lapack-3.11.0/SRC/zgbtrf.f flexiblas-3.3.1/contributed/lapack-3.11.0/SRC/zgbtrf.f
--- flexiblas-3.3.1_orig/contributed/lapack-3.11.0/SRC/zgbtrf.f	2023-04-03 16:07:31.000000000 +0200
+++ flexiblas-3.3.1/contributed/lapack-3.11.0/SRC/zgbtrf.f	2025-09-25 00:58:22.137011421 +0200
@@ -169,8 +169,8 @@
       COMPLEX*16         TEMP
 *     ..
 *     .. Local Arrays ..
-      COMPLEX*16         WORK13( LDWORK, NBMAX ),
-     $                   WORK31( LDWORK, NBMAX )
+      COMPLEX*16, ALLOCATABLE :: WORK13( :, : ),
+     $                   WORK31( :, : )
 *     ..
 *     .. External Functions ..
       INTEGER            ILAENV, IZAMAX
@@ -232,6 +232,8 @@
 *
 *        Use blocked code
 *
+         ALLOCATE(WORK13(LDWORK, NBMAX), WORK31(LDWORK, NBMAX))
+*
 *        Zero the superdiagonal elements of the work array WORK13
 *
          DO 20 J = 1, NB
diff -ur flexiblas-3.3.1_orig/contributed/lapack-3.11.0/SRC/zpbtrf.f flexiblas-3.3.1/contributed/lapack-3.11.0/SRC/zpbtrf.f
--- flexiblas-3.3.1_orig/contributed/lapack-3.11.0/SRC/zpbtrf.f	2023-04-03 16:07:31.000000000 +0200
+++ flexiblas-3.3.1/contributed/lapack-3.11.0/SRC/zpbtrf.f	2025-09-25 00:58:34.090950545 +0200
@@ -166,7 +166,7 @@
       INTEGER            I, I2, I3, IB, II, J, JJ, NB
 *     ..
 *     .. Local Arrays ..
-      COMPLEX*16         WORK( LDWORK, NBMAX )
+      COMPLEX*16, ALLOCATABLE :: WORK( :, : )
 *     ..
 *     .. External Functions ..
       LOGICAL            LSAME
@@ -221,6 +221,8 @@
       ELSE
 *
 *        Use blocked code
+
+         ALLOCATE(WORK( LDWORK, NBMAX ))
 *
          IF( LSAME( UPLO, 'U' ) ) THEN
 *
