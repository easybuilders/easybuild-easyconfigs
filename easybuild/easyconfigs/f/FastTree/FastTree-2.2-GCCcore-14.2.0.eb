# Updated from previous config
# Author: Pavel Grochal (INUITS)
# License: GPLv2

easyblock = 'CmdCp'

name = 'FastTree'
version = '2.2'

homepage = 'https://morgannprice.github.io/fasttree/'
description = """FastTree infers approximately-maximum-likelihood phylogenetic trees from alignments of nucleotide
 or protein sequences. FastTree can handle alignments with up to a million of sequences in a reasonable amount of
 time and memory. """

toolchain = {'name': 'GCCcore', 'version': '14.2.0'}
toolchainopts = {'openmp': True}

source_urls = ['https://morgannprice.github.io/fasttree/']
# Hack to cope with non-compressed C source code file
sources = [{
    'filename': '%(name)s-%(version)s.c',
    'download_filename': 'FastTree.c',
    'extract_cmd': 'cp %s FastTree.c',
}]
checksums = ['975202a6b74c9996af871404ff043bb2152edcbda539035662514bc12d1f3431']

builddependencies = [('binutils', '2.42')]

cmds_map = [('%(name)s-%(version)s.c', '$CC -DOPENMP $CFLAGS $LIBS %%(source)s -o %(name)s')]

files_to_copy = [(['FastTree'], 'bin')]

# as FastTree is built with OpenMP, the correct binary is FastTreeMP
# the FastTree binary should normally be built without OpenMP, but letâ€™s keep it as is for backward compatibility
# see http://www.microbesonline.org/fasttree/#OpenMP
postinstallcmds = ['cd %(installdir)s/bin && ln -s FastTree FastTreeMP']

sanity_check_paths = {
    'files': ['bin/FastTree'],
    'dirs': [],
}

sanity_check_commands = ['FastTree 2>&1 | grep "FastTree Version %(version)s"']

moduleclass = 'bio'
