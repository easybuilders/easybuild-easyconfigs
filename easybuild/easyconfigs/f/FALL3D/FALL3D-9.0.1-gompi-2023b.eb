easyblock = 'CMakeMakeCp'
name = 'FALL3D'
version = '9.0.1'

homepage = 'https://gitlab.com/fall3d-suite/fall3d'
description = "FALL3D is an open-source volcanic ash dispersal model."

toolchain = {'name': 'gompi', 'version': '2023b'}
# This option configures -O3
toolchainopts = {'opt': True}

source_urls = ['https://gitlab.com/fall3d-suite/fall3d/-/archive/master/']
sources = ['fall3d-master.tar.gz']

builddependencies = [('CMake', '3.27.6')]
dependencies = [('netCDF-Fortran', '4.6.1')]

# When using -DDETAIL_BIN, the executable name will depend on the compiler and options
# configopts = "-DDETAIL_BIN=YES -DWITH-MPI=YES"
# local_executable = "Fall3d.GNU.r8.mpi.cpu.x"

configopts = "-DWITH-MPI=YES"
local_executable = "Fall3d.x"

files_to_copy = [(['bin/%s' % local_executable], 'bin')]

sanity_check_paths = {
    'files': ['bin/%s' % local_executable],
    'dirs': []
}
sanity_check_commands = [
    "%s -v" % local_executable
]

