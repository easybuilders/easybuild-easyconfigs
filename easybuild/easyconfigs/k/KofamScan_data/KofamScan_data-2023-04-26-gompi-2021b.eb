easyblock = 'Binary'

name = 'KofamScan_data'
version = '2023-04-26'

homepage = 'https://www.genome.jp/tools/kofamkoala/'
description = """KofamKOALA assigns K numbers to the user's sequence data by 
HMMER/HMMSEARCH against KOfam (a customized HMM database of KEGG Orthologs 
(KOs)).  K number assignments with scores above the predefined thresholds 
for individual KOs are more reliable than other proposed assignments.  Such 
high score assignments are highlighted with asterisks '*' in the output.  
The K number assignments facilitate the interpretation of the annotation 
results by linking the user's sequence data to the KEGG pathways and EC 
numbers.  [data only]."""
# software_license = 'MIT'

toolchain = {'name': 'gompi', 'version': '2021b'}

source_urls = [
    'https://www.genome.jp/ftp/db/kofam/archives/%(version)s',  # prefer the archive url present after new releases
    'https://www.genome.jp/ftp/db/kofam/',
]
sources = [
    {'download_filename': 'ko_list.gz', 'filename': 'ko_list_%(version)s.gz' },
    {'download_filename': 'profiles.tar.gz', 'filename': 'profiles_%(version)s.tar.gz' },
]
checksums = [
    '099a62576b1754f31d3182e54d8ea310b61a2cacd3f6b3d5762be51ab0c711dd',  # ko_list.gz
    'e017ead8fd52677d0a20558b9fd504876558e1723e77ec6be79aa72e6dee90a2',  # profiles.tar.gz
]

dependencies = [
    ('KofamScan',  '1.3.0'),  # hard coded latest program version
]

extract_sources = False

install_cmd = 'mkdir -p %(installdir)s/db/ && '
install_cmd += 'tar xfz profiles_%(version)s.tar.gz --directory %(installdir)s/db/ && '
install_cmd += 'gzip -dc ko_list_%(version)s.gz > %(installdir)s/db/ko_list && '
install_cmd += 'rm -f profiles_%(version)s.tar.gz && '
install_cmd += 'rm -f ko_list_%(version)s.gz && '
install_cmd += 'rm -rf $EBROOTKOFAMSCAN/db && '
install_cmd += 'ln -s %(installdir)s/db $EBROOTKOFAMSCAN/db'

sanity_check_paths = {
    'files': ['db/profiles/eukaryote.hal', 'db/profiles/prokaryote.hal', 'db/ko_list'],
    'dirs': [],
}

moduleclass = 'bio'
