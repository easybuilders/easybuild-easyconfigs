easyblock = 'PythonBundle'

name = 'whisper'
version = '1.0'
versionsuffix = '-CUDA-%(cudaver)s'
local_commit = '9f70a35'

homepage = 'https://github.com/openai/whisper'
description = """
Whisper is a general-purpose speech recognition model. It is trained on a large dataset of diverse audio and is also a multi-task model that can perform multilingual speech recognition as well as speech translation and language identification."""

toolchain = {'name': 'foss', 'version': '2021a'}

dependencies = [
    ('CUDA', '11.3.1', '', SYSTEM),
    ('tqdm', '4.61.2'),
    ('Rust', '1.60.0'),
    ('PyTorch', '1.11.0', versionsuffix),
    ('Python', '3.9.5'),
]

use_pip = True

exts_list = [
    ('regex', '2022.10.31', {
        'checksums': ['a3a98921da9a1bf8457aeee6a551948a83601689e5ecdd736894ea9bbec77e83'],
    }),
    ('certifi', '2022.9.24', {
        'checksums': ['0d9c601124e5a6ba9712dbc60d9c53c21e34f5f641fe83002317394311bdce14'],
    }),
    ('charset-normalizer', '2.1.1', {
        'checksums': ['5a3d016c7c547f69d6f81fb0db9449ce888b418b5b9952cc5e6e66843e9dd845'],
    }),
    ('ffmpeg-python', '0.2.0', {
        'modulename': 'ffmpeg',
        'checksums': ['65225db34627c578ef0e11c8b1eb528bb35e024752f6f10b78c011f6f64c4127'],
    }),
    ('filelock', '3.8.0', {
        'checksums': ['55447caa666f2198c5b6b13a26d2084d26fa5b115c00d065664b2124680c4edc'],
    }),
    ('idna', '3.4', {
        'checksums': ['814f528e8dead7d329833b91c5faa87d60bf71824cd12a7530b5526063d02cb4'],
    }),
    ('more-itertools', '9.0.0', {
        'checksums': ['5a6257e40878ef0520b1803990e3e22303a41b5714006c32a3fd8304b26ea1ab'],
    }),
    ('packaging', '20.9', {
        'checksums': ['5b327ac1320dc863dca72f4514ecc086f31186744b84a230374cc1fd776feae5'],
    }),
    ('pyparsing', '3.0.9', {
        'checksums': ['2b020ecf7d21b687f219b71ecad3631f644a47f01403fa1d1036b0c6416d70fb'],
    }),
    ('requests', '2.28.1', {
        'checksums': ['7c5599b102feddaa661c826c56ab4fee28bfd17f5abca1ebbe3e7f19d7c97983'],
    }),
    ('tokenizers', '0.13.1', {
        'checksums': ['3333d1cee5c8f47c96362ea0abc1f81c77c9b92c6c3d11cbf1d01985f0d5cf1d'],
    }),
    ('urllib3', '1.26.12', {
        'checksums': ['3fa96cf423e6987997fc326ae8df396db2a8b7c667747d47ddd8ecba91f4a74e'],
    }),
    ('huggingface-hub', '0.10.1', {
        'source_tmpl': 'huggingface_hub-%(version)s.tar.gz',
        'checksums': ['5c188d5b16bec4b78449f8681f9975ff9d321c16046cc29bcf0d7e464ff29276'],
    }),
    ('transformers', '4.24.0', {
        'checksums': ['486f353a8e594002e48be0e2aba723d96eda839e63bfe274702a4b5eda85559b'],
    }),
    (name, version, {
        'sources': [{'filename': '%(name)s-%(version)s.tar.gz', 'git_config': {'url': 'https://github.com/openai', 'repo_name': 'whisper', 'commit': '9f70a35', 'recursive': True}}],
        'checksums': [None],
    }),
]

sanity_pip_check = True

sanity_check_commands = ["python -c 'import whisper'"]

moduleclass = 'lang'
