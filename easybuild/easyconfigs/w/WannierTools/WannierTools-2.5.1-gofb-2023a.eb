easyblock = 'ConfigureMake'

name = 'WannierTools'
version = '2.5.1'

homepage = 'http://www.wanniertools.com'
description = """WannierTools is an open source software that studies the physical properties of given tight-binding
 model."""

toolchain = {'name': 'gofb', 'version': '2023a'}
toolchainopts = {'usempi': True}

source_urls = ['https://github.com/quanshengwu/wannier_tools/archive']
sources = ['V%(version)s.tar.gz']
patches = ['WannierTools-2.5.1_fix_Makefile.gfortran.patch']
checksums = [
    {'V2.5.1.tar.gz': '22aad8e95f2da07ac2dd892c2ca0438010779e6cc542e30f34ea5c3f580fd72c'},
    {'WannierTools-2.5.1_fix_Makefile.gfortran.patch':
     'cc8390acea5933aec2462d356e0f6d5508800d52ae64b985618d7df6b06de2d7'},
]

dependencies = [
    ('arpack-ng', '3.9.1'),
]

skipsteps = ['configure']

prebuildopts = 'cd src && '
preinstallopts = prebuildopts

# use -cpp -fallow-argument-mismatch -ffree-line-length-512 for GNU based compilers
# use -fpp for Intel based compilers
# We use the same Makefile regardless of toolchain due to the Makefile patch
buildopts = '-f Makefile.gfortran-mpi '
installopts = '-f Makefile.gfortran-mpi PREFIX=%(installdir)s '

# No dependecies in the Makefile
parallel = 1

sanity_check_paths = {
    'files': ['bin/wt.x'],
    'dirs': []
}

moduleclass = 'chem'
