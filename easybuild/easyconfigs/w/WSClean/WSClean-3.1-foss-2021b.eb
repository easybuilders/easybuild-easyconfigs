# Contribution from Imperial College London
# uploaded by J. Sassmannshausen

easyblock = 'CMakeMake'

name = 'WSClean'
version = '3.1'

homepage = 'https://wsclean.readthedocs.io'
description = """WSClean stands for “w-stacking clean”. W-stacking is an alternative 
to the w-projection algorithm, in which the uv-samples are not convolved with a w-term 
correcting kernel before the FFT, but are instead corrected with a multiplication after 
the FFT. Multiplying each pixel is generally much faster than convolving an image, but 
the downside is that samples can not be added together on one grid until the w-term 
has been corrected. This means that in w-stacking, each w-layer needs to be stored 
and FFT-ed individually. The result is that w-stacking requires more memory and spends 
relative more time doing the FFTs, instead of gridding+convolving."""

toolchain = {'name': 'foss', 'version': '2021b'}

source_urls = ['https://gitlab.com/aroffringa/wsclean/-/package_files/33647495/']
sources = [{'download_filename': 'download', 'filename': '%(namelower)s-v%(version)s.tar.bz2'}]

checksums = [
    'ecc58bdff1aa428c17c9915e6d8fddd5aa397cb5f0848f224f3e7932aa15fce0',  # wsclean-v3.1.tar.bz2
]

builddependencies = [
    ('binutils', '2.37'),
    ('CMake', '3.22.1'),
    ('pkg-config', '0.29.2'),
]

dependencies = [
    ('CFITSIO', '3.49'),
    ('casacore', '3.4.0'),
    ('GSL', '2.7'),
    ('IDG', '1.0.0'),
    ('EveryBeam', '0.3.1')
]

configopts = ' -Wno-dev '

sanity_check_paths = {
    'files': [('bin/chgcentre', 'bin/wsclean', 'bin/wsclean-mp'), ('lib/libwsclean.a')],
    'dirs': ['include'],
}

moduleclass = 'lib'
