easyblock = 'Bundle'

name = 'MAJIQ'
commit = '8a2d1b577726'
version = '1.1.0'
versionsuffix = '-Python-%(pyver)s'

homepage = 'https://majiq.biociphers.org'
description = """MAJIQ and Voila are two software packages that together detect, quantify, and visualize
 local splicing variations (LSV) from RNA-Seq data."""

toolchain = {'name': 'intel', 'version': '2018a'}
toolchainopts = {'pic': True}

builddependencies = [
    # older version of Cython required to work around "AttributeError: ... has no attribute '__reduce_cython__'
    # see https://github.com/cython/cython/issues/1953
    ('Cython', '0.25.2', versionsuffix),
]
dependencies = [
    ('Python', '3.6.4'),
    ('Pysam', '0.14', versionsuffix),
    ('matplotlib', '2.1.2', versionsuffix),
    ('h5py', '2.7.1', versionsuffix),
]


exts_defaultclass = 'PythonPackage'

exts_list = [
    # need numpy installed with pip because MAJIQ is installed with pip -e
    # see https://github.com/numpy/numpy/issues/6551
    ('numpy', '1.14.2', {
        'source_tmpl': 'numpy-%(version)s.zip',
        'source_urls': ['https://pypi.python.org/packages/source/n/numpy/'],
        'checksums': ['facc6f925c3099ac01a1f03758100772560a0b020fb9d70f210404be08006bcb'],
        'patches': ['numpy-1.12.0-mkl.patch'],
        'use_pip': True,
    }),
    ('Jinja2', '2.10', {
        'source_urls': ['https://pypi.python.org/packages/source/J/Jinja2/'],
        'checksums': ['f84be1bb0040caca4cea721fcbbbbd61f9be9464ca236387158b0feea01914a4'],
    }),
    ('MarkupSafe', '1.0', {
        'source_urls': ['https://pypi.python.org/packages/source/M/MarkupSafe/'],
        'checksums': ['a6be69091dac236ea9c6bc7d012beab42010fa914c459791d627dad4910eb665'],
    }),
    ('psutil', '5.4.3', {
        'source_urls': ['https://pypi.python.org/packages/source/p/psutil/'],
        'checksums': ['e2467e9312c2fa191687b89ff4bc2ad8843be4af6fb4dc95a7cc5f7d7a327b18'],
    }),
    ('quicksect', '0.1.0', {
        'source_urls': ['https://pypi.python.org/packages/source/q/quicksect/'],
        'checksums': ['c236f629e76ba6d6d3585b9583b34590e555965698aa3b44c9ff762dd4fb8f63'],
    }),
    ('SQLAlchemy', '1.2.5', {
        'source_urls': ['https://pypi.python.org/packages/source/S/SQLAlchemy/'],
        'checksums': ['249000654107a420a40200f1e0b555a79dfd4eff235b2ff60bc77714bd045f2d'],
    }),
    (name, version, {
        'source_tmpl': '8a2d1b577726.tar.gz',
        'source_urls': ['https://bitbucket.org/biociphers/majiq_stable/get/'],
        'checksums': ['442580354f13bd4679fc17e0db573d2f887a06e7f8588b38a9a4ab36be11b675'],
        'use_pip_editable': True,
        'unpack_options': "&& mv *majiq_stable* majiq",
    }),
]

sanity_check_paths = {
    'files': [],
    'dirs': ['lib/python%(pyshortver)s/site-packages'],
}

moduleclass = 'bio'
