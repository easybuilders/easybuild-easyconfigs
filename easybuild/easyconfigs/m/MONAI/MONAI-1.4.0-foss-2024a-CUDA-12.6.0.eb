easyblock = 'PythonBundle'

name = 'MONAI'
version = '1.4.0'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://monai.io/'
description = """
MONAI is a PyTorch-based, open-source framework for deep learning in healthcare
imaging, part of PyTorch Ecosystem.
"""

toolchain = {'name': 'foss', 'version': '2024a'}

github_account = 'Project-MONAI'

local_pip_extras = "einops,fire,gdown,ignite,scipy,tqdm,itk,jsonschema,lmdb,nibabel,pydicom,ninja,h5py,optuna,pyamg,"
local_pip_extras += "openslide,pandas,pillow,psutil,pyyaml,skimage,tensorboard,torchvision,huggingface_hub,"
local_pip_extras += "transformers,mlflow,clearml,matplotlib,tensorboardX,tifffile,imagecodecs,onnx,zarr,lpips,pynrrd"

builddependencies = [
    ('hatchling', '1.24.2'),
    ('Ninja', '1.12.1'),
]

dependencies = [
    ('CUDA', '12.6.0', '', SYSTEM),
    ('Python', '3.12.3'),
    ('SciPy-bundle', '2024.05'),
    ('PyTorch', '2.6.0', versionsuffix),
    ('einops', '0.8.1'),
    ('BeautifulSoup', '4.12.3'),
    ('tqdm', '4.66.5'),
    ('ITK', '5.4.4'),
    ('pydicom', '3.0.1'),
    ('NiBabel', '5.3.2'),
    ('openslide-python', '1.4.2'),
    ('Pillow', '10.4.0'),
    ('PyYAML', '6.0.2'),
    ('scikit-image', '0.25.0'),
    ('tensorboard', '2.18.0'),
    ('torchvision', '0.21.0', versionsuffix),
    ('Transformers', '4.55.0'),
    ('MLflow', '2.22.4'),
    ('matplotlib', '3.9.2'),
    ('clearml', '2.0.2'),
    ('tensorboardX', '2.6.4'),
    ('imagecodecs', '2024.12.30'),
    ('h5py', '3.12.1'),
    ('Optuna', '4.1.0'),
    ('ONNX', '1.20.0'),
    ('zarr', '2.18.4'),
    ('PyAMG', '5.3.0'),
]

exts_list = [
    ('nptyping', '2.5.0', {
        'checksums': ['e3d35b53af967e6fb407c3016ff9abae954d3a0568f7cc13a461084224e8e20a'],
    }),
    ('pynrrd', '1.1.3', {
        'modulename': 'nrrd',
        'checksums': ['a331263bc9f05c3168182e61d6098e256a34e0fadbb7427a1d086d8942fbcbe0'],
    }),
    ('lpips', '0.1.4', {
        'checksums': ['3846331df6c69688aec3d300a5eeef6c529435bc8460bd58201c3d62e56188fa'],
    }),
    ('typeguard', '4.4.2', {
        'preinstallopts': "sed -i '/^license/d' pyproject.toml && ",
        'checksums': ['a6f1065813e32ef365bc3b3f503af8a96f9dd4e0033a02c28c4a4983de8c6c49'],
    }),
    ('huggingface-hub', '0.36.0', {
        'sources': ['huggingface_hub-%(version)s.tar.gz'],
        'checksums': ['47b3f0e2539c39bf5cde015d63b72ec49baff67b6931c3d97f3f84532e2b8d25'],
    }),
    ('lmdb', '1.7.5', {
        'checksums': ['f0604751762cb097059d5412444c4057b95f386c7ed958363cf63f453e5108da'],
    }),
    ('pytorch-ignite', '0.5.3', {
        'modulename': 'ignite',
        'preinstallopts': "sed -i '/^license/d' pyproject.toml && ",
        'checksums': ['75c645f02fea66cc80c1998ade3f8402e0e6b6d73f3f4ad727c171f6e93874f4'],
    }),
    ('gdown', '5.2.0', {
        'checksums': ['2145165062d85520a3cd98b356c9ed522c5e7984d408535409fd46f94defc787'],
    }),
    ('termcolor', '3.2.0', {
        'preinstallopts': (
            """sed -i '/"Programming Language :: Python :: 3.15",/d' pyproject.toml && """
            """sed -i '/^license/d' pyproject.toml && """
        ),
        'checksums': ['610e6456feec42c4bcd28934a8c87a06c3fa28b01561d46aa09a9881b8622c58'],
    }),
    ('fire', '0.7.1', {
        'checksums': ['3b208f05c736de98fb343310d090dcc4d8c78b2a89ea4f32b837c586270a9cbf'],
    }),
    (name, version, {
        'preinstallopts': 'BUILD_MONAI=1',
        'source_tmpl': '%(namelower)s-%(version)s.tar.gz',
        'use_pip_extras': (
            'einops,fire,gdown,ignite,scipy,tqdm,itk,jsonschema,lmdb,nibabel,pydicom,ninja,h5py,optuna,pyamg,'
            'openslide,pandas,pillow,psutil,pyyaml,skimage,tensorboard,torchvision,huggingface_hub,transformers,'
            'mlflow,clearml,matplotlib,tensorboardX,tifffile,imagecodecs,onnx,zarr,lpips,pynrrd'
        ),
        'checksums': ['2fff631dd78afc166ccbafb89d7dde06f3d3b287860fb6f2d6cddd6bcc72caa8'],
    }),
]

sanity_check_commands = ["python -c 'import monai; monai.config.print_config()'"]

moduleclass = 'vis'
