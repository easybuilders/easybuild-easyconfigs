easyblock = 'MakeCp'

name = 'MCScanX'
version = '20221101'
_commit = 'b1ca533510841155beb16dc2f2a65b2a3c37287e'

homepage = 'https://github.com/wyp1125/MCScanX'
description = """The MCScanX package has two major components: a modified version of MCscan
algorithm allowing users to handle MCScan more conveniently and to view
multiple alignment of syntenic blocks more clearly, and a variety of downstream
analysis tools to conduct different biological analyses based on the synteny
data generated by the modified MCScan algorithm."""

toolchain = {'name': 'GCC', 'version': '11.3.0'}

github_account = "wyp1125"
source_urls = [GITHUB_SOURCE]
sources = [{'download_filename': '%s.tar.gz' % _commit, 'filename': SOURCE_TAR_GZ}]
patches = ["MCScanX-20221101_disable-getopt-compatibility-warnings.patch"]
checksums = [
    {'MCScanX-20221101.tar.gz': '563407edd37beacdb2a3ae229c5092eea0900f5775e071a0d6af36098d401ff9'},
    {'MCScanX-20221101_disable-getopt-compatibility-warnings.patch':
     '6bee074114d4ad632d872fa858282f2716e4d8515c629874dd9be3bca32f66a6'},
]

builddependencies = [
    ('make', '4.3'),
]

dependencies = [
    ('Java', '11', '', SYSTEM),
    ('Perl', '5.34.1'),
    ('BioPerl', '1.7.8'),
    ('ClustalW', '1.83'),
]

prebuildopts = "sed -i 's/g++/g++ ${CFLAGS}/g' makefile &&"

_executables = ['MCScanX', 'MCScanX_h', 'duplicate_gene_classifier']
files_to_copy = [(_executables, 'bin'), 'data', 'downstream_analyses', 'README.rst', 'readme.txt']

fix_perl_shebang_for = ['downstream_analyses/*.pl']

sanity_check_paths = {
    'files': ['bin/%s' % x for x in _executables],
    'dirs': ['data', 'downstream_analyses'],
}

sanity_check_commands = [
    "MCScanX -h | grep -q MCScan",
    "detect_collinear_tandem_arrays -h | grep -q gff_file",
    "dissect_multiple_alignment -h | grep -q gff_file",
]

modextrapaths = {
    'CLASSPATH': "downstream_analyses",
    'PATH': "downstream_analyses",
}

moduleclass = 'bio'
