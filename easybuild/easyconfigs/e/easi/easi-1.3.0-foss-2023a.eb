# #
# This is a contribution from HPCNow! (http://hpcnow.com)
# Copyright::   HPCNow!
# Authors::     Jonney Huang <jonney.huang@hpcnow.com>
# License::     GPL-v3.0
# #

easyblock = 'CMakeMake'

name = 'easi'
local_commit_id = '99309a0'
version = '1.3.0'

homepage = 'https://github.com/SeisSol/easi/'
description = """easi is a library for the Easy Initialization of models in three (or less or more) dimensional domains.
"""

toolchain = {'name': 'foss', 'version': '2023a'}

sources = [{
    'git_config': {
        'url': 'https://github.com/SeisSol',
        'repo_name': 'easi',
        'commit': local_commit_id,
        'recursive': True,
    },
    'filename': SOURCE_TAR_GZ,
}]
checksums = [None]

builddependencies = [
    ('CMake', '3.26.3'),
]

dependencies = [
    ('OpenMPI', '4.1.5'),
    ('ASAGI', '1.0'),
    ('Lua', '5.4.6'),
    ('yaml-cpp', '0.7.0'),
    ('ImpalaJIT', '29102021'),
]

preconfigopts = "mkdir build && cd build && export MPI_HOME=$EBROOTOPENMPI && export MPI_ROOT=$EBROOTOPENMPI &&"

configopts = " -DASAGI=ON -DIMPALAJIT=ON -DLUA=ON "
configopts += " -DCMAKE_C_COMPILER=$EBROOTOPENMPI/bin/mpicc"
configopts += " -DCMAKE_CXX_COMPILER=$EBROOTOPENMPI/bin/mpicxx"
prebuildopts = 'cd build &&'
preinstallopts = 'cd build &&'
sanity_check_paths = {
    'files': ['lib/libeasi.a'],
    'dirs': [],
}

moduleclass = 'geo'
