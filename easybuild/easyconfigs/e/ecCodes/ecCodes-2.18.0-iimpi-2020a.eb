easyblock = 'CMakeMake'

name = 'ecCodes'
version = "2.18.0"

homepage = 'https://software.ecmwf.int/wiki/display/ECC/ecCodes+Home'
description = """ecCodes is a package developed by ECMWF which provides an application programming interface and
 a set of tools for decoding and encoding messages in the following formats: WMO FM-92 GRIB edition 1 and edition 2,
 WMO FM-94 BUFR edition 3 and edition 4, WMO GTS abbreviated header (only decoding)."""

toolchain = {'name': 'iimpi', 'version': '2020a'}
toolchainopts = {'usempi': True}

source_urls = ['https://confluence.ecmwf.int/download/attachments/45757960/']
sources = ['eccodes-%(version)s-Source.tar.gz']
checksums = ['d88943df0f246843a1a062796edbf709ef911de7269648eef864be259e9704e3']

builddependencies = [('CMake', '3.18.1')]
dependencies = [
    ('netCDF', '4.7.4'),
    ('OpenJPEG', '2.3.1'),
]

separate_build_dir = True

configopts = "-DENABLE_NETCDF=ON -ENABLE_ECCODES_OMP_THREADS=ON"
configopts += " -DENABLE_PYTHON=OFF"
configopts += " -DENABLE_JPG=ON -DOPENJPEG_DIR=$EBROOTOPENJPEG "
preconfigopts = 'export FFLAGS="$FFLAGS -shared-intel" && '
prebuildopts = 'export FFLAGS="$FFLAGS -shared-intel" && '

sanity_check_paths = {
    'files': ['bin/%s' % x for x in ['bufr_copy', 'bufr_dump', 'bufr_filter', 'bufr_ls',
                                     'codes_count', 'codes_info', 'codes_split_file',
                                     'grib_copy', 'grib_dump', 'grib_filter', 'grib_ls']],
    'dirs': [],
}

moduleclass = 'tools'
