##
# This is a contribution from SIB Swiss Institute of Bioinformatics
# Homepage:     https://www.sib.swiss/research-infrastructure/competence-centers/vital-it
#
# Authors::     Sebastien Moretti <sebastien.moretti@sib.swiss>
#
##
easyblock = 'Binary'

name = 'EDirect'
version = '19.5.20230508'

homepage = 'https://www.ncbi.nlm.nih.gov/books/NBK25501/'
# See also https://dataguide.nlm.nih.gov/edirect/install.html
description = """Entrez Direct (EDirect) provides access to the NCBI's suite of
interconnected databases from a Unix terminal window. Search terms are entered
as command-line arguments. Individual operations are connected with Unix pipes
to construct multi-step queries. Selected records can then be retrieved in a
variety of formats."""
# software_license = 'Public Domain'

toolchain = {'name': 'GCCcore', 'version': '10.3.0'}

source_urls = ['https://ftp.ncbi.nlm.nih.gov/entrez/entrezdirect/versions/%(version)s/']
sources = [
    {'download_filename': 'edirect-%(version)s.tar.gz',
     'filename': 'edirect-%s.tar.gz' % version,
     },
]
checksums = [
    '1a73f832a464f150e41c9330e3d8f8f8775f7c39c9352639480289d588fa4889',  # edirect-19.5.20230508.tar.gz
]

builddependencies = [
    ('Go', '1.20.4', '', SYSTEM),
]

dependencies = [
    ('Python', '3.9.5'),
    ('Perl',   '5.32.1'),
]

extract_sources = True

postinstallcmds = [
    "mkdir %(installdir)s/bin && cd %(installdir)s/cmd/ && "
    "sed -i 's@target=\"\\$HOME/Misc/scripts/\"@target=\"\\$PWD/../\"@' build.sh && "
    "./build.sh install && cd ../ && rm -rf cmd/ eutils/ && "
    "cd bin/ && ln -s ../* . && rm -f easybuild README readme.pdf bin"
]

sanity_check_paths = {
    'files': ['einfo', 'README'],
    'dirs': ['bin', 'help'],
}

sanity_check_commands = [
    "esearch -version && "
    "xtract -version && "
    "esearch -db pubmed -query 'Babalobi OO[au] AND 2008[pdat]' | efetch -format xml | "
    "xtract -pattern Author -if Affiliation -contains Medicine -element Initials"
]

moduleclass = 'bio'
