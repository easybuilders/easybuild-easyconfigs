easyblock = 'CMakeMake'

name = 'hipBLAS'
version = '1.0.0'
_rocm_version = '5.6.0'
versionsuffix = '-ROCm-%s' % _rocm_version

homepage = 'https://hipblas.readthedocs.io/en/latest'
description = """hipBLAS is a Basic Linear Algebra Subprograms (BLAS)
marshalling library, with multiple supported backends. It sits between
the application and a 'worker' BLAS library, marshalling inputs into the
backend library and marshalling results back to the application. hipBLAS
exports an interface that does not require the client to change,
regardless of the chosen backend. Currently, hipBLAS supports rocBLAS
and cuBLAS as backends."""

toolchain = {'name': 'GCC', 'version': '11.3.0'}

sources = [
    {
        'source_urls': ['https://github.com/ROCmSoftwarePlatform/hipBLAS/archive/'],
        'download_filename': 'rocm-%s.tar.gz' % _rocm_version,
        'filename': '%%(name)s-%%(version)s-rocm-%s.tar.gz' % _rocm_version,
    },
]
checksums = ['9453a31324e10ba528f8f4755d2c270d0ed9baa33e980d8f8383204d8e28a563']

builddependencies = [
    ('CMake', '3.23.1'),
]

dependencies = [
    ('Python', '3.10.4'),
    ('HIP', '5.6.0', '-amd'),
    ('rocBLAS', '3.0.0', versionsuffix),
    ('rocSOLVER', '3.22.0', versionsuffix),
]

preconfigopts = 'export CC=hipcc CXX=hipcc && '

sanity_check_paths = {
    'files': [
        'include/%(namelower)s.h', 'include/%(namelower)s/%(namelower)s.h',
        'lib/lib%%(namelower)s.%s' % SHLIB_EXT,
    ],
    'dirs': ['lib/cmake/%(namelower)s'],
}

moduleclass = 'lib'
