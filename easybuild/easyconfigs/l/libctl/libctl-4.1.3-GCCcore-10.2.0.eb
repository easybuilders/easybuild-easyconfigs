easyblock = 'ConfigureMake'

name = 'libctl'
version = '4.1.3'

homepage = 'http://ab-initio.mit.edu/libctl'
description = """libctl is a free Guile-based library implementing flexible control files for scientific simulations."""

toolchain = {'name': 'GCCcore', 'version': '10.2.0'}
toolchainopts = {'optarch': True, 'pic': True}

source_urls = ['https://github.com/NanoComp/libctl/releases/download/v%(version)s/']
sources = [SOURCELOWER_TAR_GZ]
checksums = ['6b9fc9dd3ed74f4b3be0910b27ca41b5982474ec3a2c9d7eb0387eb0fa38ff81']

builddependencies = [
    ('binutils', '2.35'),
    ('Autotools', '20200321'),
]

dependencies = [('Guile', '2.2.4')]

# fix for guile-config being broken because shebang line contains full path to bin/guile
configopts = 'GUILE_CONFIG="$EBROOTGUILE/bin/guile -e main -s $EBROOTGUILE/bin/guile-config"'

configopts += " --with-pic  --enable-shared"

sanity_check_paths = {
    'files': ["bin/gen-ctl-io", "lib/libctlgeom.so", "lib/libctl.so"],
    'dirs': [],
}

moduleclass = 'chem'
