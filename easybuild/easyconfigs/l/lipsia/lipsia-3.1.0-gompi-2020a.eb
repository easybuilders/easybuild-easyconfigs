# #
# This is a contribution from HPCNow! (http://hpcnow.com)
# Copyright::   HPCNow!
# Authors::     Erica Bianco <erica.bianco@hpcnow.com>
# License::     GPL-v3.0
# #

easyblock = 'MakeCp'

name = 'lipsia'
version = '3.1.0'

homepage = 'http://www.cbs.mpg.de/institute/software/lipsia/'
description = """Lipsia is a collection of tools for the analysis of fMRI data. Its main focus is on new algorithms such as statistical inference (LISA), Eigenvector centrality mapping (ECM) and network detection in task-fMRI (TED).
It was developed over the course of several years at the Max Planck Institute for Human Cognitive and Brain Sciences in Leipzig, Germany.
"""

toolchain = {'name': 'gompi', 'version': '2020a'}
toolchainopts = {'noopt': True,}

source_urls = ['https://github.com/lipsia-fmri/lipsia/archive/refs/heads']
sources = ['master.zip']
patches = ['%(name)s-%(version)s-setup.patch']
checksums = [
    '6c6ca8ec744f88c4ec1200c43c862c3817389e8a507d9dd8144470c01ec643e7',  # master.zip
    '4765ba6ab4cc07b2fa949b5f9e14443e38026d862dc844e39845cfc10b2503ea',  # lipsia-3.1.0-setup.patch
]


dependencies = [
    ('Boost','1.72.0',),
    ('Anaconda3','2021.05'),
    ('GSL', '2.6',),
]

prebuildopts = [' && '.join([
    'export TMP_BUILDDIR=%(builddir)s/lipsia-master',
    'export TMP_INSTALLDIR=%(installdir)s',
    'cd  %(builddir)s/lipsia-master',
    'source ./lipsia-setup.sh -s',
    'cd src/',
    '',
])]

parallel=1

files_to_copy = ['bin', 'lib', 'include']

postinstallcmds = [
    '/apps/rocs/2020.08/prefix/tools/bin/setrpaths.sh --path %(installdir)s'
]

sanity_check_paths = {
    'files': ['bin/vted', 'lib/libvia3.0.so', 'include/via/via.h'],
    'dirs': ['bin', 'lib', 'include'],
}

