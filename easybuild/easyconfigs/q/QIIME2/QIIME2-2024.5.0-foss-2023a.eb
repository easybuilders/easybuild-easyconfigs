easyblock = 'PythonBundle'

name = 'QIIME2'
version = '2024.5.0'

homepage = 'https://qiime2.org'
description = """QIIME 2 is a powerful, extensible, and decentralized microbiome bioinformatics platform that is free,
open source, and community developed."""

toolchain = {'name': 'foss', 'version': '2023a'}

builddependencies = [
    ('Meson', '1.3.1'),
    ('meson-python', '0.15.0'),
    ('pkgconf', '1.9.5'),
    ('pybind11', '2.11.1'),
    ('PDM', '2.12.4'),
    ('poetry', '1.5.1'),
    ('hatchling', '1.18.0'),
]

dependencies = [
    ('Python', '3.11.3'),
    ('SciPy-bundle', '2023.07'),
    ('matplotlib', '3.7.2'),
    ('IPython', '8.14.0'),
    ('PyYAML', '6.0'),
    ('Java', '11', '', SYSTEM),
    ('Perl', '5.36.1'),
    ('R', '4.3.2'),
    ('R-bundle-Bioconductor', '3.18', '-R-%(rver)s'),
    ('Parsl', '2024.4.8'),
    ('alsa-lib', '1.2.9'),
    ('BLAST+', '2.14.1'),
    ('bokeh', '3.2.2'),
    ('Bowtie2', '2.5.1'),
    ('bwidget', '1.9.16'),
    ('bzip2', '1.0.8'),
    ('cairo', '1.17.8'),
    ('cURL', '8.0.1'),
    ('cutadapt', '4.9'),
    ('DendroPy', '4.6.1'),
    ('expat', '2.5.0'),
    ('FastTree', '2.1.11'),
    ('fontconfig', '2.14.2'),
    ('FriBidi', '1.0.12'),
    ('giflib', '5.2.1'),
    ('GLib', '2.77.1'),
    ('GSL', '2.7'),
    ('h5py', '3.9.0'),
    ('HarfBuzz', '5.3.1'),
    ('MAFFT', '7.520', '-with-extensions'),
    ('scikit-bio', '0.6.0'),
    ('scikit-learn', '1.3.1'),
    ('Seaborn', '0.13.2'),
    ('statsmodels', '0.14.1'),
    ('umap-learn', '0.5.5'),
    ('VSEARCH', '2.25.0'),
    ('UniFrac', '1.4'),
    ('attr', '2.5.1'),
    ('Brotli-python', '1.0.9'),
    ('SAMtools', '1.18'),
    ('HTSlib', '1.18'),
    ('HMMER', '3.4'),
    ('networkx', '3.1'),
    ('PICRUSt2', '2.5.2'),
]

use_pip = True

# avoid that hidden (sub)directories like .config/q2cli are created in home directory
preinstallopts = "export HOME=%(builddir)s/home && "

exts_list = [
    ('iow', '1.0.7', {
        'modulename': 'bp',
        'preinstallopts': """sed -i "/'nose /d" setup.py && """,
        'checksums': ['149219bf78b2d5ae076fa85822c73a39e17b982233d6710c250295e9803388ed'],
    }),
    ('unifrac', '1.3', {
        'patches': ['%(name)s-1.1.1_fix.patch'],
        'source_urls': ['https://github.com/biocore/unifrac/archive'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': [
            {'unifrac-1.3.tar.gz': 'e8cc37c3d5aaa31494c218df8a336eae135049d6840023d057da4fda8c4a4377'},
            {'unifrac-1.1.1_fix.patch': '4f31e9e1f8c40a166d0a66852f6ae2434a95575664a69e49bb513997891d3806'},
        ],
    }),
    ('argcomplete', '3.4.0', {
        'checksums': ['c2abcdfe1be8ace47ba777d4fce319eb13bf8ad9dace8d085dcad6eded88057f'],
    }),
    ('sniffio', '1.3.1', {
        'checksums': ['f4324edc670a0f49750a81b895f35c3adb843cca46f0530f79fc1babb23789dc'],
    }),
    ('anyio', '4.4.0', {
        'checksums': ['5aadc6a1bbb7cdb0bede386cac5e2940f5e2ff3aa20277e991cf028e0585ce94'],
    }),
    ('cached-property', '1.5.2', {
        'checksums': ['9fa5755838eecbb2d234c3aa390bd80fbd3ac6b6869109bfc1b499f7bd89a130'],
    }),
    ('contourpy', '1.2.1', {
        'checksums': ['4d8908b3bee1c889e547867ca4cdc54e5ab6be6d3e078556814a22457f49423c'],
    }),
    ('tzdata', '2024.1', {
        'checksums': ['2674120f8d891909751c38abcdfd386ac0a5a1127954fbc332af6b5ceae07efd'],
    }),
    ('tzlocal', '5.0.1', {
        'checksums': ['46eb99ad4bdb71f3f72b7d24f4267753e240944ecfc16f25d2719ba89827a803'],
    }),
    ('argon2-cffi-bindings', '21.2.0', {
        'modulename': '_argon2_cffi_bindings',
        'checksums': ['bb89ceffa6c791807d1305ceb77dbfacc5aa499891d2c55661c6459651fc39e3'],
    }),
    ('biom-format', '2.1.15', {
        'modulename': 'biom',
        'checksums': ['3bda2096e663dc1cb6f90f51b394da0838b9be5164a44370c134ce5b3b2a4dd3'],
    }),
    ('pylatexenc', '2.10', {
        'checksums': ['3dd8fd84eb46dc30bee1e23eaab8d8fb5a7f507347b23e5f38ad9675c84f40d3'],
    }),
    ('bibtexparser', '1.4.1', {
        'checksums': ['e00e29e24676c4808e0b4333b37bb55cca9cbb7871a56f63058509281588d789'],
    }),
    ('emperor', '1.0.4', {
        'checksums': ['8b57d6ee3709b62b4dfdd8e1f815dd88e5fee3a05947d72fa32191a16ac08854'],
    }),
    ('gneiss', '0.4.6', {
        'preinstallopts': "sed -i '/nose/d' setup.py && ",
        'checksums': ['5ebf32148909cf74475e45682042c68224f002c1cbf723a5c96014a30f1cf323'],
    }),
    ('ijson', '3.3.0', {
        'checksums': ['7f172e6ba1bee0d4c8f8ebd639577bfe429dee0f3f96775a067b8bae4492d8a0'],
    }),
    ('atpublic', '4.1.0', {
        'modulename': 'public',
        'checksums': ['d1c8cd931af7461f6d18bc6063383e8654d9e9ef19d58ee6dc01e8515bbf55df'],
    }),
    ('interface_meta', '1.3.0', {
        'checksums': ['8a4493f8bdb73fb9655dcd5115bc897e207319e36c8835f39c516a2d7e9d79a1'],
    }),
    ('wrapt', '1.16.0', {
        'checksums': ['5f370f952971e7d17c7d1ead40e49f32345a7f7a5373571ef44d800d06b1899d'],
    }),
    ('formulaic', '1.0.2', {
        'checksums': ['6eb65bedd1903c5381d8f2ae7a55b6ba13cb77d57bbaf6e4278f3b2c38e3660e'],
    }),
    ('flufl_lock', '8.1.0', {
        'modulename': 'flufl.lock',
        'source_tmpl': 'flufl_lock-%(version)s.tar.gz',
        'checksums': ['d88302005692a63d98b60080158faf089be5ecae6969f706409da8276fdce7cb'],
    }),
    ('toolz', '0.12.1', {
        'checksums': ['ecca342664893f177a13dac0e6b41cbd8ac25a358e5f215316d43e2100224f4d'],
    }),
    ('altair', '5.3.0', {
        'checksums': ['5a268b1a0983b23d8f9129f819f956174aa7aea2719ed55a52eba9979b9f6675'],
    }),
    (name, version, {
        'source_urls': ['https://github.com/qiime2/qiime2/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['170f2095b0f1ef157d6f7c6703692b3870842fa39eb49f77719fc7c8de37caba'],
    }),
    ('q2cli', version, {
        'source_urls': ['https://github.com/qiime2/q2cli/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['f21eacb010e27318d89d40ccc4c212c21ad9ad7a7a0f2fc3a1ae53f090c5244c'],
    }),
    ('q2-alignment', version, {
        'source_urls': ['https://github.com/qiime2/q2-alignment/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['01735fad2097044f3aa2005ad50dec3b0fa4bc8665c23d230dcc7699ba7758a5'],
    }),
    ('q2-composition', version, {
        'source_urls': ['https://github.com/qiime2/q2-composition/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['fd3ed644ab285468d0280085322d06e89e5463eb48bdc359b4de96982d31339e'],
    }),
    ('q2-cutadapt', version, {
        'source_urls': ['https://github.com/qiime2/q2-cutadapt/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['9decb8e335512511e583b4677889286a9ed5cfa004571046523bfc5ad08c8010'],
    }),
    ('q2-dada2', version, {
        'source_urls': ['https://github.com/qiime2/q2-dada2/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['c78342f4178c0aee877516d3d41ffd07a7397d15b81a72007c3b10bcc58ffc9c'],
    }),
    ('q2-deblur', version, {
        'source_urls': ['https://github.com/qiime2/q2-deblur/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['984be74efb6566f3272f735fc3ebc0f27f69d5620312f07095f67fe7f84f7f24'],
    }),
    ('q2-demux', version, {
        'preinstallopts': "make all && ",
        'source_urls': ['https://github.com/qiime2/q2-demux/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['37c924009abc9b725a39ec43cab322a0637996d4dff601dac1edf1aacba408a7'],
    }),
    ('q2-diversity', version, {
        'preinstallopts': "make all && ",
        'source_urls': ['https://github.com/qiime2/q2-diversity/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['42422c03edd5ae5a12351a5d957252e7015d6f0f80800bb87230d0299dc21021'],
    }),
    ('q2-diversity-lib', version, {
        'source_urls': ['https://github.com/qiime2/q2-diversity-lib/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['98feb8b4e23ab81df1f7eddad064f11e2431e87b940903ee9b69ee7bb9b28f49'],
    }),
    ('q2-emperor', version, {
        'source_urls': ['https://github.com/qiime2/q2-emperor/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['692d0abf5bac7ff82778a1436df39cf8869afe9b70b9ce65e4c11b1cfcba7eec'],
    }),
    ('q2-feature-classifier', version, {
        'source_urls': ['https://github.com/qiime2/q2-feature-classifier/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['50429ecbbeadd22c89878eacb931d2593e8c8f946615aaa80c7ee38b52d1517c'],
    }),
    ('q2-feature-table', version, {
        'source_urls': ['https://github.com/qiime2/q2-feature-table/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['087cc0f1cc32a667cc175f6ed29897d483d0d6382320fc40280691a856d18c44'],
    }),
    ('q2-fragment-insertion', version, {
        'source_urls': ['https://github.com/qiime2/q2-fragment-insertion/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['22b9f6f4c99b65bfed5142a5f2bb59404d3cde4b63b0c725ed9e1d0ca8667a72'],
    }),
    ('q2-gneiss', '2023.7.0', {
        'source_urls': ['https://github.com/qiime2/q2-gneiss/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['f495d0cfb9125325f85c39ba87a69ca843b856211c0b3250e34877cc5bdccb68'],
    }),
    ('q2-longitudinal', version, {
        'source_urls': ['https://github.com/qiime2/q2-longitudinal/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['5591bbfdb96dcd88cf6127770cd61a2dca8dbe624fe10db8c1bc592c37de894c'],
    }),
    ('q2-metadata', version, {
        'source_urls': ['https://github.com/qiime2/q2-metadata/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['3bc27b1bbd9cd2eb40d023665e5949faf6a26a5fb14c5c2c041bb63eb2299431'],
    }),
    ('q2-phylogeny', version, {
        'source_urls': ['https://github.com/qiime2/q2-phylogeny/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['e0c348a8681f498e93557f69d85f358f5ddccd24bd78e6a35e2d3aef0019f131'],
    }),
    ('q2-quality-control', version, {
        'source_urls': ['https://github.com/qiime2/q2-quality-control/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['cce17c4825687dcd65fe2e979e976958a3ba932f78433ad3fb911bce6e8b816c'],
    }),
    ('q2-quality-filter', version, {
        'source_urls': ['https://github.com/qiime2/q2-quality-filter/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['dd4a4f6a45565e262d3eb5f304c8ee133542a44e1be472854229bdc6298d5bd0'],
    }),
    ('q2-sample-classifier', version, {
        'source_urls': ['https://github.com/qiime2/q2-sample-classifier/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['b4eb9a931fe13862bf6d8d3673ac5405c40b8376712f6390b3ed7714854f91c1'],
    }),
    ('q2-taxa', version, {
        'preinstallopts': "make all && ",
        'source_urls': ['https://github.com/qiime2/q2-taxa/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['7863fa18fab2a01cb2da31274a2c69766effd8943d85d419b77df5b979d2479e'],
    }),
    ('q2-types', version, {
        'source_urls': ['https://github.com/qiime2/q2-types/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['4547919358a6ecd281e9537b3e77fd5ce865ed15a3ee5d1c81ff616f6b60e51c'],
    }),
    ('q2-vsearch', version, {
        'source_urls': ['https://github.com/qiime2/q2-vsearch/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['3bddd396be4924dd301e19c262debcb9c8b9b866b6396841f961db93d68fd9ed'],
    }),
    ('q2templates', version, {
        'source_urls': ['https://github.com/qiime2/q2templates/archive/'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['63a34c1d10c4fcb271436e94ee40bdaa8ab1f5e4b64d29b7df6657a63564ace1'],
    }),
    ('q2-picrust2', '2023.2_0', {
        'source_urls': ['https://github.com/gavinmdouglas/q2-picrust2/archive'],
        'sources': [{'download_filename': '%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
        'checksums': ['8bbd14665f6149c3960d1c1331d4a119f3ce31b044dae65b96ff8f5da3e8b5c6'],
    }),
]

sanity_pip_check = True

sanity_check_paths = {
    'files': ['bin/biom', 'bin/qiime'],
    'dirs': ['lib/python%(pyshortver)s/site-packages'],
}

sanity_check_commands = [
    "qiime --help",
    "qiime info",
    "qiime tools validate "
    "%(installdir)s/lib/python%(pyshortver)s/site-packages/q2_sample_classifier/tests/data/vaw.qza",
]

modextrapaths = {'CONDA_PREFIX': ''}

moduleclass = 'bio'
