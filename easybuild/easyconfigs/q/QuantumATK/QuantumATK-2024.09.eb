easyblock = 'Binary'
name = 'quantumatk'
version = '2024.09'
homepage = 'https://www.synopsys.com/silicon/quantumatk.html'
description = """QuantumATK is a complete atomistic simulation toolkit. QuantumATK addresses key applications in the semiconductor industry and is a core component of the Synopsys Design-Technology Co-Optimization (DTCO) solution. Atomic-scale modeling tools in QuantumATK range from classical force fields for handling large and to some extent more realistic materials systems to ab initio tools that provide highly accurate results for smaller systems. """

#toolchain = {'name': 'iimpi', 'version': '2020a'}
toolchain = SYSTEM
sources = ['QuantumATK_vW-%(version)s.tar.gz']
extract_sources = True
checksums = ['d3aa0b3c502aba48a9b239ef516043962b1ef6dd9a148ba484a06c073983496b']
install_cmd = "./SynopsysInstaller_v5.8.run -dir . && "
install_cmd += "cat << EOF > config \nSourceDir: $(pwd) \nSiteID: 000 \nPRODUCTS: quantumatk \nRELEASES: W-2024.09 \nquantumatk, W-2024.09 { \n   DESCRIPTION: Synopsys QuantumATK \n   POSTARGVALUE: softwareRendering (no) \n   POSTARGVALUE: addToPath(yes) \n   POSTARGVALUE: openLicenseDoc(no) \n   POSTARGVALUE: runProgramAfterInstall(no) \n} \nEOF\n "
install_cmd += "export SI_ACCEPT_LICENSE=1 ; ./installer -target %(installdir)s -batch_installer -config config"
postinstallcmds = ["sed -i 's/TENTATIVE_PATHS=/#TENTATIVE_PATHS=/g' %(installdir)s/quantumatk/W-%(version)s/atkpython/bin/activate_env && sed -i 's/0/1/g'  %(installdir)s/quantumatk/W-%(version)s/software-rendering "]
sanity_check_paths = {
      'files': ['quantumatk/W-2024.09/bin/quantumatk','quantumatk/W-2024.09/bin/atkpython'],
      'dirs': []
}
modextrapaths = {"PATH" : "quantumatk/W-%(version)s/mpi/bin"}
modextrapaths = {"PATH" : "quantumatk/W-%(version)s/bin"}
moduleclass = 'phys'

modluafooter = """
require("SitePackage")
local found, path = find_and_define_license_file("SNPSLMD_LICENSE_FILE","quantumatk")
if (not found) then
        local error_message = [[
        We did not find a suitable license for QuantumATK. If you have access to one, you can create the file $HOME/.licenses/quantumatk.lic  with the license information. If you think you should have access to one as    part of your institution, please write to support@computecanada.ca so that we can configure it.

        Nous n'avons pas trouve de licence utilisable pour QuantumATK. Si vous avez acces a une licence de QuantumATK, vous pouvez creer le fichier $HOME/.licenses/quantumatk.lic avec l'information de la licence. Si vous    pensez que vous devriez automatiquement avoir acces a une licence via votre institution, veuillez ecrire a support@calculcanada.ca pour que nous puissions la configurer.
        ]]
        LmodError(error_message)
end
if (mode() == "load") then

   local warning_message = [[ WARNING: please run this software with 'mpiexec' instead of 'srun' ]]
   LmodWarning(warning_message)
end

"""
