easyblock = 'PythonPackage'

name = 'Tensile'
version = '4.37.0'
_rocm_version = '5.6.0'
versionsuffix = '-ROCm-%s' % _rocm_version

homepage = 'https://tensile.readthedocs.io/en/latest'
description = """Tensile is a tool for creating benchmark-driven backend
libraries for GEMMs, GEMM-like problems (such as batched GEMM), and
general N-dimensional tensor contractions on a GPU. The Tensile library
is mainly used as backend library to rocBLAS. Tensile acts as the
performance backbone for a wide variety of 'compute' applications
running on AMD GPUs."""

toolchain = {'name': 'GCC', 'version': '11.3.0'}

sources = [
    {
        'source_urls': ['https://github.com/ROCmSoftwarePlatform/Tensile/archive/'],
        'download_filename': 'rocm-%s.tar.gz' % _rocm_version,
        'filename': '%%(name)s-%%(version)s-rocm-%s.tar.gz' % _rocm_version,
    },
]
patches = [
    '%(name)s-%(version)s_fix-search-for-hipcc.patch',
    '%(name)s-%(version)s_update-to-newer-msgpack.patch',
]
checksums = [
    {'Tensile-4.37.0-rocm-5.6.0.tar.gz': '383728ecf49def59ab9a7f8a1d1e2eaf8b528e36b461e27030a2aab1a1ed80cb'},
    {'Tensile-4.37.0_fix-search-for-hipcc.patch': '3d18ff65276b6187b857101189682659a9f6c00d7823917a80fe41ee43b711d0'},
    {'Tensile-4.37.0_update-to-newer-msgpack.patch':
     'b665ad68d0845127b5b6bf307a977200ff50acbd25e44037ff45003ddbab0eb7'},
]

dependencies = [
    ('Python', '3.10.4'),
    ('PyYAML', '6.0'),
    ('msgpack-cxx', '6.0.0'),
]

use_pip = True
sanity_pip_check = True
download_dep_fail = True

options = {'modulename': name}

moduleclass = 'tools'
