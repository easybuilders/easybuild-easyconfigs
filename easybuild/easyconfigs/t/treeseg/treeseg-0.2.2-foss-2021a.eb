# This easyconfig was created by the BEAR Software team at the University of Birmingham.
easyblock = 'CMakeMakeCp'

name = 'treeseg'
version = '0.2.2'

homepage = "https://github.com/apburt/treeseg"
description = """Extract individual trees from lidar point clouds"""

toolchain = {'name': 'foss', 'version': '2021a'}

github_account = 'apburt'
source_urls = [GITHUB_SOURCE]
sources = ['v%(version)s.tar.gz']
patches = ['%(name)s-%(version)s_boost-header.patch']
checksums = [
    '69d674ff5eafb24af5a5166fa3ed3b00ebafe9540e747f24a209bb5be3c5227c',  # v0.2.2.tar.gz
    '30a815eaba4a65c084771101d5cc9fe232c206016facfb5c04f1e90b4c55045e',  # treeseg-0.2.2_boost-header.patch
]

builddependencies = [
    ('CMake', '3.20.1'),
]

dependencies = [
    ('Armadillo', '10.7.4'),
    ('PCL', '1.12.1'),
]

_exes = [
    'downsample', 'findstems', 'getcrownvolume', 'getdtmslice', 'nearestneighbour', 'pcdPointTreeseg2txt',
    'pcdPointXYZRGB2txt', 'plotcoords', 'segmentcrown', 'segmentstem', 'sepwoodleaf', 'thin', 'txtPointTreeseg2pcd'
]
_libs = ['libleafsep.%s' % SHLIB_EXT, 'libtreeseg.%s' % SHLIB_EXT]

files_to_copy = [(_exes, 'bin'), (_libs, 'lib'), '../treeseg-0.2.2/include', '../treeseg-0.2.2/LICENSE']

sanity_check_paths = {
    'files': ['bin/%s' % x for x in _exes] + ['lib/%s' % l for l in _libs],
    'dirs': ['include'],
}

moduleclass = 'geo'
