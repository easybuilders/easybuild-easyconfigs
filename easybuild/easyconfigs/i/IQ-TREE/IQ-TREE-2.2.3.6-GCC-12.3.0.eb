# Updated to v2.1.3 by
# R.QIAO <rob.qiao@flinders.edu.au>
# DeepThought, Flinders University

easyblock = 'CMakeMake'

name = 'IQ-TREE'
version = '2.3.6'

# HTTPS is not working
homepage = 'http://www.iqtree.org/'
description = """Efficient phylogenomic software by maximum likelihood"""

toolchain = {'name': 'GCC', 'version': '12.3.0'}
toolchainopts = {'openmp': True, 'pic': True}

source_urls = ['https://github.com/iqtree/iqtree2/archive/']
sources = ['v%(version)s.tar.gz']
patches = [
    'IQ-TREE-2.3.6_use_EB_LSD2.patch',
    'IQ-TREE-2.3.6_fix-mpi.patch',
]
checksums = [
    {'v%(version)s.tar.gz': '2d389ea74e19773496363cd68270b341ac7cc47c60e7f32859682403b34744cf'},
    {'IQ-TREE-2.3.6_use_EB_LSD2.patch': '30424c56c51bdad71421a150f5384e6b250df909788c9dbdf99765c30a268132'},
    {'IQ-TREE-2.3.6_fix-mpi.patch': '14237b1fa9e999589ca5310779b178400c7775751635be6aacead3f4b1252be9'},
]

builddependencies = [
    ('CMake', '3.27.7'),
    ('Eigen', '3.4.0'),
]
dependencies = [
    ('Boost', '1.85.0'),
    ('LSD2', '2.4.1'),
]

configopts = '-DIQTREE_FLAGS=omp -DUSE_LSD2=ON'

sanity_check_paths = {
    'files': ['bin/iqtree2'],
    'dirs': [],
}

sanity_check_commands = [
    "iqtree2 --help",
    "mkdir -p $TMPDIR/test-omp",
    "cd $TMPDIR/test-omp && cp -a %(installdir)s/example.phy . && iqtree2 -s example.phy",
]

moduleclass = 'bio'
