# Contribution from Imperial College Loncon / UK
# uploaded by J. Sassmannshausen

easyblock = 'ConfigureMake'

name = 'IGoR'
version = '1.4.0'

homepage = 'https://github.com/statbiophys/IGoR'
description = """
This repository contains all sources and models useful to infer V(D)J 
recombination related processes for TCR or BCR sequencing data using IGoR."""

toolchain = {'name': 'GCC', 'version': '11.2.0'}
toolchainopts = {'extra_cxxflags': '-pipe '}

source_urls = ['https://github.com/qmarcou/IGoR/archive']
sources = ['%(version)s.tar.gz']
patches = [
    'igor-1.4.0-c++.patch',
    'igor-1.4.0-3rd-party.patch',
]
checksums = [
    '803315b0b55f78ec04852fb81b8167b2e57bc18f0df50bd2f5f507880b9707ff',   # v1.4.0.tar.gz
    'fe8afb79b8ebfa68765ee5c0cc109e69638a506222775a0d5308b93d1023e7fb',   # igor-1.4.0-c++.patch
    'be285e64831a6a1e77389257c8b722de8ce475d289d4610c0a965a097f3ec2ff',   # igor-1.4.0-3rd-party.patch
]

builddependencies = [
    ('Autotools', '20210726'),
    ('M4', '1.4.19'),
    ('binutils', '2.37'),
]

dependencies = [
    ('GSL', '2.7'),
    ('jemalloc', '5.2.1'),
    ('FlexiBLAS', '3.0.4'),
]

preconfigopts = "autoreconf -i &&"

# The sanity check runs within 2 mins on 2 cores but ensures a correct build
# Removing the leftover files from the run_demo command:
sanity_check_commands = ["igor -version && OMP_NUM_THREADS=2 igor -run_demo && rm -rf /tmp/igor_demo/"]

sanity_check_paths = {
    'files': ['bin/igor', 'bin/igor-compute_pgen'],
    'dirs': ['share/igor']
}

moduleclass = 'bio'
