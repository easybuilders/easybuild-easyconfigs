easyblock = 'CmdCp'

name = 'BUFRLIB'
version = '11.3.0'

homepage = 'https://www.emc.ncep.noaa.gov/index.php?branch=BUFRLIB'
description = """NCEP BUFRLIB software to encode or decode BUFR messages. It is not intended to be a primer on the BUFR code form itself."""

toolchain = {'name': 'GCCcore', 'version': '9.3.0'}

source_urls = ['https://www.emc.ncep.noaa.gov/BUFRLIB/docs']
sources = ['%s_v%s.tar'%(name, version.replace('.','-'))]
checksums = ['122bc2accfca5a572eaf26e2267d1d40efe1d8d60907a1b99c921f875757e94a']

#export CC=gcc; export FC=gfortran; $CC -DUNDERSCORE -c `./preproc.sh` *.c;
cmds_map = [('.*', """
 $CC -DUNDERSCORE -c `./preproc.sh` *.c;
 $(FC) -c modv*.f moda*.f `ls -1 *.f | grep -v "mod[av]_"`;
 ar crv libbufr.a 
 """),
]

postinstallcmds =  ['mkdir -p %(installdir)s/lib && cp %(builddir)s/*.a %(installdir)s/lib/']

files_to_copy = ["README_BUFRLIB"]

sanity_check_paths = {
    'files': ['lib/libbufr.a'],
    'dirs': [],
}

moduleclass = 'lib'
