easyblock = 'PythonBundle'

name = 'BioEmu'
version = '1.2.0'

homepage = 'https://github.com/microsoft/bioemu'
description = """
Biomolecular Emulator (BioEmu for short) is a model that samples from the
approximated equilibrium distribution of structures for a protein monomer,
given its amino acid sequence.
"""

toolchain = {'name': 'foss', 'version': '2024a'}

builddependencies = [
    ('PDM', '2.18.2'),
    ('hatchling', '1.27.0'),
]

dependencies = [
    ('Python', '3.12.3'),
    ('SciPy-bundle', '2024.05'),
    ('PyTorch-Geometric', '2.6.1'),
    ('Biopython', '1.84'),
    ('dm-tree', '0.1.9'),
    ('MDTraj', '1.10.3'),
    ('mygene', '3.2.2'),
]

exts_list = [
    ('typer', '0.19.2', {
        'checksums': ['9ad824308ded0ad06cc716434705f691d4ee0bfd0fb081839d2e426860e7fdca'],
    }),
    ('termcolor', '2.5.0', {
        'checksums': ['998d8d27da6d48442e8e1f016119076b690d962507531df4890fcd2db2ef8a6f'],
    }),
    ('fire', '0.7.0', {
        'checksums': ['961550f07936eaf65ad1dc8360f2b2bf8408fad46abbfa4d2a3794f8d2a95cdf'],
    }),
    ('ihm', '1.8', {
        'checksums': ['6c19813642487a5af3603beb51a1854559e55ccaa8fddd10986c3026a11b948f'],
    }),
    ('modelcif', '0.7', {
        'checksums': ['d6acedb2c0afb7a6964b15aa275926dd8b55c88217ae82279a1667f33f6316de'],
    }),
    ('stackprinter', '0.2.12', {
        'checksums': ['271efc75ebdcc1554e58168ea7779f98066d54a325f57c7dc19f10fa998ef01e'],
    }),
    ('gprofiler-official', '1.0.0', {
        'modulename': 'gprofiler',
        'checksums': ['5015b47f10fbdcb59c57e342e815c9c07afbe57cd3984154f75b845ddef2445d'],
    }),
    ('bio', '1.8.1', {
        'modulename': False,  # just a 'bio' executable
        'checksums': ['be516bd9fe4dfee562a521d22ffa4b94ee662b9f2a53a4dd52a0a00d93521354'],
    }),
    ('bioemu', version, {
        # uv only needed for a setup script in bioemu that installs colabfold
        'preinstallopts': "sed -i '/.uv.,/d' pyproject.toml &&",
        'checksums': ['be262f913ab700d43da743f2e8ea171e70b293fcceefbaac5e2b4d5e904fa6cf'],
    }),
]

sanity_check_paths = {
    'files': ['bin/bio', 'bin/typer'],
    'dirs': ['lib/python%(pyshortver)s/site-packages/'],
}

sanity_check_commands = [
    "python -m bioemu.sample --help",
]

moduleclass = 'bio'
