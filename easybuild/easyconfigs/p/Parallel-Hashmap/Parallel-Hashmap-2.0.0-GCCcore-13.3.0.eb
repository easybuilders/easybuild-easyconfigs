easyblock = 'CMakeMake'

name = 'Parallel-Hashmap'
version = '2.0.0'

homepage = 'https://github.com/greg7mdp/parallel-hashmap'
description = """Parallel Hashmap is built on a modified version of
Abseil's flat_hash_map. Parallel Hashmap has lower space requirements,
is nearly as fast as the underlying flat_hash_map, and can be used from
multiple threads with high levels of concurrency."""

# There is no actual library built, so it can be at GCCcore level despite being a C++ "library"
toolchain = {'name': 'GCCcore', 'version': '13.3.0'}

github_account = 'greg7mdp'
source_urls = [GITHUB_LOWER_SOURCE]
sources = ['v%(version)s.tar.gz']
checksums = ['4f462f51a3468166ea4cf87c80e001dc1999093264cf55cbda3492ca39a7730b']

builddependencies = [
    ('binutils', '2.42'),
    ('CMake', '3.29.3'),
    ('googletest', '1.15.2'),
]

configopts = ' '.join([
    '-DPHMAP_BUILD_TESTS=ON',
    '-DPHMAP_GTEST_LIBS="-lgmock_main -lgmock -lgtest -lpthread"',
    '-DPHMAP_BUILD_EXAMPLES=OFF',
])

runtest = True

sanity_check_paths = {
    'files': ['include/parallel_hashmap/phmap%s.h' % x for x in [
        '', '_base', '_bits', '_config', '_dump', '_fwd_decl', '_utils'
    ]],
    'dirs': [],
}

moduleclass = 'lib'
