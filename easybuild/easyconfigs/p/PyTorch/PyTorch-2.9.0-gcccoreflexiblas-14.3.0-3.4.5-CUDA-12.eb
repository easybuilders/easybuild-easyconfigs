easyblock = 'PythonBundle'

name = 'PyTorch'
version = '2.9.0'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://pytorch.org/'
description = """Tensors and Dynamic neural networks in Python with strong GPU acceleration.
PyTorch is a deep learning framework that puts Python first."""

toolchain = {'name': 'gcccoreflexiblas', 'version': '14.3.0-3.4.5'}

builddependencies = [
    ('binutils', '2.44'),
    ('CMake', '4.0.3'),
]

dependencies = [
    ('Python', '3.13.5'),
    ('CUDA', '12', '', SYSTEM),
    ('Python-bundle-PyPI', '2025.07'),
    ('networkx', '3.5'),
    ('sympy', '1.14.0'),
    ('opt-einsum', '3.4.0'),
]


# PyTorch on Grace Hopper nodes don't have the same wheels
if ARCH == 'aarch64':
    exts_list = [
        ('nvidia_nvtx_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['d7ad891da111ebafbf7e015d34879f7112832fc239ff0d7d776b6cb685274615'],
        }),
        ('nvidia_nvshmem_cu12', '3.3.20', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['0b0b960da3842212758e4fa4696b94f129090b30e5122fea3c5345916545cff0'],
        }),
        ('nvidia_nvjitlink_cu12', '12.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['adccd7161ace7261e01bb91e44e88da350895c270d23f744f0820c818b7229e7'],
        }),
        ('nvidia_nccl_cu12', '2.27.5', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['31432ad4d1fb1004eb0c56203dc9bc2178a1ba69d1d9e02d64a6938ab5e40e7a'],
        }),
        ('nvidia_curand_cu12', '10.3.9.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['dfab99248034673b779bc6decafdc3404a8a6f502462201f2f31f11354204acd'],
        }),
        ('nvidia_cufile_cu12', '1.13.1.3', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['4beb6d4cce47c1a0f1013d72e02b0994730359e17801d395bdcbf20cfb3bb00a'],
        }),
        ('nvidia_cuda_runtime_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['52bf7bbee900262ffefe5e9d5a2a69a30d97e2bc5bb6cc866688caa976966e3d'],
        }),
        ('nvidia_cuda_nvrtc_cu12', '12.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['fc1fec1e1637854b4c0a65fb9a8346b51dd9ee69e61ebaccc82058441f15bce8'],
        }),
        ('nvidia_cuda_cupti_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['4412396548808ddfed3f17a467b104ba7751e6b58678a4b840675c56d21cf7ed'],
        }),
        ('nvidia_cublas_cu12', '12.8.4.1', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['b86f6dd8935884615a0683b663891d43781b819ac4f2ba2b0c9604676af346d0'],
        }),
        ('nvidia_cusparse_cu12', '12.5.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['9b6c161cb130be1a07a27ea6923df8141f3c295852f4b260c65f18f3e0a091dc'],
        }),
        ('nvidia_cufft_cu12', '11.3.3.83', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['848ef7224d6305cdb2a4df928759dca7b1201874787083b6e7550dd6765ce69a'],
        }),
        ('nvidia_cudnn_cu12', '9.10.2.21', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['c9132cc3f8958447b4910a1720036d9eff5928cc3179b0a51fb6d167c6cc87d8'],
        }),
        ('nvidia_cusolver_cu12', '11.7.3.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['db9ed69dbef9715071232caa9b69c52ac7de3a95773c2db65bdba85916e4e5c0'],
        }),
        ('torch', version, {
            'sources': ['%(name)s-%(version)s-cp313-cp313-manylinux_2_28_%(arch)s.whl'],
            'checksums': ['c30a17fc83eeab346913e237c64b15b5ba6407fff812f6c541e322e19bc9ea0e'],
        }),
    ]

else:
    exts_list = [
        ('nvidia_cusparselt_cu12', '0.7.1', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.whl',
            'checksums': ['f1bb701d6b930d5a7cea44c19ceb973311500847f81b634d802b7b539dc55623'],
        }),
        ('triton', '3.5.0', {
            'source_tmpl': '%(name)s-%(version)s-cp313-cp313-manylinux_2_27_%(arch)s.manylinux_2_28_%(arch)s.whl',
            'checksums': ['e6bb9aa5519c084a333acdba443789e50012a4b851cd486c54f0b8dc2a8d3a12'],
        }),
        ('nvidia_nvtx_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['5b17e2001cc0d751a5bc2c6ec6d26ad95913324a4adb86788c944f8ce9ba441f'],
        }),
        ('nvidia_nvshmem_cu12', '3.3.20', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['d00f26d3f9b2e3c3065be895e3059d6479ea5c638a3f38c9fec49b1b9dd7c1e5'],
        }),
        ('nvidia_nvjitlink_cu12', '12.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2010_%(arch)s.manylinux_2_12_%(arch)s.whl',
            'checksums': ['81ff63371a7ebd6e6451970684f916be2eab07321b73c9d244dc2b4da7f73b88'],
        }),
        ('nvidia_nccl_cu12', '2.27.5', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['ad730cf15cb5d25fe849c6e6ca9eb5b76db16a80f13f425ac68d8e2e55624457'],
        }),
        ('nvidia_curand_cu12', '10.3.9.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['b32331d4f4df5d6eefa0554c565b626c7216f87a06a4f56fab27c3b68a830ec9'],
        }),
        ('nvidia_cufile_cu12', '1.13.1.3', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['1d069003be650e131b21c932ec3d8969c1715379251f8d23a1860554b1cb24fc'],
        }),
        ('nvidia_cuda_runtime_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['adade8dcbd0edf427b7204d480d6066d33902cab2a4707dcfc48a2d0fd44ab90'],
        }),
        ('nvidia_cuda_nvrtc_cu12', '12.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2010_%(arch)s.manylinux_2_12_%(arch)s.whl',
            'checksums': ['a7756528852ef889772a84c6cd89d41dfa74667e24cca16bb31f8f061e3e9994'],
        }),
        ('nvidia_cuda_cupti_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['ea0cb07ebda26bb9b29ba82cda34849e73c166c18162d3913575b0c9db9a6182'],
        }),
        ('nvidia_cublas_cu12', '12.8.4.1', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['8ac4e771d5a348c551b2a426eda6193c19aa630236b418086020df5ba9667142'],
        }),
        ('nvidia_cusparse_cu12', '12.5.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['1ec05d76bbbd8b61b06a80e1eaf8cf4959c3d4ce8e711b65ebd0443bb0ebb13b'],
        }),
        ('nvidia_cufft_cu12', '11.3.3.83', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['4d2dd21ec0b88cf61b62e6b43564355e5222e4a3fb394cac0db101f2dd0d4f74'],
        }),
        ('nvidia_cudnn_cu12', '9.10.2.21', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['949452be657fa16687d0930933f032835951ef0892b37d2d53824d1a84dc97a8'],
        }),
        ('nvidia_cusolver_cu12', '11.7.3.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['4376c11ad263152bd50ea295c05370360776f8c3427b30991df774f9fb26c450'],
        }),
        ('torch', '2.9.0', {
            'source_tmpl': '%(name)s-%(version)s-cp313-cp313-manylinux_2_28_x86_64.whl',
            'checksums': ['8f25033b8667b57857dfd01458fbf2a9e6a6df1f8def23aef0dc46292f6aa642'],
        }),
    ]

use_pip = True
sanity_pip_check = True

moduleclass = 'lib'
