easyblock = 'PythonBundle'

name = 'PyTorch'
version = '2.9.1'
versionsuffix = '-CUDA-%(cudaver)s-whl'

homepage = 'https://pytorch.org/'
description = """PyTorch is an optimized tensor library for deep learning using GPUs and CPUs.
Used for applications such as computer vision, deep learning research and
natural language processing.
This module provides the official wheels of PyTorch from pytorch.org"""

toolchain = {'name': 'foss', 'version': '2025a'}

_torch_wheel_pyver = 'cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s'
_torch_wheel_source = {
    'aarch64': f'torch-{version}%2Bcu128-{_torch_wheel_pyver}-manylinux_2_28_aarch64.whl',
    'x86_64': f'torch-{version}%2Bcu128-{_torch_wheel_pyver}-manylinux_2_28_x86_64.whl'
}

dependencies = [
    ('CUDA', '12.8.0', '', SYSTEM),
    ('CUDA-wheel-bundle', '12.8.0', '-CUDA-%(cudaver)s'),
    ('Python', '3.13.1'),
    ('Triton', '3.5.1', versionsuffix),
    ('SciPy-bundle', '2025.06'),
    ('networkx', '3.5'),
]

exts_list = [
    ('sympy', '1.14.0', {
        'source_urls': ['https://download.pytorch.org/whl'],
        'sources': [SOURCE_PY3_WHL],
        'checsums': ['e091cc3e99d2141a0ba2847328f5479b05d94a6635cb96148ccb3f34671bd8f5'],
    }),
    ('torch', version, {
        'source_urls': ['https://download.pytorch.org/whl/cu128'],
        'sources': [_torch_wheel_source[ARCH]],
        'checksums': [{
            'torch-2.9.1%2Bcu128-cp313-cp313-manylinux_2_28_aarch64.whl':
                '0b80b7555dcd0a75b7b06016991f01281a0bb078cf28fa2d1dfb949fad2fbd07',
            'torch-2.9.1%2Bcu128-cp313-cp313-manylinux_2_28_x86_64.whl':
                '63381a109a569b280ed3319da89d3afe5cf9ab5c879936382a212affb5c90552',
        }],
    }),
]

moduleclass = 'ai'
