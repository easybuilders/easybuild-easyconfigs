easyblock = 'PythonBundle'

name = 'PyTorch'
version = '2.9.0'

homepage = 'https://pytorch.org/'
description = """Tensors and Dynamic neural networks in Python with strong GPU acceleration.
PyTorch is a deep learning framework that puts Python first."""

toolchain = {'name': 'gcccoreflexiblas', 'version': '14.3.0-3.4.5'}

builddependencies = [
    ('binutils', '2.44'),
    ('CMake', '4.0.3'),
]

dependencies = [
    ('Python', '3.13.5'),
    ('CUDA', '13', '', SYSTEM),
    ('Python-bundle-PyPI', '2025.07'),
    ('networkx', '3.5'),
    ('sympy', '1.14.0'),
    ('opt-einsum', '3.4.0'),
]


# PyTorch on Grace Hopper nodes don't have the same wheels and most of the
# stuff is from the system
if ARCH == 'aarch64':
    exts_list = [
        ('torch', version, {
            'sources': ['%(name)s-%(version)s-cp313-cp313-manylinux_2_28_%(arch)s.whl'],
            'checksums': ['c30a17fc83eeab346913e237c64b15b5ba6407fff812f6c541e322e19bc9ea0e'],
        }),
    ]

else:
    exts_list = [
        ('nvidia_cusparselt_cu12', '0.7.1', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.whl',
            'checksums': ['f1bb701d6b930d5a7cea44c19ceb973311500847f81b634d802b7b539dc55623'],
        }),
        ('triton', '3.5.0', {
            'source_tmpl': '%(name)s-%(version)s-cp313-cp313-manylinux_2_27_%(arch)s.manylinux_2_28_%(arch)s.whl',
            'checksums': ['e6bb9aa5519c084a333acdba443789e50012a4b851cd486c54f0b8dc2a8d3a12'],
        }),
        ('nvidia_nvtx_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['5b17e2001cc0d751a5bc2c6ec6d26ad95913324a4adb86788c944f8ce9ba441f'],
        }),
        ('nvidia_nvshmem_cu12', '3.3.20', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['d00f26d3f9b2e3c3065be895e3059d6479ea5c638a3f38c9fec49b1b9dd7c1e5'],
        }),
        ('nvidia_nvjitlink_cu12', '12.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2010_%(arch)s.manylinux_2_12_%(arch)s.whl',
            'checksums': ['81ff63371a7ebd6e6451970684f916be2eab07321b73c9d244dc2b4da7f73b88'],
        }),
        ('nvidia_nccl_cu12', '2.27.5', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['ad730cf15cb5d25fe849c6e6ca9eb5b76db16a80f13f425ac68d8e2e55624457'],
        }),
        ('nvidia_curand_cu12', '10.3.9.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['b32331d4f4df5d6eefa0554c565b626c7216f87a06a4f56fab27c3b68a830ec9'],
        }),
        ('nvidia_cufile_cu12', '1.13.1.3', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['1d069003be650e131b21c932ec3d8969c1715379251f8d23a1860554b1cb24fc'],
        }),
        ('nvidia_cuda_runtime_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['adade8dcbd0edf427b7204d480d6066d33902cab2a4707dcfc48a2d0fd44ab90'],
        }),
        ('nvidia_cuda_nvrtc_cu12', '12.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2010_%(arch)s.manylinux_2_12_%(arch)s.whl',
            'checksums': ['a7756528852ef889772a84c6cd89d41dfa74667e24cca16bb31f8f061e3e9994'],
        }),
        ('nvidia_cuda_cupti_cu12', '12.8.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['ea0cb07ebda26bb9b29ba82cda34849e73c166c18162d3913575b0c9db9a6182'],
        }),
        ('nvidia_cublas_cu12', '12.8.4.1', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['8ac4e771d5a348c551b2a426eda6193c19aa630236b418086020df5ba9667142'],
        }),
        ('nvidia_cusparse_cu12', '12.5.8.93', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['1ec05d76bbbd8b61b06a80e1eaf8cf4959c3d4ce8e711b65ebd0443bb0ebb13b'],
        }),
        ('nvidia_cufft_cu12', '11.3.3.83', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux2014_%(arch)s.manylinux_2_17_%(arch)s.whl',
            'checksums': ['4d2dd21ec0b88cf61b62e6b43564355e5222e4a3fb394cac0db101f2dd0d4f74'],
        }),
        ('nvidia_cudnn_cu12', '9.10.2.21', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['949452be657fa16687d0930933f032835951ef0892b37d2d53824d1a84dc97a8'],
        }),
        ('nvidia_cusolver_cu12', '11.7.3.90', {
            'modulename': False,
            'source_tmpl': '%(name)s-%(version)s-py3-none-manylinux_2_27_%(arch)s.whl',
            'checksums': ['4376c11ad263152bd50ea295c05370360776f8c3427b30991df774f9fb26c450'],
        }),
        ('torch', '2.9.0', {
            'source_tmpl': '%(name)s-%(version)s-cp313-cp313-manylinux_2_28_x86_64.whl',
            'checksums': ['8f25033b8667b57857dfd01458fbf2a9e6a6df1f8def23aef0dc46292f6aa642'],
        }),
    ]

use_pip = True
sanity_pip_check = True

moduleclass = 'lib'
