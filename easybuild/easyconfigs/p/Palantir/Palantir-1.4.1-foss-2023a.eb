easyblock = 'PythonBundle'

name = 'Palantir'
version = '1.4.1'

homepage = 'https://github.com/dpeerlab/Palantir'
description = """Palantir is an algorithm to align cells along differentiation trajectories.
Palantir models differentiation as a stochastic process where stem cells differentiate to terminally
differentiated cells by a series of steps through a low dimensional phenotypic manifold.
Palantir effectively captures the continuity in cell states and the stochasticity in cell fate determination.
Palantir has been designed to work with multidimensional single cell data from diverse technologies such as
Mass cytometry and single cell RNA-seq."""

toolchain = {'name': 'foss', 'version': '2023a'}

dependencies = [
    ('Python', '3.11.3'),
    ('SciPy-bundle', '2023.07'),
    ('networkx', '3.1'),
    ('scikit-learn', '1.3.1'),
    ('matplotlib', '3.7.2'),
    ('anndata', '0.10.5.post1'),
    ('scanpy', '1.9.8'),
    ('ml_dtypes', '0.3.2'),
    ('python-igraph', '0.11.4'),
    ('jax', '0.4.25'),
]

# Relax Palantir dependency pins to allow older stack for foss/2023a (matplotlib/ml_dtypes/igraph)
local_preinstallopts = (
    "sed -i -e "
    "'s/matplotlib>=3.8.0/matplotlib/g' -e "
    "'s/ml_dtypes>=0.5.0/ml_dtypes/g' -e "
    "'s/igraph>=0.11.8/igraph/g' pyproject.toml && "
)

exts_list = [
    ('jaxopt', '0.8.5', {
        'checksums': ['2790bd68ef132b216c083a8bc7a2704eceb35a92c0fc0a1e652e79dfb1e9e9ab'],
    }),
    ('mellon', '1.6.1', {
        'checksums': ['0870ed10fd145c2b6b518cab7390de7f532cad127918d988f8febf81cfe069aa'],
    }),
    ('palantir', version, {
        'preinstallopts': local_preinstallopts,
        'checksums': ['ea54acc48b6e28b84187cb2b4416582eab3e4f75b434b0a191fc737e8f92e3ed'],
    }),
]

moduleclass = 'bio'
