easyblock = 'PythonBundle'

name = 'PyTorch-Lightning'
version = '1.6.5'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://pytorchlightning.ai'
description = "PyTorch Lightning is the lightweight PyTorch wrapper for ML researchers."

toolchain = {'name': 'foss', 'version': '2021a'}

dependencies = [
    ('CUDA', '11.3.1', '', True),
    ('Python', '3.9.5'),
    ('PyTorch', '1.11.0', versionsuffix),
    ('tqdm', '4.61.2'),
    ('tensorboard', '2.8.0'),
    ('typing-extensions', '4.3.0'),
]

# remove requirement for specific version of setuptools
local_preinstallopts = "sed -i 's/setuptools==.*/setuptools/g' requirements.txt && "
# loosen up strict version requirement for pyDeprecate
local_preinstallopts += "sed -i 's/pyDeprecate==/pyDeprecate>=/g' requirements.txt && "

exts_list = [
    ('fsspec', '2022.7.1', {
        'checksums': ['7f9fb19d811b027b97c4636c6073eb53bc4cbee2d3c4b33fa88b9f26906fd7d7'],
    }),
    ('pyDeprecate', '0.3.2', {
        'modulename': 'deprecate',
        'checksums': ['d481116cc5d7f6c473e7c4be820efdd9b90a16b594b350276e9e66a6cb5bdd29'],
    }),
     ('torchmetrics', '0.7.0', {
        'checksums': ['dbfb8989086f38020045a935e83928504e1af1d84ae92b073f6a83d018f4bc00'],
    }),
    ('pytorch-lightning', version, {
        'preinstallopts': "sed -i 's/setuptools==.*/setuptools/g' requirements.txt && ",
        'checksums': ['8d521f2619b9db2ada5bbaf9713330d01460e75a11e4bc0bc2ca25fd37c47c57'],
    }),
]

use_pip = True
sanity_pip_check = True

moduleclass = 'lib'
