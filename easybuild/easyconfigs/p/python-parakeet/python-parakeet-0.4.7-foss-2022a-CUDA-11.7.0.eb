# Thomas Hoffmann, EMBL Heidelberg, structures-it@embl.de, 2023/11
easyblock = 'PythonBundle'

name = 'python-parakeet'
version = '0.4.7'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://github.com/rosalindfranklininstitute/amplus-digital-twin'
description = """
Parakeet is a digital twin for cryo electron tomography and stands for Program  
for Analysis and Reconstruction of Artificial data for Kryo ElEctron Tomography.
"""

toolchain = {'name': 'foss', 'version': '2022a'}

builddependencies = [
    ('CMake', '3.24.3'),
    ('Ninja', '1.10.2'),
    ('pybind11', '2.9.2'),
]

dependencies = [
    ('CUDA', '11.7.0', '', SYSTEM),
    ('gemmi', '0.6.3'),
    ('mrcfile', '1.4.3'),
    ('h5py', '3.7.0'),
    ('SciPy-bundle', '2022.05'),
    ('PyYAML', '6.0'),
    ('dask', '2022.10.0'),
    ('matplotlib', '3.5.2'),
    ('networkx', '2.8.4'),
    ('imageio', '2.22.2'),
    ('scikit-image', '0.19.3'),
    ('BeautifulSoup', '4.10.0'),
    ('lxml', '4.9.1'),
    ('tqdm', '4.64.0'),
    ('starfile', '0.5.1'),
    ('pydantic', '1.10.4'),
]

use_pip = True
sanity_pip_check = True

exts_list = [
    ('guanaco', '0.3.0', {
        'checksums': ['9a174b4976c7823b21ba32c94d5df5205dc02fc7bb30a361c2100d9965551315'],
    }),
    ('maptools', '0.3.6', {
        'checksums': ['593fe379bb9eae385ed6a940d6129a4012b193b15112215f0e9a573e89edc6db'],
    }),
    ('python-multem', '0.3.4', {
        'modulename': 'multem',
        'checksums': ['01b99481fbb50c59f50f1c115dc2fc74121c978d41ff9cf0a408f57bd985bf1c'],
    }),
    ('pypdb', '2.3', {
        'checksums': ['a14aa2b5e5ece60552178fe3d35bdb0b38d6b0e9e7216bcc9c174386904c249f'],
    }),
    ('profet', '0.0.1', {
        'preinstallopts': 'sed -i "s/bs4/beautifulsoup4/g;" setup.cfg&&',
        'checksums': ['f6c69539cf35c1c2fac74d3dc58571b72368b721b17f22ea4a3f45ebd7053875'],
    }),
    ('requests-html', '0.10.0', {
        'preinstallopts': 'sed -i "s/bs4/beautifulsoup4/g;" setup.py&&',
        'checksums': ['7e929ecfed95fb1d0994bb368295d6d7c4d06b03fcb900c33d7d0b17e6003947'],
    }),
    ('fake-useragent', '1.3.0', {
        'modulename': 'fake_useragent',
        'checksums': ['0b3a223b4c03e3df46b0e9ff53ad26cf4690f68871396b9c59a7fa6ee830c395'],
    }),
    ('parse', '1.19.1', {
        'checksums': ['cc3a47236ff05da377617ddefa867b7ba983819c664e1afe46249e5b469be464'],
    }),
    ('websockets', '10.4', {
        'checksums': ['eef610b23933c54d5d921c92578ae5f89813438fded840c2e9809d378dc765d3'],
    }),
    ('pyee', '8.2.2', {
        'checksums': ['5c7e60f8df95710dbe17550e16ce0153f83990c00ef744841b43f371ed53ebea'],
    }),
    ('pyppeteer', '1.0.2', {
        'checksums': ['ddb0d15cb644720160d49abb1ad0d97e87a55581febf1b7531be9e983aad7742'],
    }),
    ('pyquery', '2.0.0', {
        'checksums': ['963e8d4e90262ff6d8dec072ea97285dc374a2f69cad7776f4082abcf6a1d8ae'],
    }),
    ('cssselect', '1.2.0', {
        'checksums': ['666b19839cfaddb9ce9d36bfe4c969132c647b92fc9088c4e23f786b30f1b3dc'],
    }),
    ('w3lib', '2.1.2', {
        'checksums': ['ed5b74e997eea2abe3c1321f916e344144ee8e9072a6f33463ee8e57f858a4b1'],
    }),
    (name, version, {
        'modulename': 'parakeet',
        'patches': ['python-parakeet-0.4.7_relax_requirements.patch'],
        'checksums': [
            {'python-parakeet-0.4.7.tar.gz': '3b9ec89e484be224614474c1e4bac9ace5c34bbb3ccba1e3d90a88961ff95dd1'},
            {'python-parakeet-0.4.7_relax_requirements.patch':
             '9e7ebb4b623b0da1ac705dcc617c322a1d15a6d7677b24f01a9a1e0d29ad72ca'},
        ],
    }),
]

sanity_check_commands = [
    'parakeet.config.show -h',
]

sanity_check_paths = {
    'files': ['bin/%s' % x for x in ['map', 'guanaco', 'parakeet.config.show']],
    'dirs': ['bin', 'lib']
}

moduleclass = 'bio'
