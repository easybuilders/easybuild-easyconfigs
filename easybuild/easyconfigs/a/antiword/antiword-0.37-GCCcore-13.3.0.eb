easyblock = 'ConfigureMake'

name = 'antiword'
version = '0.37'

homepage = 'https://savannah.nongnu.org/projects/attr'

description = """Commands for Manipulating Filesystem Extended Attributes"""

toolchain = {'name': 'GCCcore', 'version': '13.3.0'}

source_urls = ['https://fossies.org/linux/misc/old/']
sources = [SOURCE_TAR_GZ]
patches = ['%(namelower)s-%(version)s_fix-installdir.patch',
           '%(namelower)s-%(version)s_allow-custom-antiworddir.patch']
checksums = [
    {'antiword-0.37.tar.gz': '8e2c000fcbc6d641b0e6ff95e13c846da3ff31097801e86702124a206888f5ac'},
    {'antiword-0.37_fix-installdir.patch': '31dbcbe26d1471fc8fb0a71f084d6838788fcac00b033056463cb79f20fc9d55'},
    {'antiword-0.37_allow-custom-antiworddir.patch':
     'e515fbcf28a81f983238eb2fb27a81f22ceb9014d1a5582145a047cf93192f1c'},
]

builddependencies = [('binutils', '2.42')]

dependencies = [('Ghostscript', '10.03.1')]

skipsteps = ['configure']

buildopts = 'CFLAGS="-DNDEBUG -UANTIWORD_DIR -DANTIWORD_DIR=\\\\\\"%(installdir)s/.antiword\\\\\\""'

preinstallopts = 'INSTALLDIR=%(installdir)s '

# Executables are missing execute permission for others
postinstallcmds = ['chmod o+x %(installdir)s/bin/antiword',
                   'chmod o+x %(installdir)s/bin/kantiword',
                  ]

sanity_check_paths = {
    'files': ['bin/antiword'],
    'dirs': ['.antiword'],
}

sanity_check_commands = ["antiword -h"]

moduleclass = 'tools'
