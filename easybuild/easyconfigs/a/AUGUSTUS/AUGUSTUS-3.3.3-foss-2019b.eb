# Updated by: Pavel Grochal (INUITS)
# License: GPLv2

easyblock = 'ConfigureMake'

name = 'AUGUSTUS'
version = '3.3.3'

# HTTPS doesn't work
homepage = 'http://bioinf.uni-greifswald.de/augustus/'
description = "AUGUSTUS is a program that predicts genes in eukaryotic genomic sequences"

toolchain = {'name': 'foss', 'version': '2019b'}

# https://github.com/Gaius-Augustus/Augustus/archive
github_account = 'Gaius-Augustus'
source_urls = [GITHUB_SOURCE]
sources = ['v%(version)s.tar.gz']
patches = [
    '%(name)s-%(version)s_fix-hardcoding.patch',
]
checksums = [
    '2fc5f9fd2f0c3bba2924df42ffaf55b5c130228cea18efdb3b6dfab9efa8c9f4',  # v3.3.3.tar.gz
    '414907ab65cd27df33508f7d0c2fde4cc5e6ffd9fb7be9357d1488851e480e94',  # AUGUSTUS-3.3.3_fix-hardcoding.patch
]

dependencies = [
    ('zlib', '1.2.11'),
    ('Boost', '1.71.0'),
    ('GSL', '2.6'),
    ('SAMtools', '1.10'),
    ('HTSlib', '1.10.2'),  # also provides tabix
    ('BCFtools', '1.10.2'),
    ('lpsolve', '5.5.2.5'),
    ('SuiteSparse', '5.6.0', '-METIS-5.1.0'),
    ('BamTools', '2.5.1'),
    ('SQLite', '3.29.0'),
]

skipsteps = ['configure']

# run "make clean" to avoid using binaries included with the source tarball
prebuildopts = "make clean && "

buildopts = 'COMPGENEPRED=true SQLITE=true ZIPINPUT=true CXX="$CXX" LINK.cc="$CXX" '
installopts = 'INSTALLDIR=%(installdir)s '

sanity_check_paths = {
    'files': ['bin/augustus', 'bin/bam2hints', 'bin/espoca', 'bin/etraining',
              'bin/fastBlockSearch', 'bin/filterBam', 'bin/getSeq', 'bin/homGeneMapping', 'bin/joingenes',
              'bin/load2sqlitedb', 'bin/prepareAlign'],
    'dirs': ['config', 'scripts'],
}
sanity_check_commands = ['augustus --help']

modextrapaths = {'PATH': 'scripts'}
modextravars = {
    'AUGUSTUS_BIN_PATH': '%(installdir)s/bin',
    'AUGUSTUS_CONFIG_PATH': '%(installdir)s/config',
    'AUGUSTUS_SCRIPTS_PATH': '%(installdir)s/scripts',
}

moduleclass = 'bio'
