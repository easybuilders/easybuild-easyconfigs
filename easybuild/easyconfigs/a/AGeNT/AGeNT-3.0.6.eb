##
# This is a contribution from SIB Swiss Institute of Bioinformatics
# Homepage:     https://www.sib.swiss/research-infrastructure/competence-centers/vital-it
#
# Authors::     Sebastien Moretti <sebastien.moretti@sib.swiss>
#
##

# JAR files are in a subdirectory with other stuff, so use Binary
easyblock = 'Binary'

name = 'AGeNT'
version = '3.0.6'

homepage = 'https://www.agilent.com/en/product/next-generation-sequencing/'
homepage += 'hybridization-based-next-generation-sequencing-ngs/ngs-software/agent-232879'
description = """The Agilent Genomics NextGen Toolkit (AGeNT) is a Java-based software
module that processes the read sequences from targeted high-throughput sequencing data
generated by sequencing Agilent SureSelect and HaloPlex libraries.

The Trimmer utility of the AGeNT module processes the read sequences to identify and
remove the adaptor sequences and extracts dual molecular barcodes (for SureSelect XT HS2).

The LocatIt utility of the AGeNT module processes the Molecular Barcode (MBC) information
from HaloPlex HS, SureSelect XT HS, and SureSelect XT HS2 Illumina sequencing runs with
options to either mark or merge duplicate reads and output in BAM file format. The Illumina
InterOp libraries are a set of common routines used for reading InterOp metric files
produced by Illumina sequencers including NextSeq 1k/2k. These libraries are backwards
compatible and capable of supporting prior releases of the software, with one exception:
GA systems have been excluded."""

software_license = 'LicenseVeryRestrictive'
# For Research Use Only. Not for use in diagnostic procedures.

toolchain = SYSTEM

builddependencies = [
    ('UnZip', '6.0', '', ('GCCcore', '10.3.0')),
]
dependencies = [
    ('Java', '11'),
]

# Fill the form at https://explore.agilent.com/AGeNT-Software-Download-Form
# to get the zip file.
sources = ['AGeNT_%(version)s.zip']
checksums = ['746e4445567ee41b7ced5cab3cd252d27d8f6f9eab56766e5d7ca74894e3db73']

extract_sources = False

install_cmd = 'unzip ' + sources[0] + ' && '
install_cmd += 'cp -ar *.html *.md agent/* %(installdir)s/ && '
install_cmd += 'chmod -x %(installdir)s/*.txt && '
install_cmd += 'chmod -x %(installdir)s/*.md && '
install_cmd += 'rm -f %(installdir)s/*.cmd && '
install_cmd += 'rm -f %(installdir)s/*.html && '
install_cmd += 'mkdir %(installdir)s/bin && '
install_cmd += 'mv %(installdir)s/*.sh %(installdir)s/bin/ && '
install_cmd += 'ln -s ../lib %(installdir)s/bin/lib && '
install_cmd += 'sed -i "s@ lib/@ ../lib/@" %(installdir)s/bin/*.sh'

sanity_check_paths = {
    'files': ['bin/agent.sh'],
    'dirs': ['bin', 'lib']
}

sanity_check_commands = ["agent.sh"]

moduleclass = 'bio'
