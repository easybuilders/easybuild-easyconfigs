# Thomas Hoffmann, EMBL Heidelberg, structures-it@embl.de, 2024/12
#
# DRAFT!
easyblock = 'PythonBundle'

name = 'AlphaFold3'
version = '3.0.0'
versionsuffix = '-CUDA-%(cudaver)s'
homepage = 'https://deepmind.google/technologies/alphafold'
description = """This package provides an implementation of the inference pipeline of AlphaFold  
3. See below for how to access the model parameters. You may only use AlphaFold 
3 model parameters if received directly from Google. Use is subject to these    
terms of use: 
https://github.com/google-deepmind/alphafold3/blob/main/WEIGHTS_TERMS_OF_USE.md"""

toolchain = {'name': 'foss', 'version': '2024a'}

github_account = 'google-deepmind'
use_pip = True

builddependencies = [
    ('scikit-build', '0.17.6'),
    ('poetry', '1.8.3'),
    ('Python-bundle-PyPI', '2024.06'),
    ('scikit-build-core', '0.10.6'),
]

dependencies = [
    ('Python', '3.12.3'),
    ('CUDA', '12.6.0', '', SYSTEM),
    ('tqdm', '4.67.0'),
    ('jax', '0.4.35', versionsuffix),
    ('dm-tree', '0.1.8'),
    ('dm-haiku', '0.0.13', versionsuffix),
    ('RDKit', '2024.03.5'),
    ('jax-triton', '0.2.0', versionsuffix),
    # TODO
]

exts_list = [
    ('chex', '0.1.87', {
        'checksums': ['0096d89cc8d898bb521ef4bfbf5c24549022b0e5b301f529ab57238896fe6c5d'],
    }),
    (name, version, {
        'source_urls': ['https://github.com/%(github_account)s/%(name)s/archive'],
        'sources': ['v%(version)s.tar.gz'],
        # 'patches': ['%(name)s-%(versions)s_relax_requirements.patch']
        'checksums': ['f4fde43daf4cdf25e4da712f440b8aa8bd8798e2be936a254a562f6cb6eb32df'],
    }),
]

sanity_pip_check = True

sanity_check_paths = {
    'files': [],
    'dirs': ['lib'],
}

# sanity_check_cmds = []  # TODO

moduleclass = 'bio'
