#
# author: Benjamin P. Roberts (University of Auckland)
#
# based on work by Marios Constantinou (University of Cyprus)
#

name = 'Amber'
version = "12"

easyblock = 'Amber'

homepage = 'http://ambermd.org/amber.html'
description = """Amber (originally Assisted Model Building with Energy Refinement) is software for performing molecular dynamics and structure prediction."""

toolchain = {'name': 'ictce', 'version': '4.1.13'}
toolchainopts = {'openmp': False, 'usempi': True}
onlytcmod = True

sources = ['AmberTools13.tar.bz2', 'Amber12.tar.bz2']
patches = ['Amber-12-ictce-4.1.13.patch']

dependencies = [
    ('CUDA', '6.0.37', '', True), 
    ('netCDF', '4.1.3'),
    ('Python', '2.7.3'),
    ]

patchlevels = (0, 0)

preconfigopts = "unset LIBS && export MKL_HOME=$EBROOTIMKL && export CUDA_HOME=$EBROOTCUDA && "
configopts = "--with-netcdf $EBROOTNETCDF --with-python `which python` -static -noX11 intel"

prebuildopts = 'AMBERHOME="%(installdir)s/amber12"'
buildopts = "install"
parallel = 1
buildininstalldir = True

skipsteps = ['install']

# export MPI_HOME=$EBROOTIMPI && 

# Get a better list of files to copy
#files_to_copy = [(['exe/lmodprmtop', 'exe/sander.LES.MPI', 'exe/sander.MPI', 'exe/sander.PIMD.MPI'], 'bin')]

sanity_check_paths = {
	'files': ['amber12/bin/tleap', 'amber12/bin/sander', 'amber12/bin/pmemd'],
	'dirs': ["."]
}

moduleclass = 'chem'
