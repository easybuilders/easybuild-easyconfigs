easyblock = "CMakeMake"

name = "atl"
version = "2.2.1-20250806"

homepage = 'https://github.com/GTkorvo/atl'
description = """Libatl provides a library for the creation and manipulation of lists of
name/value pairs using an efficient binary representation. """

toolchain = {'name': 'GCCcore', 'version': '13.2.0'}

_commit = "1164aa031c067395a6b7ce99224bcc9ac1f9867f"
sources = [{
    'filename': f'{name}-{_commit[:8]}.tar.xz',
    'git_config': {
        'url': 'https://github.com/GTkorvo',
        'repo_name': name,
        'commit': _commit,
    }
}]
checksums = ['75e54143a909815b6391b2d171f03e650b05efd51908739444b8b69bd8920bf9']

builddependencies = [
    ('binutils', '2.40'),
    ('CMake', '3.27.6'),
]

_copts = ' '.join([
    '-DBUILD_TESTING=ON',
])
configopts = [
    _copts + ' -DBUILD_SHARED_LIBS=OFF',
    _copts + ' -DBUILD_SHARED_LIBS=ON',
]

runtest = 'test'

sanity_check_paths = {
    'files': [
        'bin/%(name)s-config',
        'include/%(name)s.h',
        'lib/lib%(name)s.a', f'lib/lib%(name)s.{SHLIB_EXT}',
        'lib/pkgconfig/%(name)s.pc',
    ],
    'dirs': ['lib/cmake/%(name)s']
}

moduleclass = 'lib'
