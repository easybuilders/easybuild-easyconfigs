easyblock = 'ConfigureMake'

name = 'AOCL-BLAS'
version = '5.0'
modaltsoftname = 'aocl-blascore'
hidden = True

homepage = 'https://github.com/amd/blis'
description = """AOCL-BLAS is AMD's optimized version of
                 BLAS targeted for AMD EPYC and Ryzen CPUs."""

toolchain = SYSTEM
source_urls = ['https://github.com/amd/blis/archive/']
sources = ['%(version)s.tar.gz']
patches = [
    'AOCL-BLAS-5.0_family-x86_64_v3.patch',
]
checksums = [
    '5abb34972b88b2839709d0af8785662bc651c7806ccfa41d386d93c900169bc2',
    # AOCL-BLAS-5.0_family-x86_64_v3.patch
    'a8641b063f8b7fbad3add3be3c940b1533a4139c3a90ab9b330248fb87991b67',
]

builddependencies = [
    ('GCCcore', '13.3.0'),
    ('Python', '3.11.5'),
    ('Perl', '5.38.2'),
]

local_configopts = '--enable-cblas --enable-threading=openmp --enable-shared CC=$CC x86_64_v3'
configopts = ['-i64 -b64 ' + local_configopts, local_configopts]
local_buildopts = 'CC="$CC -O2 -ftree-vectorize -march=x86-64-v3 -fno-math-errno"'
buildopts = ['LIBBLIS=libblis-mt64 ' + local_buildopts, local_buildopts]
installopts = buildopts

runtest = 'check'

sanity_check_paths = {
    'files': ['include/blis/cblas.h', 'include/blis/blis.h',
              'lib/libblis-mt64.a', 'lib/libblis-mt64.%s' % SHLIB_EXT,
              'lib/libblis-mt.a', 'lib/libblis-mt.%s' % SHLIB_EXT],
    'dirs': [],
}

modextrapaths = {'CPATH': 'include/blis'}

moduleclass = 'numlib'
