easyblock = 'CMakeMake'

name = 'NRGLjubljana'
version = '2020.09'

homepage = 'http://nrgljubljana.ijs.si/'
description = """
  NRG Ljubljana is an efficient implementation of the numerical renormalization group (NRG)
  technique for solving quantum impurity problems that arise as simplified models of
  magnetic impurities and as effective models in the dynamical mean field theory (DMFT)
  approach to bulk correlated materials.
"""

docurls = 'http://nrgljubljana.ijs.si/'
software_license = 'LicenseGPLv3'

toolchain = {'name': 'foss', 'version': '2020a'}
toolchainopts = {'pic': True, 'usempi': True}

source_urls = ['https://github.com/rokzitko/nrgljubljana/archive/']
sources = ['%(version)s.tar.gz']
checksums = ['5cece43164fda273c90e38e4da57a90be6cbb46768c50b1c01e76b38276e8e8c']

dependencies = [
    ('GMP', '6.2.0'),
    ('GSL', '2.6'),
    ('Boost', '1.72.0')
]

builddependencies = [
    ('CMake', '3.16.4')
]

separate_build_dir = True

configopts = "-DSYM_ALL=ON -DSYM_MORE=ON"

runtest = 'test'

sanity_check_paths = {
    'files': ['bin/nrg', 'bin/nrgcmpl', 'nrginit/nrginit', 'nrginit/nrginit.m', 'nrginit/sneg.m', 'nrginit/initial.m',
              'nrginit/initialparse.m', 'nrginit/models.m', 'nrginit/operators.m',
              'bin/adapt', 'bin/binavg', 'bin/broaden', 'bin/diag', 'bin/hilb', 'bin/integ',
              'bin/kk', 'bin/matrix', 'bin/mats', 'bin/nrgchain', 'bin/resample',
              'bin/specmoments', 'bin/tdavg', 'bin/unitary',
              'lib/libnrgljubljana_c.%s' % SHLIB_EXT, 'lib/libnrgljubljanacmpl_c.%s' % SHLIB_EXT],
    'dirs': ['bin', 'lib', 'nrginit', 'share'],
}

sanity_check_commands = [
    "nrg -h", "nrgcmpl -h", "nrginit -h", "adapt -h", "binavg -h", "broaden -h", "diag -h", "hilb -h", "integ -h",
    "kk -h", "matrix -h", "mats -h", "nrgchain -h", "resample -h", "specmoments -h", "tdavg -h", "unitary -h"
]

modextrapaths = {
    'PATH': 'nrginit',
}

moduleclass = 'phys'
