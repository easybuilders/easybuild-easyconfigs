name = 'NCL'
version = '6.6.2'

homepage = 'https://www.ncl.ucar.edu'
description = "NCL is an interpreted language designed specifically for scientific data analysis and visualization."

toolchain = {'name': 'intel', 'version': '2025b'}
toolchainopts = {
    'cstd': 'gnu89',
    'openmp': True,
    'pic': True,
    # The IFTRAN binary itself is being miscompiled at -O2 by ifx/icx, and then mis-parses its own IFTRAN input files,
    # producing bogus “invalid END IF” / “string-evaluation error” messages you can find in this log:
    # https://github.com/vscentrum/vsc-software-stack/blob/c0a6bdf853dda368e180698ff03c12fdb4162285/618_NCAR/log-opt1
    'lowopt': True,
    # Fixes compilation problems in eemd.c with cstd=gnu89
    'extra_cflags': '-Drestrict=__restrict__',
}

source_urls = ['https://github.com/NCAR/ncl/archive/']
sources = ['%(version)s.tar.gz']
patches = [
    'NCL-6.4.0_fix-types.patch',
    'NCL-6.6.2_header_and_operands.patch',
    'NCL-6.6.2_multiple_definitions.patch',
    'NCL-6.6.2_HDF5-110-API.patch',
    'NCL-6.6.2_g2clib-link.patch',
    'NCL-6.6.2_fix-missing-Copyright.patch',
    'NCL-6.6.2_eemd-compatibility-gnu89.patch',
    'NCL-6.6.2_fix-NetCDF4-log-level.patch',
    'NCL-6.6.2_PROJ-compatibility.patch',
    'NCL-6.6.2_oneAPI-comp-fix.patch',
    'NCL-6.6.2_hdf5-fix.patch',
    'NCL-6.6.2_fix-tcsh-invocation.patch',
]
checksums = [
    {'6.6.2.tar.gz': 'cad4ee47fbb744269146e64298f9efa206bc03e7b86671e9729d8986bb4bc30e'},
    {'NCL-6.4.0_fix-types.patch': 'f6dfaf95e5de9045745e122cb44f9c035f81fab92f5892991ddfe93945891c8f'},
    {'NCL-6.6.2_header_and_operands.patch': '5cb62d9a37de8af485b94487692f7e739ca5eb103a6b447e0290a68a6c094808'},
    {'NCL-6.6.2_multiple_definitions.patch': 'e21503dc46fe6fd360ba7ca4897aa93bf9ec2961bc48634ca46de582710448f7'},
    {'NCL-6.6.2_HDF5-110-API.patch': 'aaa3086411d40594db04f6c1800b89372d22e7bce0fb9bc1b8414f035158fe17'},
    {'NCL-6.6.2_g2clib-link.patch': '9eb7ee9ea314721e0ced93470b26cf7114cca2b3557d02fd1c34f8a9474a0d68'},
    {'NCL-6.6.2_fix-missing-Copyright.patch': 'e125f3af1a9a78388127215078538551b52153e564e2d316f815c6debf257248'},
    {'NCL-6.6.2_eemd-compatibility-gnu89.patch': 'f13ee79fb979467fc9f43ebe2c345b914b8fb5c0145c666bc4b0576ca77524c8'},
    {'NCL-6.6.2_fix-NetCDF4-log-level.patch': '6bfbfcc9898730f66b6a22f44112a210aef72ba091af4fa222675cd8d1af8e8a'},
    {'NCL-6.6.2_PROJ-compatibility.patch': '5ce206e5b9edab082a8e192f081faa82e4812ca2ba5ff065b72624be04bb5b83'},
    {'NCL-6.6.2_oneAPI-comp-fix.patch': '812f9056523777fa6d2f57c2f6d9d46a09269e7bded4ad0decbbbe0382184685'},
    {'NCL-6.6.2_hdf5-fix.patch': '63fcfb938a345edd5b23cf1e0b026fc095394d63a5818a194b52df9abeaddb69'},
    {'NCL-6.6.2_fix-tcsh-invocation.patch': '7f4c6083419720f6cbefb32f1dbe3196ca91dede8b37c99d646805ebf56adda4'},
]

builddependencies = [
    ('makedepend', '1.0.9'),
    ('Bison', '3.8.2'),
    ('flex', '2.6.4'),
    ('tcsh', '6.24.16'),
]
dependencies = [
    ('cURL', '8.14.1'),
    ('JasPer', '4.2.8'),
    ('g2lib', '4.0.0'),
    ('HDF5', '1.14.6'),
    ('HDF', '4.3.1'),
    ('netCDF', '4.9.3'),
    ('netCDF-Fortran', '4.6.2'),
    ('Szip', '2.1.1'),
    ('freetype', '2.13.3'),
    ('zlib', '1.3.1'),
    ('GDAL', '3.11.3'),
    ('UDUNITS', '2.2.28'),
    ('ESMF', '8.9.0'),
    ('bzip2', '1.0.8'),
    ('cairo', '1.18.4'),
    ('libiconv', '1.18'),
    ('GSL', '2.8'),
    ('libpng', '1.6.50'),
    ('libjpeg-turbo', '3.1.1'),
]

moduleclass = 'data'
