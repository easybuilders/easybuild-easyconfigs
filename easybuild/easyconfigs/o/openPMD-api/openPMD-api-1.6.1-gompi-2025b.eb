easyblock = 'CMakeMake'

name = 'openPMD-api'
version = '1.6.1'

homepage = 'https://github.com/openPMD/openPMD-api'
description = """This library provides a reference API for openPMD data handling.
Since openPMD is a schema (or markup) on top of portable, hierarchical file formats, this library implements various
backends such as HDF5, ADIOS2 and JSON. Writing & reading through those backends and their associated files are
supported for serial and MPI-parallel workflows."""

toolchain = {'name': 'gompi', 'version': '2025b'}

source_urls = ['https://github.com/openPMD/openPMD-api/archive/refs/tags/']
sources = ['%(version)s.tar.gz']

builddependencies = [
    ('binutils', '2.44'),
    ('CMake', '4.0.3'),
]

dependencies = [
    ('Python', '3.13.5'),
    ('pybind11', '3.0.0'),
    ('HDF5', '1.14.6'),
    ('netCDF', '4.9.3'),
    ('GLib', '2.85.3'),
    ('bzip2', '1.0.8'),
    ('ADIOS2', '2.10.2'),
]

configopts = ' '.join([
    '-DopenPMD_BUILD_TESTING=ON',
    '-DopenPMD_USE_MPI=ON',
    '-DopenPMD_USE_HDF5=ON',
    '-DopenPMD_USE_PYTHON=ON',
    '-DopenPMD_USE_ADIO2=ON',
])

sanity_check_paths = {
    'files': ['bin/openpmd'],
    'dirs': [],
}

sanity_check_commands = ['openpmd -h']

moduleclass = 'lib'
