easyblock = "CMakeMake"

name = "OpenMM-PLUMED"
version = "20180317"
cuda_ver = '9.2.148.1'
plumed_ver = '2.4.3'
openmm_ver = '7.2.2'
versionsuffix = '-OpenMM-%s-PLUMED-%s-Python-%%(pyver)s-CUDA-%s' % (openmm_ver, plumed_ver, cuda_ver)

homepage = 'https://github.com/peastman/openmm-plumed'
description = """OpenMM plugin to interface with PLUMED"""

toolchain = {'name': 'foss', 'version': '2018a'}
toolchainopts = {'opt': True}

source_urls = ['https://github.com/peastman/openmm-plumed/archive/']
sources = ['2c2c9d8484.tar.gz']
patches = ['%(name)s-%(version)s-fix-setup-py.patch']
checksums = [
    '387cd71973ac3075025a2cdebbfdd3ca148860175f495e68ce22ab9df57bff0c',  # 2c2c9d8484.tar.gz
    '0811551203745662a2433e9b9cafb4ee4bf4f4bc583e5c70ca554f6c4bdef032',  # OpenMM-PLUMED-20180317-fix-setup-py.patch
]

builddependencies = [
    ('CMake', '3.10.2'),
    ('SWIG', '3.0.12', '-Python-%(pyver)s'),
]

separate_build_dir = True

dependencies = [
    ('Python', '3.6.4'),
    ('CUDA', cuda_ver, '', True),
    ('OpenMM', openmm_ver, '-Python-%%(pyver)s-CUDA-%s' % cuda_ver),
    ('PLUMED', plumed_ver),
]

configopts = '-DOPENMM_DIR=$EBROOTOPENMM '
configopts += '-DPLUMED_LIBRARY_DIR=$EBROOTPLUMED/lib -DPLUMED_INCLUDE_DIR=$EBROOTPLUMED/include/plumed'

installopts = ' && make PythonInstall'

sanity_check_paths = {
    'files': ['lib/libOpenMMPlumed.so'],
    'dirs': ['include', 'lib/python%(pyshortver)s/site-packages']
}

modextrapaths = {
    'PYTHONPATH': 'lib/python%(pyshortver)s/site-packages',
}

moduleclass = 'bio'
