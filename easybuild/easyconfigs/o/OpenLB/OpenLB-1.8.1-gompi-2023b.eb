easyblock = 'MakeCp'

name = 'OpenLB'
version = '1.8.1'

homepage = 'https://www.openlb.net'
description = """The OpenLB project provides a C++ package for the implementation of lattice Boltzmann methods that is
general enough to address a vast range of transport problems, e.g. in computational fluid dynamics."""

examples = """Examples can be found on GitLab: https://gitlab.com/openlb/release/-/tree/master/examples
To compile a source file, you can use the example makefile provided in the installed $OLB_ROOT directory.
"""

toolchain = {'name': 'gompi', 'version': '2023b'}
toolchainopts = {'cstd': 'c++20', 'openmp': True}

source_urls = ['https://gitlab.com/openlb/release/-/archive/%(version)s']
sources = [SOURCELOWER_TAR_GZ]
patches = ['OpenLB-1.8.1-makefiles.patch', 'OpenLB-1.8.1-config-cpu.patch']
checksums = [
    {'openlb-1.8.1.tar.gz': 'a7d36abf456db1fbead65f1ab6dbbca79c5c792100bd111f91467daf8f33f035'},
    {'OpenLB-1.8.1-makefiles.patch': '7d393c2a4310db41d0a7f2a8d9e9dcf87d6f69cf2a418803567c4623b9a5201b'},
    {'OpenLB-1.8.1-config-cpu.patch': 'd8ad7c78a5a935da97b58062fd9290ecd68b0755b5f3dc44a810bab1d5fbe721'},
]

dependencies = [
    ('tinyxml2', '10.0.0'),
    ('zlib', '1.2.13'),
]

files_to_copy = [
    'lib',
    (['src/*'], 'include'),
    'config.mk',
    'default.mk',
    'default.single.mk',
    # 'default.mixed.mk',  # only for GPU builds
    'example.Makefile',
    'rules.mk',
]

sanity_check_paths = {
    'files': ['lib/libolbcore.a', f'lib/libolbcore.{SHLIB_EXT}'],
    'dirs': ['lib']
}

modextravars = {'OLB_ROOT': '%(installdir)s'}
moduleclass = 'phys'
