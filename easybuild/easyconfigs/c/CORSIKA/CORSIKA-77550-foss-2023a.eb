easyblock = "ConfigureMake"

name = 'CORSIKA'
version = '77550'

homepage = "https://www.iap.kit.edu/corsika"
description = """CORSIKA (COsmic Ray SImulations for KAscade) is a program for detailed
simulation of extensive air showers initiated by high energy cosmic ray
particles. Protons, light nuclei up to iron, photons, and many other particles
may be treated as primaries."""

toolchain = {'name': 'foss', 'version': '2023a'}
toolchainopts = {'usempi': True}

download_instructions = "Sources have to be requested to the developers"
sources = [SOURCELOWER_TAR_GZ]
checksums = ['fed74c144e22deb5a7c1d2dc1f04f0100eb2732cb48665a3da49ce471a3775ee']

dependencies = [
    ("ROOT", "6.30.06"),
]

# custom coconut script does not recognize -j
parallel = False

# execute ./coconut manually with your own options and extract configure command from top of config.log
configopts = "CORDETECTOR=HORIZONTAL CORTIMELIB=TIMEAUTO CORHEMODEL=QGSJETII CORLEMODEL=URQMD "
configopts += "--enable-UPWARD --enable-SLANT --enable-THIN --enable-COREAS "
configopts += "--enable-PARALLEL --with-mpirunner-lib --enable-PARALLELIB "

build_cmd = "./coconut"
buildopts = "--batch"

preinstallopts = "mkdir -p %(installdir)s/bin && "
install_cmd = "cp"
installopts = "%(builddir)s/%(namelower)s-%(version)s/run/%(namelower)s%(version)s* %(installdir)s/bin/"

sanity_check_paths = {
    'files': ['bin/corsika77550Linux_QGSII_urqmd_thin_coreas_parallel'],
    'dirs': []
}

moduleclass = "phys"
