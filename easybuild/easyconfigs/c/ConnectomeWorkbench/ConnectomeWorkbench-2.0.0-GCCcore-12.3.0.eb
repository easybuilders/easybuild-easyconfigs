easyblock = 'CMakeMake'

name = 'ConnectomeWorkbench'
version = '2.0.0'

homepage = 'https://www.humanconnectome.org/software/connectome-workbench'
description = """Connectome Workbench is an open source, freely available visualization
 and discovery tool used to map neuroimaging data, especially data generated by the
 Human Connectome Project."""

toolchain = {'name': 'GCCcore', 'version': '12.3.0'}

source_urls = ['https://github.com/Washington-University/workbench/archive']
sources = ['v%(version)s.tar.gz']
checksums = ['2d5a2603a1acb4fabc2b66fab3a8257f05ccd1705cf7f39681be5ff86169dfcf']

builddependencies = [
    ('binutils', '2.40'),
    ('CMake', '3.26.3'),
]

dependencies = [
    ('Qt5', '5.15.10'),
    ('Mesa', '23.1.4'),
]

start_dir = 'src'

configopts = '-DWORKBENCH_MESA_DIR=${EBROOTMESA} '
configopts += '-DWORKBENCH_USE_QT5=TRUE -DWORKBENCH_USE_QT5_QOPENGL_WIDGET=TRUE -Wno-dev '

# It is necessary to deactivate the SIMD optimization in order to build
# kloewe/dot correctly. This should not affect the overall optimization since
# compiler flags are passed by EB via CFLAGS and CXXFLAGS.
# See https://github.com/Washington-University/workbench/issues/34
configopts += '-DWORKBENCH_USE_SIMD=FALSE '

runtest = "test"

sanity_check_paths = {
    'files': ['bin/wb_command', 'bin/wb_shortcuts', 'bin/wb_view'],
    'dirs': ['share'],
}

sanity_check_commands = ['wb_command -help']

moduleclass = 'bio'
