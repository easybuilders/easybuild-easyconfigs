##
# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild
#
# Copyright:: Copyright 2013-2015 Dmitri Gribenko, Ward Poelmans
# Authors:: Dmitri Gribenko <gribozavr@gmail.com>
# Authors:: Ward Poelmans <wpoely86@gmail.com>
# License:: GPLv2 or later, MIT, three-clause BSD.
# $Id$
##

name = 'Clang'
version = '12.0.0'

homepage = 'https://clang.llvm.org/'
description = """C, C++, Objective-C compiler, based on LLVM.  Does not
 include C++ standard library -- use libstdc++ from GCC."""

# Clang also depends on libstdc++ during runtime, but this dependency is
# already specified as the toolchain.
toolchain = {'name': 'GCCcore', 'version': '10.3.0'}

source_urls = ["https://github.com/llvm/llvm-project/releases/download/llvmorg-%(version)s"]
sources = [
    'llvm-%(version)s.src.tar.xz',
    'clang-%(version)s.src.tar.xz',
    'compiler-rt-%(version)s.src.tar.xz',
    'polly-%(version)s.src.tar.xz',
    'openmp-%(version)s.src.tar.xz',
    # Also include the LLVM linker
    'lld-%(version)s.src.tar.xz',
    'libcxx-%(version)s.src.tar.xz',
    'libcxxabi-%(version)s.src.tar.xz',
    'clang-tools-extra-%(version)s.src.tar.xz',
]
checksums = [
    '49dc47c8697a1a0abd4ee51629a696d7bfe803662f2a7252a3b16fc75f3a8b50',  # llvm-12.0.0.src.tar.xz
    'e26e452e91d4542da3ebbf404f024d3e1cbf103f4cd110c26bf0a19621cca9ed',  # clang-12.0.0.src.tar.xz
    '85a8cd0a62413eaa0457d8d02f8edac38c4dc0c96c00b09dc550260c23268434',  # compiler-rt-12.0.0.src.tar.xz
    '0d9afc76b262f89d0fc6cb4f155ad25be5bf0554d14f96208ec81a51a44fb4c7',  # polly-12.0.0.src.tar.xz
    'eb1b7022a247332114985ed155a8fb632c28ce7c35a476e2c0caf865150f167d',  # openmp-12.0.0.src.tar.xz
    '2cb7d497f3ce33ce8a2c50ad26ec93a8c45f57268d4d96953cd0f25566f753fd',  # lld-12.0.0.src.tar.xz
    '7dcb75ca4f6aae2c677d128460c48a57398c8b6791b77b74bea7cf9e04e7c3f1',  # libcxx-12.0.0.src.tar.xz
    '6ab8e8cd148a7d5103067e05c36e36ef36e27634fc8e73b5712853c9affe75b1',  # libcxxabi-12.0.0.src.tar.xz
    'ad41e0b527a65ade95c1ba690a5434cefaab4a2daa1be307caaa1e8541fe6d5c',  # clang-tools-extra-12.0.0.src.tar.xz
]

dependencies = [
    # since Clang is a compiler, binutils is a runtime dependency too
    ('binutils', '2.36.1'),
    ('hwloc', '2.4.1'),
    ('libxml2', '2.9.10'),
    ('ncurses', '6.2'),
    ('GMP', '6.2.1'),
    ('Z3', '4.8.11'),
]

builddependencies = [
    ('CMake', '3.20.1'),
    ('Python', '3.9.5'),
    ('elfutils', '0.185'),
]

assertions = True
usepolly = True
build_lld = True
libcxx = True
enable_rtti = True
build_extra_clang_tools = True

skip_all_tests = True

moduleclass = 'compiler'
