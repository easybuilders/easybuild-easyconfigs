##
# This file is an EasyBuild reciPY as per https://github.com/easybuilders/easybuild
#
# Copyright:: Copyright 2013-2015 Dmitri Gribenko, Ward Poelmans
# Authors:: Dmitri Gribenko <gribozavr@gmail.com>
# Authors:: Ward Poelmans <wpoely86@gmail.com>
# License:: GPLv2 or later, MIT, three-clause BSD.
# $Id$
##

name = 'Clang'
version = '6.0.0'

gccver = '7.3.0'
binutilsver = '2.30'
cudaver = '9.1.85'
versionsuffix = '-GCC-%s-CUDA-%s' % (gccver, cudaver)

homepage = 'http://clang.llvm.org/'
description = """C, C++, Objective-C compiler, based on LLVM.  Does not 
 include C++ standard library -- use libstdc++ from GCC."""

# Clang also depends on libstdc++ during runtime
toolchain = {'name': 'GCCcore', 'version': gccver}
# Do not set optarch to True: it will cause the build to fail
toolchainopts = {'optarch': False}

source_urls = ["http://llvm.org/releases/%(version)s"]
sources = [ 
    'llvm-%(version)s.src.tar.xz',
    'cfe-%(version)s.src.tar.xz',
    'compiler-rt-%(version)s.src.tar.xz',
    'polly-%(version)s.src.tar.xz',
    'openmp-%(version)s.src.tar.xz',
]

patches = ['polly-6.0.0-failing-tests.patch']

dependencies = [
    ('GCCcore', gccver, '', True),
    ('binutils', binutilsver, '', ('GCCcore', gccver)),
    ('GMP', '6.1.2'),
    ('CUDA', cudaver, '', True),
]

builddependencies = [
    ('CMake', '3.11.4'),
    ('Python', '2.7.15', '-bare'),
    ('libxml2', '2.9.8'),
]

assertions = True

usepolly = True
configopts = '-DPOLLY_ENABLE_GPGPU_CODEGEN:Bool=ON'

# Build capability to target GPUs
build_targets = ['X86', 'NVPTX']

moduleclass = 'compiler'

