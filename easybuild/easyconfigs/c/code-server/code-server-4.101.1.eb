name = 'code-server'
version = '4.101.1'

homepage = 'https://github.com/coder/code-server'
description = "Run VS Code on any machine anywhere and access it in the browser."

toolchain = {'name': 'system', 'version': 'system'}

source_urls = [
        'https://github.com/coder/%(name)s/releases/download/v%(version)s/',
]
sources = ['%(name)s-%(version)s-linux-%(mapped_arch)s.tar.gz']
patches = ['code-server-env-variables.patch']

postinstallcmds = [
    'mkdir %(installdir)s/extensions/foxundermoon.shell-format-7.0.1/bin; pushd %(installdir)s/extensions/foxundermoon.shell-format-7.0.1/bin; wget https://github.com/mvdan/sh/releases/download/v3.0.1/shfmt_v3.0.1_linux_amd64; chmod +x shfmt_v3.0.1_linux_amd64; popd',
    'chmod go+rX -R %(installdir)s/extensions',
    '/cvmfs/soft.computecanada.ca/easybuild/bin/setrpaths.sh --path %(installdir)s --add_origin ',
]
exts_defaultclass = 'VSCodeExtension'
exts_default_options = {
  'source_tmpl': '%(name)s-%(version)s.vsix'
}


exts_list = [
    ('nsight-vscode-edition', '2024.1.34572442', {
        'source_urls': ['https://marketplace.visualstudio.com/_apis/public/gallery/publishers/NVIDIA/vsextensions'],
        'sources': [{'filename': '%(name)s-%(version)s.vsix.gz', 'download_filename': '%(name)s/%(version)s/vspackage'}],
    }),
    ('ms-python.python', '2025.4.0', {
        'source_urls': ['https://open-vsx.org/api/ms-python/python/%(version)s/file'],
    }),
    ('hashicorp.terraform', '2.34.5', {
        'source_urls': ['https://open-vsx.org/api/hashicorp/terraform/linux-x64/%(version)s/file'],
        'sources': ['%(name)s-%(version)s@linux-x64.vsix']
    }),
    ('ms-vscode.cmake-tools', '1.20.53', {
        'source_urls': ['https://open-vsx.org/api/ms-vscode/cmake-tools/%(version)s/file/'],
    }),
    ('ms-vscode.cpptools-themes', '1.0.0', {
        'source_urls': ['https://open-vsx.org/api/ms-vscode/cpptools-themes/%(version)s/file'],
    }),
    ('ms-vscode.makefile-tools', '0.12.17', {
        'source_urls': ['https://open-vsx.org/api/ms-vscode/makefile-tools/%(version)s/file'],
     }),
    ('redhat.vscode-yaml', '1.18.0', {
        'source_urls': ['https://open-vsx.org/api/redhat/vscode-yaml/%(version)s/file'],
    }),
    ('puppet.puppet-vscode', '1.5.5', {
        'source_urls': ['https://open-vsx.org/api/puppet/puppet-vscode/%(version)s/file'],
    }), 
    ('DavidAnson.vscode-markdownlint', '0.60.0', {
        'source_urls': ['https://open-vsx.org/api/DavidAnson/vscode-markdownlint/%(version)s/file'],
    }),
    ('foxundermoon.shell-format', '7.0.1', {
        'source_urls': ['https://open-vsx.org/api/foxundermoon/shell-format/%(version)s/file'],
    }),
    ('mechatroner.rainbow-csv', '3.3.0', {
        'source_urls': ['https://open-vsx.org/api/mechatroner/rainbow-csv/%(version)s/file'],
    }),
    ('oderwat.indent-rainbow', '8.3.1', {
        'source_urls': ['https://open-vsx.org/api/oderwat/indent-rainbow/%(version)s/file']
    }),
    ('eamodio.gitlens', '2025.6.2505', {
        'source_urls': ['https://open-vsx.org/api/eamodio/gitlens/%(version)s/file']
    }),
    ('ms-toolsai.jupyter', '2025.5.0', {
        'source_urls': ['https://open-vsx.org/api/ms-toolsai/jupyter/%(version)s/file']
    }),
    ('GitHub.vscode-pull-request-github', '0.112.0', {
        'source_urls': ['https://open-vsx.org/api/GitHub/vscode-pull-request-github/%(version)s/file']
    }),
    ('ms-python.debugpy', '2025.6.0', {
        'source_urls': ['https://open-vsx.org/api/ms-python/debugpy/linux-x64/%(version)s/file'],
        'sources': ['%(name)s-%(version)s@linux-x64.vsix']
    }),
    ('ms-python.pylint', '2024.2.0', {
        'source_urls': ['https://open-vsx.org/api/ms-python/pylint/%(version)s/file'],
    }),
# requires installing additional stuff    
#    ('golang.Go', '0.46.1', {
#        'source_urls': ['https://open-vsx.org/api/golang/Go/%(version)s/file'],
#    }),
# requires installing additional stuff    
    ('julialang.language-julia', '1.146.2', {
        'source_urls': ['https://open-vsx.org/api/julialang/language-julia/%(version)s/file'],
    }),
    ('redhat.vscode-xml', '0.29.2025051008', {
        'source_urls': ['https://open-vsx.org/api/redhat/vscode-xml/linux-x64/%(version)s/file'],
        'sources': ['%(name)s-%(version)s@linux-x64.vsix']
    }),
    ('rust-lang.rust-analyzer', '0.4.2512', {
        'source_urls': ['https://open-vsx.org/api/rust-lang/rust-analyzer/linux-x64/%(version)s/file'],
        'sources': ['%(name)s-%(version)s@linux-x64.vsix']
    }),
    ('MS-CEINTL.vscode-language-pack-fr', '1.101.0', {
        'source_urls': ['https://open-vsx.org/api/MS-CEINTL/vscode-language-pack-fr/%(version)s/file'],
    }),
    ('redhat.ansible', '25.4.0', {
        'source_urls': ['https://open-vsx.org/api/redhat/ansible/%(version)s/file'],
    }),
]

modextravars = {
    'CODESERVER_EXTENSIONS_DIR': "%(installdir)s/extensions"
}
moduleclass = 'tools'
