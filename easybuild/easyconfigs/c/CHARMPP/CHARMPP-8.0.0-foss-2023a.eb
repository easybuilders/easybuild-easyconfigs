easyblock = 'ConfigureMake'

name = 'CHARMPP'
version = '8.0.0'
homepage = 'https://charmplusplus.org/tutorial/'

description = """Charm++ is a message-passing parallel language and runtime system. 
It is implemented as a set of libraries for C++. 
It is efficient, and is portable to a wide variety of parallel machines. 
Source code is provided, and non-commercial use is free."""

toolchain = {'name': 'foss', 'version': '2023a'}
toolchainopts = {'usempi': True, 'openmp': False, 'pic': True}

source_urls = ['http://charm.cs.illinois.edu/distrib/']
sources = ['charm-%(version)s.tar.gz']
checksums = ['e30fc1e921e5cbf3406e792d5b0ca5f211c5d8ffbfc56e56d5501d8118abcaf6']

dependencies = [
    ('CMake', '3.26.3'),
    ('Tcl', '8.6.13'),
    ('FFTW', '3.3.10'),
]

configure_without_installdir="TRUE"

configure_cmd =' '

build_cmd ='export MPICXX=mpicxx ; ./build charm++ mpi-linux-x86_64 mpicxx --with-production --force '

install_cmd = 'mkdir  %(installdir)s/bin %(installdir)s/include %(installdir)s/lib'
install_cmd += '; cp -R bin/*     %(installdir)s/bin '
install_cmd += '; cp -R include/* %(installdir)s/include '
install_cmd += '; cp -R lib/*     %(installdir)s/lib'

sanity_check_paths = {
    'files': ['bin/charmc', 'bin/charmrun', 'bin/charmxi', 'bin/ckhello', 'bin/conv-cpm', 'bin/testrun'],
    'dirs': ['bin', 'lib'],
}

moduleclass = 'math'
