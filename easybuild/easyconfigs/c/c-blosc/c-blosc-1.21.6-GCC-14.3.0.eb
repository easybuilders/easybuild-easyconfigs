easyblock = "CMakeMake"

name = "c-blosc"
version = "1.21.6"

homepage = 'https://github.com/Blosc/c-blosc'
description = """Blosc is a high performance compressor optimized for binary
data. It has been designed to transmit data to the processor cache faster than
the traditional, non-compressed, direct memory fetch approach via a memcpy() OS
 call. Blosc is the first compressor (that I'm aware of) that is meant not
only to reduce the size of large datasets on-disk or in-memory, but also to
accelerate memory-bound computations.
"""

toolchain = {'name': 'GCC', 'version': '14.3.0'}

source_urls = ['https://github.com/Blosc/c-blosc/archive/refs/tags/']
sources = ['v%(version)s.tar.gz']
checksums = ['9fcd60301aae28f97f1301b735f966cc19e7c49b6b4321b839b4579a0c156f38']

builddependencies = [
    ('CMake', '4.0.3'),
]

dependencies = [
    ('zstd', '1.5.7'),
    ('lz4', '1.10.0'),
    ('zlib', '1.3.1'),
]

configopts = ' '.join([
    '-DCMAKE_POLICY_VERSION_MINIMUM=3.5',
    '-DPREFER_EXTERNAL_ZLIB=ON',
    '-DPREFER_EXTERNAL_ZLIB=ON',
    '-DPREFER_EXTERNAL_ZSTD=ON',
    '-DPREFER_EXTERNAL_LZ4=ON',
    '-DBUILD_BENCHMARK=OFF',
])

runtest = True

sanity_check_paths = {
    'files': ['include/blosc.h', 'include/blosc-export.h', 'lib/libblosc.a', f'lib/libblosc.{SHLIB_EXT}'],
    'dirs': ['include', 'lib']
}

moduleclass = 'lib'
