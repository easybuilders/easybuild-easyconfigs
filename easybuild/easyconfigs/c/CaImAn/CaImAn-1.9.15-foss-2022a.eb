easyblock = 'PythonBundle'

name = 'CaImAn'
version = '1.9.15'

homepage = 'https://github.com/flatironinstitute/CaImAn/'
description = """A Computational toolbox for large scale Calcium Imaging data Analysis and behavioral analysis."""


toolchain = {'name': 'foss', 'version': '2022a'}

dependencies = [
        ('bokeh', '2.4.3'),
        ('Cython', '0.29.33'),
        ('h5py', '3.7.0'),
        ('Qtconsole', '5.4.0'),
        ('JupyterLab', '3.5.0'),
        ('matplotlib', '3.5.2'),
        ('OpenCV', '4.6.0', '-contrib'),
        ('PyQtGraph', '0.13.3'),
        ('scikit-image', '0.19.3'),
        ('scikit-learn', '1.1.2'),
        ('Tk', '8.6.12'),
        ('tqdm', '4.64.0'),
        ('SciPy-bundle', '2022.05'),
        ('TensorFlow', '2.11.0'),
        ('ruamel.yaml', '0.17.21'),

]

use_pip = True
sanity_pip_check = True

exts_list = [
    ('ipyparallel', '8.3.0', {
            'checksums': ['275d6d0c89c812679f0addc6a399bd75384bdf199ade12922d2ab3e2f7a99dc1'],
    }),
    ('yapf', '0.31.0', { #not latest as it requires newer platformdirs that requires hatchling
            'checksums': ['408fb9a2b254c302f49db83c59f9aa0b4b0fd0ec25be3a5c51181327922ff63d'],
    }),
    ('tornado', '6.1', { #not latest as this thing needs <=6.3
            'checksums': ['33c6e81d7bd55b468d2e793517c909b139960b6c790a60b7991b9b6b76fb9791'],
    }),
    ('coverage', '7.3.0', {
            'checksums': ['49dbb19cdcafc130f597d9e04a29d0a032ceedf729e41b181f51cd170e6ee865'],
    }),
    ('pyct', '0.5.0', {
            'checksums': ['dd9f4ac5cbd8e37c352c04036062d3c5f67efec76d404761ef16b0cbf26aa6a0'],
    }),
    ('param', '1.13.0', {
            'checksums': ['59d55048d42a85e148a69837df42bd11c3391d47fad15ba57d118e145f001ef2'],
    }),
    ('colorcet', '3.0.1', {
            'checksums': ['51455a20353d12fac91f953772d8409f2474e6a0db1af3fa4f7005f405a2480b'],
    }),
    ('pyviz-comms', '2.2.1', { #not latest as that would require hatchling
            'sources': [{'download_filename': 'pyviz_comms-%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
            'checksums': ['a26145b8ce43d2d934b3c6826d77b913ce105c528eb2e494c890b3e3525ddf33'],
    }),
    ('panel', '0.14.4', {
            'checksums': ['b853d2f53d7738ec6372525360c5bf9427a71ed990685ccac703bc9b442e9951'],
    }),
    ('holoviews', '1.17.1', {
            'checksums': ['ca30c661508b22e9e8c119dbc3e4a5d851987b43c30565db180b291d8fd770a4'],
    }),
    ('mypy-extensions', '1.0.0', {
            'sources': [{'download_filename': 'mypy_extensions-%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
            'checksums': ['75dbf8955dc00442a438fc4d0666508a9a97b6bd41aa2f0ffe9d2f2725af0782'],
    }),
    ('mypy', '1.5.1', {
            'checksums': ['b031b9601f1060bf1281feab89697324726ba0c0bae9d7cd7ab4b690940f0b92'],
    }),
    ('numpydoc', '1.5.0', {
            'checksums': ['b0db7b75a32367a0e25c23b397842c65e344a1206524d16c8069f0a1c91b5f4c'],
    }),
    ('PeakUtils', '1.3.4', {
            'checksums': ['8920426a39424ea9f025cd76a0c19150107143670bea47e4935d4435f65e6370'],
    }),
    ('slicerator', '1.1.0', {
            'checksums': ['44010a7f5cd87680c07213b5cabe81d1fb71252962943e5373ee7d14605d6046'],
    }),
    ('PIMS', '0.6.1', {
            'checksums': ['e2b704461d4ea9bce8b6a22ca35836fe67d6d34537736b405341ae5547194f3b'],
    }),
    ('hdmf', '3.5.0', {
            'checksums': ['640f559e5f4b0cc42beb30044a2db7f7603e9e40a39e3eb7d603711036775541'],
    }),
    ('pynwb', '2.2.0', {
            'checksums': ['7a1a08688237cd7ff41daa43b625903b3068f7327a928d379b1c43bbdf37555d'],
    }),
    ('tifffile', '2023.8.30', {
            'checksums': ['6a8c53b012a286b75d09a1498ab32f202f24cc6270a105b5d5911dc4426f162a'],
    }),
    ('importlib-metadata', '6.8.0', {
            'sources': [{'download_filename': 'importlib_metadata-%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
            'checksum': ['dbace7892d8c0c4ac1ad096662232f831d4e64f4c4545bd53016a3e9d4654743'],
    }),
    (name, version, {
            'source_urls':  ['https://github.com/flatironinstitute/CaImAn/archive/refs/tags/'],
            'sources': [{'download_filename': 'v%(version)s.tar.gz', 'filename': '%(name)s-%(version)s.tar.gz'}],
            'checksums': ['a6ab15ff5349b9dedd9db96583911c440a7e3eb21008d51e9934b11558b3f285'],
    }),
]

sanity_check_paths = {
        'files': ['bin/caimanmanager.py', 'share/caiman/bin/caiman_gui.py'],
        'dirs': ['bin', 'share/caiman'],
}

moduleclass = 'bio'
