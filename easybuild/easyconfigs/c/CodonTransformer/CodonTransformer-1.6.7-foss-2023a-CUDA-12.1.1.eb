easyblock = 'PythonBundle'

name = 'CodonTransformer'
version = '1.6.7'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = "https://adibvafa.github.io/CodonTransformer/"
description = """
CodonTransformer: The ultimate tool for codon optimization, optimizing DNA sequences for
heterologous protein expression across 164 species.
"""

toolchain = {'name': 'foss', 'version': '2023a'}

dependencies = [
    ('CUDA', '12.1.1', '', SYSTEM),
    ('Python', '3.11.3'),
    ('Biopython', '1.83'),
    ('SciPy-bundle', '2023.07'),
    ('ONNX-Runtime', '1.19.2', versionsuffix),
    ('scikit-learn', '1.3.1'),
    ('tqdm', '4.66.1'),
    ('Transformers', '4.39.3'),
    ('jupyter-server', '2.7.2'),  # for ipywidgets
    ('PyTorch-Lightning', '2.2.1', versionsuffix),
]

# CAI-PyPI needs a README and requirements.txt or will get "FileNotFoundError" error
_fix_CAI_PyPI = """touch README.md && touch requirements.txt && """

# Revert back to old license syntax
_fix_python_codon_tables = """sed -i 's/license = "CC0-1.0"/license = {text = "CC0-1.0"}/g' pyproject.toml && """

exts_list = [
    ('typing-extensions', '4.9.0', {
        'source_tmpl': 'typing_extensions-%(version)s.tar.gz',
        'checksums': ['23478f88c37f27d76ac8aee6c905017a143b0b1b886c3c9f66bc2fd94f9f5783'],
    }),
    ('CAI-PyPI', '2.0.1', {
        'modulename': 'CAI',
        'preinstallopts': _fix_CAI_PyPI,
        'checksums': ['88c2340f8a30579fb9c48708c7bda32516abd05d2be71a57e382a4b82c92010a'],
    }),
    ('python-codon-tables', '0.1.18', {
        'modulename': 'python_codon_tables',
        'preinstallopts': _fix_python_codon_tables,
        'source_tmpl': 'python_codon_tables-%(version)s.tar.gz',
        'checksums': ['73f552980ad292afb8e8bcd6debf824041b59b0a7cec009b67b11690c3863907'],
    }),
]

moduleclass = 'bio'
