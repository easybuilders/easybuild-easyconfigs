easyblock = 'CMakeMake'

name = 'CGNS'
version = "4.5.0"

homepage = 'https://cgns.github.io/'
description = """The CGNS system is designed to facilitate the exchange of data between sites and applications,
 and to help stabilize the archiving of aerodynamic data."""

toolchain = {'name': 'gompi', 'version': '2023a'}
toolchainopts = {'pic': True, 'usempi': True}

source_urls = ['https://github.com/%(name)s/%(name)s/archive/']
sources = ['v%(version)s.tar.gz']
checksums = ['c72355219318755ba0a8646a8e56ee1c138cf909c1d738d258d2774fa4b529e9']

builddependencies = [
    ('CMake', '3.31.1'),
]
dependencies = [
   ('HDF5', '1.14.4', '-mpi'),
]

configopts  = " ".join([
    "-DCMAKE_SKIP_RPATH=ON",
    "-DCGNS_BUILD_CGNSTOOLS=OFF",
    "-DCGNS_ENABLE_TESTS=OFF",
    "-DCGNS_ENABLE_FORTRAN=ON",
    "-DCGNS_ENABLE_HDF5=ON",
    "-DCGNS_ENABLE_PARALLEL=ON",
    "-DCGNS_ENABLE_SCOPING=OFF", # Must be off for 3-party lib to build on
    "-DHDF5_DIR=$EBROOTHDF5",
    "-DHDF5_NEED_MPI=ON",
    "-DHDF5_NEED_SZIP=ON",
    "-DHDF5_NEED_ZLIB=ON",
    "-DSZIP_LIBRARY=$EBROOTGENTOO/lib64/libsz.so",
    "-DZLIB_LIBRARY=$EBROOTGENTOO/lib64/libz.so",
])

sanity_check_paths = {
    'files': ['bin/cgnscheck', 'bin/cgnscompress', 'bin/cgnsconvert', 'bin/cgnsdiff', 'bin/cgnslist', 'bin/cgnsnames', 'bin/cgnsupdate'],
    'dirs': [],
}

moduleclass = 'cae'
