easyblock = 'ConfigureMake'

name = 'darshan'
version = '3.2.1'

homepage = 'https://www.mcs.anl.gov/research/projects/darshan/'
description = """Darshan, a scalable HPC I/O characterization tool. Darshan is 
designed to capture an accurate picture of application I/O behavior, including 
properties such as patterns of access within files, with minimum overhead.  
The name is taken from a Sanskrit word for 'sight' or 'vision'."""

toolchain = {'name': 'gompi', 'version': '2020a'}
toolchainopts = {'usempi': True, 'pic': True}

source_urls = ['ftp://ftp.mcs.anl.gov/pub/%(name)s/releases']
sources = [SOURCE_TAR_GZ]
checksums = ['d63048b7a3d1c4de939875943e3e7a2468a9034fcb68585edbc87f57f622e7f7']

preconfigopts = [
    "cd %(name)s-runtime && ",
    "cd %(name)s-util && ",
]

# adjust mem-align (default=8), jobid-env, log-path to your needs
configopts = "--with-mem-align=8 --with-jobid-env=SLURM_JOBID  --with-log-path-by-env=DARSHAN_LOG_PATH "

prebuildopts = [
    "cd %(name)s-runtime && ",
    "cd %(name)s-util && ",
]

preinstallopts = [
    "cd %(name)s-runtime && ",
    "cd %(name)s-util && ",
]


modextravars = {'DARSHAN_LOG_PATH': '\\$HOME/%(name)s'}

moduleclass = 'tools'
