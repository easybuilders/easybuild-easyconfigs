easyblock = 'CMakeMake'

name = 'DualSPHysics'
version = '5.0.233'

homepage = 'https://dual.sphysics.org/'

description = """
DualSPHysics is based on the Smoothed Particle Hydrodynamics model named SPHysics.

The code is developed to study free-surface flow phenomena where Eulerian methods
can be difficult to apply, such as waves or impact of dam-breaks on off-shore
structures. DualSPHysics is a set of C++, CUDA and Java codes designed to deal
with real-life engineering problems.
"""

toolchain = {'name': 'GCC', 'version': '11.3.0'}

source_urls = ['https://github.com/DualSPHysics/DualSPHysics/archive/refs/tags/']
sources = ['v%(version)s.tar.gz']
patches = ['%(name)s-5.0.175.patch']
checksums = [
    '660a67dc8deed7a38f63e6f462071cbb980e268296f12a5c182aad85b4c0e9e9',
    '24ae21134099252a597d80f25cf835dd981d0f085ce33dc801e70f1d7e045829',
]

srcdir = 'src/source'

builddependencies = [
    ('CMake', '3.23.1'),
]

separate_build_dir = True

buildopts = " && chmod +x %(builddir)s/%(name)s-%(version)s/bin/linux/*_linux64"

install_cmd = """mkdir -p %(installdir)s/bin &&
              cp -r %(builddir)s/%(name)s-%(version)s/bin/linux/* %(installdir)s/bin &&
              cp -r %(builddir)s/%(name)s-%(version)s/src/lib/linux_gcc %(installdir)s/lib"""


sanity_check_paths = {
    'files': [
        'bin/GenCase_linux64',
        'bin/PartVTK_linux64',
        'bin/IsoSurface_linux64',
        'bin/MeasureTool_linux64',
        'bin/GenCase_MkWord_linux64',
        'bin/DualSPHysics4.0_LiquidGas_linux64',
        'bin/DualSPHysics4.0_LiquidGasCPU_linux64',
        'bin/DualSPHysics5.0_linux64',
        'bin/DualSPHysics5.0CPU_linux64',
        'bin/DualSPHysics5.0_NNewtonian_linux64',
        'bin/DualSPHysics5.0_NNewtonianCPU_linux64',
    ],
    'dirs': ["lib", "bin"],
}

moduleclass = 'cae'
