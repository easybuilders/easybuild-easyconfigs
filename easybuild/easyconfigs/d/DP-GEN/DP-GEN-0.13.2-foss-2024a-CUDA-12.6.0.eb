easyblock = 'PythonBundle'

name = 'DP-GEN'
version = '0.13.2'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://github.com/deepmodeling/deepmd-kit/'
description = "A deep learning package for many-body potential energy representation and molecular dynamics."

toolchain = {'name': 'foss', 'version': '2024a'}

builddependencies = [
    ('Cython', '3.0.10'),
    ('Eigen', '3.4.0'),
    ('scikit-build-core', '0.10.6'),
    ('SWIG', '4.2.1'),
]
dependencies = [
    ('ASE', '3.23.0'),
    ('cp2k-input-tools', '0.9.1'),
    ('CUDA', '12.6.0', '', SYSTEM),
    ('DeePMD-kit', '3.1.1', versionsuffix),
    ('h5py', '3.12.1'),
    ('matplotlib', '3.9.2'),
    ('netcdf4-python', '1.7.1.post2'),
    ('OpenBabel', '3.1.1'),  # Use module instead of openbabel-wheel
    ('pymatgen', '2025.6.14'),
    ('Python', '3.12.3'),
    ('scikit-image', '0.25.0'),
    ('SciPy-bundle', '2024.05'),
]

exts_list = [
    ('pycp2k', '0.2.2', {
        'checksums': ['460291dcf01a8f042e61bfbfa1526255877a6ef67242acc27b7eec2d8909839d'],
    }),
    ('asciichartpy', '1.5.25', {
        'source_tmpl': '%(name)s-%(version)s-py2.py3-none-any.whl',
        'checksums': ['33c417a3c8ef7d0a11b98eb9ea6dd9b2c1b17559e539b207a17d26d4302d0258'],
    }),
    ('cp2kdata', '0.7.3', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['79e4197a81021b9861e7aae25fed7f9051f9dcf29bd6c52fb6a48d646d31e5f4'],
    }),
    ('custodian', '2025.10.11', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['3a69b381f9f2b8e32f41ec85a9336388bcfb0700fb35137eeab6bf7061cf1450'],
    }),
    ('numkit', '1.3.1', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['ce8a0864ed2ac382502bf208fe83fba50b373ba2a765427c21552b9a5736dce9'],
    }),
    ('gromacswrapper', '0.9.2', {
        'modulename': 'gromacs',
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['d20ba450fc970595ea3fc83de899cb4c450fb4739ea182c5a56c2edcb80535b8'],
    }),
    ('dpdispatcher', '1.0.0', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['56e461c5f7162bfd779190bae07f5e563632dd78513070c3a493aa2ae87539ba'],
    }),
    ('mp_pyrho', '0.5.1', {
        'modulename': 'pyrho',
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['934d90c6be35eeccc6b0d550771410b0801dbf4488aca96517f958b5045dd161'],
    }),
    ('pymatgen_analysis_defects', '2024.7.19', {
        'modulename': 'pymatgen.analysis.defects',
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['185ae1246df39ee9c7475986ae5ea4ff7582f97edea4d5762248d3dcc82e0628'],
    }),
    ('dpgen', version, {
        'preinstallopts': """sed -i "/'openbabel-wheel',/d" pyproject.toml && """,
        'checksums': ['318379dbe7f429de7ab26fa78671bed621d9fe55f82ba5afc0984ade2237b0da'],
    }),
]

sanity_check_paths = {
    'files': ['bin/dpgen', 'bin/dpdisp'],
    'dirs': ['lib/python%(pyshortver)s/site-packages'],
}

sanity_check_commands = ['dpgen -h']

modloadmsg = """
Since DeePMD-kit is built with the PyTorch backend, you must set:
    train_backend: "pytorch"
as a run parameter if training of the model was done with DeePMD-kit.
"""

moduleclass = 'ai'
