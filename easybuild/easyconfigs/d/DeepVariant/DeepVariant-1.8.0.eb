# Digital Research Alliance of Canada - Calcul Québec - Université Laval

easyblock = 'Apptainer'

name = 'DeepVariant'
version = '1.8.0'

homepage = 'https://github.com/google/deepvariant'
description = """DeepVariant is a deep learning-based variant caller that takes aligned reads (in BAM or CRAM format), produces pileup image tensors from them, classifies each tensor using a convolutional neural network, and finally reports the results in a standard VCF or gVCF file.

DeepVariant supports germline variant-calling in diploid organisms."""

toolchain = SYSTEM
dependencies = [('Apptainer', '1')]

installopts = '-s google/deepvariant '
installopts += '-i image '
installopts += '-n %(namelower)s '
installopts += '-v %(version)s '

container_path = '/cvmfs/containers.computecanada.ca/content/containers/%(namelower)s-%(version)s'
aliases = ["run_deepvariant"]
apptainer_params = '-e'

sanity_check_paths = {
    'files': ["opt/deepvariant/bin/run_deepvariant"],
    'dirs': ["opt/deepvariant/bin"],
}

modloadmsg = """To run deepvaraint execute
run_deepvariant --model_type=WGS \
  --ref=$INPUT_DIR/my_ref.fasta \
  --reads=$INPUT_DIR/my_sample.bam \
  --regions "chrxx:1,000-10,010,000"\
  --output_vcf=${OUTPUT_DIR}/output.vcf.gz \
  --output_gvcf=${OUTPUT_DIR}/output.g.vcf.gz \
  --num_shards=$(nproc) \
  --intermediate_results_dir "${OUTPUT_DIR}/intermediate_results_dir" \
  --vcf_stats_report=true"""
moduleclass = 'bio'
