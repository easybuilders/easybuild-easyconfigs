# Loosely based on PR #7680 
# Scikit-image is added as an extension to avoid problems with imageio,
# which comes in from MoviePy 
# J. Sassmannshausen (Imperial College London/UK)

easyblock = 'PythonBundle'

name = 'DeepLabCut'
version = '2.2.0.6'
versionsuffix = '-CUDA-%(cudaver)s'
local_version = '%(versionsuffix)s-contrib'

homepage = 'http://www.mousemotorlab.org/deeplabcut'
description = "Markerless tracking of user-defined features with deep learning"

toolchain = {'name': 'foss', 'version': '2021a'}
toolchainopts = {'pic': True}

dependencies = [
    ('CUDA', '11.3.1', '', True),
    ('cuDNN', '8.2.1.32', '-CUDA-%(cudaver)s', True),
    ('Python', '3.9.5'),
    ('h5py', '3.2.1'),
    ('IPython', '7.25.0'),
    ('scikit-learn', '0.24.2'),
    ('TensorFlow', '2.6.0', versionsuffix),
    ('PyYAML', '5.4.1'),
    ('PyTables', '3.6.1'),
    ('wxPython', '4.1.1'),
    ('OpenCV', '4.5.3', local_version),
    ('numba', '0.53.1'),
    ('libyaml', '0.2.5'),
    ('imgaug', '0.4.0', versionsuffix),
    ('tqdm', '4.61.2'),
    ('ruamel.yaml', '0.17.21'),
    ('statsmodels', '0.12.2'),
    ('PyTorch', '1.10.0', versionsuffix),
    ('MoviePy', '1.0.3'),
]

sanity_pip_check = True
use_pip = True

exts_list = [
    ('filterpy', '1.4.5', {
        'sources': ['%(name)s-%(version)s.zip'],
        'checksums': ['4f2a4d39e4ea601b9ab42b2db08b5918a9538c168cff1c6895ae26646f3d73b1'],
    }),
    ('tensorpack', '0.11', {
        'checksums': ['022b610e416e62e3575424cd08e60af27808a5fb6914294615391caf582cbd4f'],
    }),
    ('tf_slim', '1.1.0', {
        'source_urls': ['https://github.com/google-research/tf-slim/archive'],
        'sources': ['v%(version)s.tar.gz'],
        'checksums': ['964cde4b7728a408dcd5c841ab6b93d95137ab4b60db28b10400f86286bfeb8b'],
    }),
    ('msgpack-numpy', '0.4.8', {
        'checksums': ['c667d3180513422f9c7545be5eec5d296dcbb357e06f72ed39cc683797556e69'],
        'sources': ['msgpack-numpy-0.4.8.tar.gz'],
    }),

    # this is for scikit-image
    ('PyWavelets', '1.1.1', {
        'modulename': 'pywt',
        'checksums': ['1a64b40f6acb4ffbaccce0545d7fc641744f95351f62e4c6aaa40549326008c9'],
    }),
    ('imread', '0.7.4', {
        'checksums': ['0487adef11a22168700968c1727020361a72f6132b6ced2b8826b02d8cbf744f'],
    }),
    ('pooch', '1.5.2', {
        'checksums': ['5969b2f1defbdc405df932767e05e0b536e2771c27f1f95d7f260bc99bf13581'],
    }),
    ('tifffile', '2021.10.12', {
        'checksums': ['0a78268a2d844af94929512d28b39bd1ea6fe46de4124103840b5fe4e1c555cd'],
    }),
    ('scikit-image', '0.18.1', {
        'modulename': 'skimage',
        'patches': ['scikit-image-0.18.1_fix-README-cache-perms.patch'],
        'checksums': [
            'fbb618ca911867bce45574c1639618cdfb5d94e207432b19bc19563d80d2f171',  # scikit-image-0.18.1.tar.gz
            # scikit-image-0.18.1_fix-README-cache-perms.patch
            '3a941401231403808963d488aaf498a712c428c3b19a1752652be9972d82b7b8',
        ],
    }),
    # end of scikit-image

    (name, version, {
        'source_tmpl': '%(namelower)s-%(version)s.tar.gz',
        'checksums': ['4aa6694201e2aa56b9bd3e97ab27b0bc54f1364303167216174d2376d8ae0f84'],
    }),
]

moduleclass = 'lib'
