# Loosely based on PR #7680  
# J. Sassmannshausen (Imperial College London/UK)

easyblock = 'PythonBundle'

name = 'DeepLabCut'
version = '2.3.1'
versionsuffix = '-CUDA-%(cudaver)s'
local_version = '%(versionsuffix)s-contrib'

homepage = 'http://www.mousemotorlab.org/deeplabcut'
description = "Markerless tracking of user-defined features with deep learning"

toolchain = {'name': 'foss', 'version': '2021b'}
toolchainopts = {'pic': True}

builddependencies = [
    ('pkgconf', '1.8.0'),
]

dependencies = [
    ('CUDA', '11.4.1', '', SYSTEM),
    ('cuDNN', '8.2.2.26', '-CUDA-%(cudaver)s', SYSTEM),
    ('Python', '3.9.6'),
    ('h5py', '3.6.0'),
    ('IPython', '7.26.0'),
    ('scikit-learn', '1.0.2'),
    ('scikit-image', '0.19.1'),
    ('TensorFlow', '2.7.1', versionsuffix),
    ('PyYAML', '5.4.1'),
    ('wxPython', '4.2.0'),
    ('OpenCV', '4.5.5', local_version),
    ('numba', '0.54.1'),
    ('libyaml', '0.2.5'),
    ('imgaug', '0.4.0', versionsuffix),
    ('tqdm', '4.62.3'),
    ('ruamel.yaml', '0.17.21'),
    ('statsmodels', '0.13.1'),
    ('PyTorch', '1.11.0', versionsuffix),
    ('MoviePy', '1.0.3'),
    ('SciPy-bundle', '2021.10'),
    ('HDF5', '1.12.1'),
    ('LZO', '2.10'),
    ('Blosc', '1.21.1'),
    ('py-cpuinfo', '9.0.0'),
    ('PyTables', '3.8.0'),
]

sanity_pip_check = True
use_pip = True

exts_list = [
    ('filterpy', '1.4.5', {
        'sources': ['%(name)s-%(version)s.zip'],
        'checksums': ['4f2a4d39e4ea601b9ab42b2db08b5918a9538c168cff1c6895ae26646f3d73b1'],
    }),
    ('tensorpack', '0.11', {
        'checksums': ['022b610e416e62e3575424cd08e60af27808a5fb6914294615391caf582cbd4f'],
    }),
    ('tf_slim', '1.1.0', {
        'source_urls': ['https://github.com/google-research/tf-slim/archive'],
        'sources': ['v%(version)s.tar.gz'],
        'checksums': ['964cde4b7728a408dcd5c841ab6b93d95137ab4b60db28b10400f86286bfeb8b'],
    }),
    ('msgpack-numpy', '0.4.8', {
        'sources': ['msgpack-numpy-0.4.8.tar.gz'],
        'checksums': ['c667d3180513422f9c7545be5eec5d296dcbb357e06f72ed39cc683797556e69'],
    }),
    ('dlclibrary', '0.0.2', {
        'checksums': ['f6f27b4586b5adf70cc87f0020f41171d6e08cd85697d5cef71e51e100fe0542'],
    }),
    ('huggingface-hub', '0.13.2', {
        'sources': ['huggingface_hub-%(version)s.tar.gz'],
        'checksums': ['246e8eb39b6e6e9d9d5846e4b56c265cdf1872f48ba5a13a1321295d371626f5'],
    }),
    (name, version, {
        'source_tmpl': '%(namelower)s-%(version)s.tar.gz',
        'checksums': ['f514b9c6c067244d6fc6644f474a69045a707db5d65c3a0d63b90ca08e0c7cda'],
    }),
]

moduleclass = 'lib'
