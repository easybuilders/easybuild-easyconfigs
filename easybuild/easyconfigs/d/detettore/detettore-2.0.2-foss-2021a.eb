# This file is an EasyBuild reciPY as per https://github.com/hpcugent/easybuild
# Author: Iñaki Mtz de Ilarduya Muñoz
# sciCORE - University of Basel
# SIB Swiss Institute of Bioinformatics

easyblock = 'PythonBundle'

name = 'detettore'
version = '2.0.2'

homepage = 'https://github.com/cstritt/detettore'
description = """A program to detect transposable element polymorphisms"""

toolchain = {'name': 'foss', 'version': '2021a'}

builddependencies = [
    ('hypothesis', '6.13.1'),
]

dependencies = [
    ('Python', '3.9.5'),
    ('minimap2', '2.20'),
    ('Pysam', '0.17.0'),
    ('Biopython', '1.79'),
    ('LLVM', '11.1.0'),
]

use_pip = True
download_dep_fail = True
sanity_pip_check = True

local_llvmlite_preinstallopts = "export LLVM_CONFIG=${EBROOTLLVM}/bin/llvm-config && "
local_llvmlite_preinstallopts += "export LLVMLITE_SKIP_LLVM_VERSION_CHECK=1 && "

exts_list = [
    ('numpy', '1.21.1', {
        'sources': ['%(name)s-%(version)s.zip'],
        'checksums': ['dff4af63638afcc57a3dfb9e4b26d434a7a602d225b42d746ea7fe2edf1342fd'],
    }),
    ('ply', '3.11', {
        'checksums': ['00c7c1aaa88358b9c765b6d3000c6eec0ba42abca5351b095321aef446081da3'],
    }),
    ('gast', '0.5.2', {
        'checksums': ['f81fcefa8b982624a31c9e4ec7761325a88a0eba60d36d1da90e47f8fe3c67f7'],
    }),
    ('beniget', '0.4.1', {
        'checksums': ['75554b3b8ad0553ce2f607627dad3d95c60c441189875b98e097528f8e23ac0c'],
    }),
    ('pythran', '0.10.0', {
        'checksums': ['9dac8e1d50f33d4676003e350b1f0c878ce113e6f907920e92dc103352cac5bf'],
    }),
    ('scipy', '1.7.1', {
        'checksums': ['6b47d5fa7ea651054362561a28b1ccc8da9368a39514c1bbf6c0977a1c376764'],
    }),
    ('llvmlite', '0.36.0', {
        'patches': ['llvmlite-0.36.0_fix-LLVM-11.patch'],
        'preinstallopts': local_llvmlite_preinstallopts,
        'checksums': [
            '765128fdf5f149ed0b889ffbe2b05eb1717f8e20a5c87fa2b4018fbcce0fcfc9',  # llvmlite-0.36.0.tar.gz
            '17ebf3e8eaea2dd820bf4e089983d5743656613eb6313c1ffed30c58e8d66be4',  # llvmlite-0.36.0_fix-LLVM-11.patch
        ],
    }),
    ('numba', '0.53.1', {
        'source_urls': ['https://pypi.python.org/packages/source/n/numba'],
        'checksums': ['9cd4e5216acdc66c4e9dab2dfd22ddb5bef151185c070d4a3cd8e78638aff5b0'],
    }),
    (name, version, {
        'source_urls': ['https://pypi.python.org/packages/source/d/detettore'],
        'checksums': ['7f290c99f65a49a27d6f2468b05706ea9191af105e758875c22e432533a94218'],
    }),
]

sanity_check_paths = {
    'files': ['bin/detettore'],
    'dirs': ['lib/python%(pyshortver)s/site-packages'],
}

sanity_check_commands = [
    'detettore --help',
]

moduleclass = 'bio'
