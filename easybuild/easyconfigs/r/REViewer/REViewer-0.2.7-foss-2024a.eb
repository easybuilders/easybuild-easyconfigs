easyblock = 'CMakeMake'

name = 'REViewer'
version = '0.2.7'
toolchain = {'name': 'foss', 'version': '2024a'}
toolchainopts = {'pic': True, 'cstd': 'c++14'}

homepage = 'https://github.com/Illumina/REViewer'
description = """REViewer is a tool for visualizing alignments of reads in regions containing tandem repeats. REViewer
requires a BAMlet with graph-realigned reads generated by ExpansionHunter and the corresponding variant catalog."""

source_urls = ['https://github.com/Illumina/REViewer/archive/refs/tags']
sources = ['v%(version)s.tar.gz']
patches = [
    'REViewer-0.2.7_GraphCoordinates_cpp.patch',
    ('REViewer-0.2.7_graph-tools_CMakeLists.patch', 'reviewer/thirdparty/graph-tools'),
    ('REViewer-0.2.7_reviewer_CMakeLists.txt.patch', 'reviewer')
]
checksums = [
    {
        'v0.2.7.tar.gz':
        '8411c40028907b0294b1899cd20af6934325796da160511b649044ecf9a5169f'
    },
    {
        'REViewer-0.2.7_GraphCoordinates_cpp.patch':
        '39b37b42fbabc5dd6206f62fc9c9e3ead329b3f33fb27a72ecffca681b2fe9fc'
    },
    {
        'REViewer-0.2.7_graph-tools_CMakeLists.patch':
        'e29c6b03612d3ff213668af58e7ae3c118e432db93d832ef222f5a9748f25cd2'
    },
    {
        'REViewer-0.2.7_reviewer_CMakeLists.txt.patch':
        '576652d85bb828271e6c27a3d4750a5049163a5262e10666759f2e12da93c9e4'
    },
]

builddependencies = [
    ('CMake', '3.29.3'),
]

# Dependencies based on reviewer/CMakeLists.txt
dependencies = [
    ('Boost', '1.85.0'),
    ('HTSlib', '1.21'),
    ('zlib', '1.3.1'),
    ('bzip2', '1.0.8'),
    ('XZ', '5.4.5'),  # Provides liblzma
    ('spdlog', '1.12.0'),
    ('Catch2', '2.13.10'),
    ('cURL', '8.7.1'),
    ('OpenSSL', '3', '', SYSTEM),
]

start_dir = 'reviewer'

configopts = "-DCMAKE_EXE_LINKER_FLAGS='-L$EBROOTOPENSSL -lssl -lcrypto'"

sanity_check_paths = {
    'files': ['bin/REViewer'],
    'dirs': [],
}

sanity_check_commands = ["REViewer --version", "REViewer --help"]

moduleclass = 'bio'
