Adjust the "Running" window layout for better Slurm submit file generation.
This is a site specific patch for HPC2N but should be usable as a guide for
other sites requirements.

Ã…ke Sandgren, 20190510
diff -ru relion-3.0.5.orig/src/gui_entries.h relion-3.0.5/src/gui_entries.h
--- relion-3.0.5.orig/src/gui_entries.h	2019-05-07 12:53:25.000000000 +0200
+++ relion-3.0.5/src/gui_entries.h	2019-05-10 11:17:30.479081149 +0200
@@ -82,10 +82,10 @@
 #define MENUHEIGHT 30
 #define TABHEIGHT 25
 #define GUIWIDTH 800
-#define GUIHEIGHT_OLD 420+GUIEXTRA
-#define GUIHEIGHT_EXT_START 370+GUIEXTRA
+#define GUIHEIGHT_OLD 440+GUIEXTRA
+#define GUIHEIGHT_EXT_START 390+GUIEXTRA
 #define GUIHEIGHT_EXT_START2 (GUIHEIGHT_EXT_START+MENUHEIGHT+10)
-#define GUIHEIGHT_EXT 800+GUIEXTRA
+#define GUIHEIGHT_EXT 820+GUIEXTRA
 #define XCOL0 200
 #define WCOL0 200
 #define XCOL1 ( (XCOL0) + 10  )
diff -ru relion-3.0.5.orig/src/gui_jobwindow.cpp relion-3.0.5/src/gui_jobwindow.cpp
--- relion-3.0.5.orig/src/gui_jobwindow.cpp	2019-05-07 12:53:25.000000000 +0200
+++ relion-3.0.5/src/gui_jobwindow.cpp	2019-05-10 22:30:37.163918841 +0200
@@ -240,9 +240,14 @@
 
 	queue_group->begin();
 
+        place("qsub");
 	place("queuename");
 
-	place("qsub");
+	place("account");
+	place("timelimit");
+	place("gputype");
+	place("ngpu");
+	place("extrasbatch");
 
 	char * extra_count_text = getenv ("RELION_QSUB_EXTRA_COUNT");
 	const char extra_count_val = (extra_count_text ? atoi(extra_count_text) : 2);
diff -ru relion-3.0.5.orig/src/pipeline_jobs.cpp relion-3.0.5/src/pipeline_jobs.cpp
--- relion-3.0.5.orig/src/pipeline_jobs.cpp	2019-05-07 12:53:25.000000000 +0200
+++ relion-3.0.5/src/pipeline_jobs.cpp	2019-05-11 15:23:09.341930500 +0200
@@ -455,7 +455,30 @@
 		replacing["XXXnameXXX"] = outputname;
 		replacing["XXXerrfileXXX"] = outputname + "run.err";
 		replacing["XXXoutfileXXX"] = outputname + "run.out";
-		replacing["XXXqueueXXX"] = joboptions["queuename"].getString();
+                if (!joboptions["queuename"].getString().empty()) {
+                    replacing["XXXqueueXXX"] = "-p " + joboptions["queuename"].getString();
+                } else {
+                    replacing["XXXqueueXXX"] = "";
+                }
+                if (!joboptions["account"].getString().empty()) {
+                    replacing["XXXaccountXXX"] = "-A " + joboptions["account"].getString();
+                } else {
+                    replacing["XXXaccountXXX"] = "";
+                }
+                if (!joboptions["timelimit"].getString().empty()) {
+                    replacing["XXXtimelimitXXX"] = "-t " + joboptions["timelimit"].getString();
+                } else {
+                    replacing["XXXtimelimitXXX"] = "";
+                }
+                if (!joboptions["gputype"].getString().empty()) {
+                    replacing["XXXgpuspecXXX"] = "--gres=gpu:" + joboptions["gputype"].getString();
+                    if (!joboptions["ngpu"].getString().empty()) {
+                        replacing["XXXgpuspecXXX"] += ":" + joboptions["ngpu"].getString();
+                    }
+                } else {
+                    replacing["XXXgpuspecXXX"] = "";
+                }
+                replacing["XXXextrasbatchXXX"] = joboptions["extrasbatch"].getString();
 		char * extra_count_text = getenv ("RELION_QSUB_EXTRA_COUNT");
 		const char extra_count_val = (extra_count_text ? atoi(extra_count_text) : 2);
 		for (int i=1; i<=extra_count_val; i++)
@@ -795,6 +818,25 @@
 Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
 (or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
 
+	joboptions["account"] = JobOption("Account:", std::string(""), "SNIC Account (project id).\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
+	joboptions["timelimit"] = JobOption("Timelimit - format days-hh:mm:ss:", std::string(""), "Timelimit requested for the job.\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
+	joboptions["gputype"] = JobOption("GPU type - k80 or v100:", std::string(""), "Which type of GPU to use for GPU jobs.\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
+	joboptions["ngpu"] = JobOption("Number of GPU cards to use:", std::string(""), "How many GPU cards of the specified type to use.\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
+
+	joboptions["extrasbatch"] = JobOption("Other sbatch arguments:", std::string(""), "Other arguments to sbatch you want to specify.\n\n\
+Note that the person who installed RELION should have made a custom script for your cluster/queue setup. Check this is the case \
+(or create your own script following the RELION Wiki) if you have trouble submitting jobs. The default command can be set through the environment variable RELION_QSUB_COMMAND.");
 
 	// additional options that may be set through environment variables RELION_QSUB_EXTRAi and RELION_QSUB_EXTRAi (for more flexibility)
 	char * extra_count_text = getenv ("RELION_QSUB_EXTRA_COUNT");
@@ -855,7 +897,7 @@
 Likewise, default values for the extra entries can be set through environment variables RELION_QSUB_EXTRA1_DEFAULT, RELION_QSUB_EXTRA2_DEFAULT, etc. \
 But note that (unlike all other entries in the GUI) the extra values are not remembered from one run to the other.");
 
-	// Check for environment variable RELION_QSUB_TEMPLATE
+	// Check for environment variable RELION_MINIMUM_DEDICATED
 	char * my_minimum_dedicated = getenv ("RELION_MINIMUM_DEDICATED");
 	int minimum_nr_dedicated = (my_minimum_dedicated == NULL) ? DEFAULTMININIMUMDEDICATED : textToInteger(my_minimum_dedicated);
 	joboptions["min_dedicated"] = JobOption("Minimum dedicated cores per node:", minimum_nr_dedicated, 1, 64, 1, "Minimum number of dedicated cores that need to be requested on each node. This is useful to force the queue to fill up entire nodes of a given size. The default can be set through the environment variable RELION_MINIMUM_DEDICATED.");
