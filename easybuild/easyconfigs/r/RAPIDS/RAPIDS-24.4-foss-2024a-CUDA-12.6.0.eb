easyblock = 'PythonBundle'

name = 'RAPIDS'
version = '24.4'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://rapids.ai/'
description = """RAPIDS provides unmatched speed with familiar APIs that match the most popular
PyData libraries. Built on state-of-the-art foundations like NVIDIA CUDA and
Apache Arrow, it unlocks the speed of GPUs with code you already know."""

toolchain = {'name': 'foss', 'version': '2024a'}

builddependencies = [
    ('hatchling', '1.24.2'),
    ('CMake', '3.29.3'),
]
dependencies = [
    ('CUDA', '12.6.0', '', SYSTEM),
    ('cuDNN', '9.5.0.50', '-CUDA-%(cudaver)s', SYSTEM),
    ('NCCL', '2.22.3', '-CUDA-%(cudaver)s'),
    ('Python', '3.12.3'),
    ('CUDA-Python', '12.6.2.post1', '-CUDA-%(cudaver)s'),
    ('Python-bundle-PyPI', '2024.06'),
    ('SciPy-bundle', '2024.05'),
    ('aiohttp', '3.10.10'),
    ('Arrow', '17.0.0'),
    ('dask', '2024.9.1'),
    ('geopandas', '1.0.1'),
    ('jupyter-server-proxy', '4.4.0'),
    ('numba', '0.60.0'),
    ('protobuf-python', '5.28.0'),
    ('pyproj', '3.7.0'),
    ('scikit-image', '0.25.0'),
    ('Shapely', '2.0.6'),
    ('tqdm', '4.66.5'),
    ('xarray', '2024.11.0'),
    ('zarr', '2.18.4'),
]


exts_default_options = {
    'source_tmpl': '%(namelower)s-%(version)s.tar.gz',
    'source_urls': [
        'https://pypi.python.org/packages/source/%(nameletter)s/%(name)s',
        'https://pypi.nvidia.com/%(name)s-cu%(cudamajver)s',
    ],
}

# Key packages are (the rest are dependencies):
# - cudf*
# - cuml*
# - cugraph
# - cufilter
# - cucim
# - cudf
# - cuvs

exts_list = [
    ('cudf', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['adcfd814941a921c29d56a53ae87bf6d97834ac63ea01547f9d9ba7d5e6841bc'],
    }),
    ('dask_cudf', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-any.whl',
        'source_urls': ['https://pypi.nvidia.com/dask-cudf-cu%(cudamajver)s'],
        'checksums': ['771c876cd44f488d50cdd9985237b75f15f8c400c362b17e4d61e936b1e0f55e'],
    }),
    ('cuml', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['233da2f88c4838525a7813b4f93e8161223c90d7c1e520e10fa2f86b8c5055d7'],
    }),
    ('cugraph', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['005fb3bf450587e5470148830119a66268f80d2da18ceb7b0611fad94a115e01'],
    }),
    ('cuxfilter', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-any.whl',
        'checksums': ['f8a6b7d5d5d832a43e4013904d2aae2a59d379481d7e2be265c9b4fd81f9c9ca'],
    }),
    ('cucim', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['7a38b93900c90f5ef774dfd1ba5ceef07d6826c04d291eb33e356c0fd1076427'],
    }),
    ('libcuml', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['e8a85275e4e300e9cd8b49ef07beea1cfc7a461176cfe28f4f991c05e650b22c'],
    }),
    ('nvidia_cublas', '12.9.1.4', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-cublas-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.whl',
        'checksums': ['453611eb21a7c1f2c2156ed9f3a45b691deda0440ec550860290dc901af5b4c2'],
    }),
    ('nvidia_cufft', '11.4.1.4', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-cufft-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux2014_x86_64.manylinux_2_17_x86_64.whl',
        'checksums': ['c67884f2a7d276b4b80eb56a79322a95df592ae5e765cf1243693365ccab4e28']
    }),
    ('nvidia_curand', '10.3.10.19', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-curand-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.whl',
        'checksums': ['49b274db4780d421bd2ccd362e1415c13887c53c214f0d4b761752b8f9f6aa1e']
    }),
    ('nvidia_cusolver', '11.7.5.82', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-cusolver-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.whl',
        'checksums': ['15da72d1340d29b5b3cf3fd100e3cd53421dde36002eda6ed93811af63c40d88'],
    }),
    ('nvidia_cusparse', '12.5.10.65', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-cusparse-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux2014_x86_64.manylinux_2_17_x86_64.whl',
        'checksums': ['73060ce019ac064a057267c585bf1fd5a353734151f87472ff02b2c5c9984e78'],
    }),
    ('pylibcudf', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['cf32e29dcbc3869095c7c65a3d18b6b5f7d3edf19efe5ca67a9c4b716e582e73'],
    }),
    ('libcudf', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_28_x86_64.whl',
        'checksums': ['0106bb2861296985f0cfc2fb9c3052ee093df47d8d112fb06be93cf09ef15df8'],
    }),
    ('pylibraft', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['e29dcb3839556b3a3b22228c2376580da1f0de70292f664861881776458459e0'],
    }),
    ('libraft', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['18f83987860bcb153a73068ee8eaadeab8ff24fd6dbb8aaf6356b2ad7d1cad01'],
    }),
    ('raft_dask', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'source_urls': ['https://pypi.nvidia.com/raft-dask-cu%(cudamajver)s'],
        'checksums': ['9d859cd8f4384fc32b3b1bd690eea03f4f670a89b77fcefa331404c8ee5378d8'],
    }),
    ('distributed_ucxx', '0.45.1', {
        'source_urls': ['https://pypi.nvidia.com/distributed-ucxx-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-any.whl',
        'checksums': ['a0578c40bcb6bdea9d6c9218070d69e30e4284604f451a0598c90d86909805a6'],
    }),
    ('ucxx', '0.45.1', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['a296efcccb194fb01a058e034c72ffa42bbbdc2d9f4796611ffc807e4e1c2ccb'],
    }),
    ('libucxx', '0.45.1', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['07207b65c9af86a8ad89361be08b3f36b00bcc8c38e71f5c4ea887a043774a8d'],
    }),
    ('libucx', '1.18.1', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/%(name)s-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_28_x86_64.whl',
        'checksums': ['d8fa5fc4bd76b2796e083bb3a7fb27373ccd9428daf6fe64d0dfd02fc0c95420'],
    }),
    ('kvikio', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['dbf35716e2f78c5154b8193ab46832660147269e553f9222bf6408e4220c1171'],
    }),
    ('libkvikio', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_28_x86_64.whl',
        'checksums': ['3cf2d41436b15abd9d7a4acb04677b2340620bc684ebc52ca43c3057eb88d40a'],
    }),
    ('nvidia_nccl', '2.27.7', {
        'source_urls': ['https://pypi.nvidia.com/nvidia-nccl-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux2014_x86_64.manylinux_2_17_x86_64.whl',
        'checksums': ['de5ba5562f08029a19cb1cd659404b18411ed0d6c90ac5f52f30bf99ad5809aa'],
    }),
    ('cuvs', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['50f28179fe9259065d28d2f48f155239af27e21b50a0e74b4057b88d3ef84297'],
    }),
    ('libcuvs', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['88f526780b000d3a78098bc138034887327a3edd7c538d7751c3cea2a980b60a'],
    }),
    ('cupy-cuda12x', '13.6.0', {
        'modulename': 'cupy',
        'source_tmpl': 'cupy_cuda%(cudamajver)sx-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux2014_x86_64.whl',
        'checksums': ['79b0cacb5e8b190ef409f9e03f06ac8de1b021b0c0dda47674d446f5557e0eb1'],
    }),
    ('nvtx', '0.2.13', {
        'source_tmpl': '%(name)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_17_x86_64.manylinux2014_x86_64.whl',
        'checksums': ['453d838dd1424a04303281ee57a73e2b8dca0e03039bc609a945861b8fe7d7d9'],
    }),
    ('pynvjitlink-cu12', '0.7.0', {
        'modulename': 'pynvjitlink',
        'source_tmpl': 'pynvjitlink_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['2e6b9aec00ad37647692b030ee545fdb3b701b0a91579a5b9075fbe314c0f9bb'],
    }),
    ('rmm', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['bb58cbced2b84dcaebdf042258b458fa4652ce995d153cf91c5df2f6528ae609'],
    }),
    ('librmm', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['e0cb30ff7fec4cab6355c085f606c9ad57d3be529c81bfc0dc15af69c812f028'],
    }),
    ('rapids_dask_dependency', '25.8.0', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'source_urls': ['https://pypi.nvidia.com/rapids-dask-dependency'],
        'checksums': ['5b5ffc61feb1c6936d761a3c2fdb1ce1eb7ba19cd724913ae0172cd7dff8165c'],
    }),
    ('dask_cuda', '25.8.0', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['05bb6135388e015b9d30840c3ecd40cd0cfb81e45fc320caf124d4726dba9fee'],
    }),
    ('pynvml', '12.0.0', {
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['fdff84b62a27dbe98e08e1a647eb77342bef1aebe0878bcd15e99a83fcbecb9e'],
    }),
    ('nvidia_ml_py', '12.575.51', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-ml-py'],
        'checksums': ['6490e93fea99eb4e966327ae18c6eec6256194c921f23459c8767aee28c54581'],
    }),
    ('ucx_py', '0.45.0', {
        'modulename': 'ucp',
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl',
        'source_urls': ['https://pypi.nvidia.com/ucx-py-cu%(cudamajver)s'],
        'checksums': ['b9c28fb2f363709824d0c971835752d3ada3b102e163985e30db3d62776958e5'],
    }),
    ('nvidia_cuda_nvcc_cu%(cudamajver)s', '12.6.85', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/nvidia-cuda-nvcc-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s-%(version)s-py%(pymajver)s-none-manylinux1_x86_64.manylinux_2_5_x86_64.whl',
        'checksums': ['d75d9d74599f4d7c0865df19ed21b739e6cb77a6497a3f73d6f61e8038a765e4'],
    }),
    ('nvidia_cuda_nvrtc', '12.6.85', {  # https://docs.nvidia.com/cuda/nvrtc/index.html#versioning-scheme
        'source_urls': ['https://pypi.nvidia.com/nvidia-cuda-nvrtc-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux2010_x86_64.manylinux_2_12_x86_64.whl',
        'checksums': ['800927308ccc5dd6246d3f61f7fcef2ed7ec4e59e199090d360d3293f78bd5a2'],
    }),
    ('nvidia_nvjitlink', '12.6.85', {
        'source_urls': ['https://pypi.nvidia.com/nvidia-nvjitlink-cu%(cudamajver)s'],
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux2010_x86_64.manylinux_2_12_x86_64.whl',
        'checksums': ['eedc36df9e88b682efe4309aa16b5b4e78c2407eac59e8c10a6a47535164369a'],
    }),
    ('pylibcugraph', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-cp%(pymajver)s%(pyminver)s-cp%(pymajver)s%(pyminver)s-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['28d7e082875f7a96a58e26f0634184c152dc9f84e5c7716d77c11e1bfeb1e78b'],
    }),
    ('libcugraph', '25.8.0', {
        'source_tmpl': '%(name)s_cu%(cudamajver)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['f013a7d3f8e8577b002e5ef366a6b1d2c0194c6cfcc22bdb9690652a91ed9ac6'],
    }),
    ('numba_cuda', '0.14.1', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/numba-cuda'],
        'checksums': ['2e23bc9f5946e850f21f42cb2dcd24a2cb8ea84b60ad020b6e3b357830a9a697'],
    }),
    ('rapids_logger', '0.1.1', {
        'source_urls': ['https://pypi.python.org/packages/source/%(nameletter)s/%(name)s'],
        'source_tmpl': '%(name)s-%(version)s-py%(pymajver)s-none-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl',
        'checksums': ['222a89befa0f2ad2ed9f5df1bd1fd24dd789f0697f13c431a340583c767f58f3'],
    }),
    ('multipledispatch', '1.0.0', {
        'checksums': ['5c839915465c68206c3e9c473357908216c28383b425361e5d144594bf85a7e0'],
    }),
    ('colorcet', '3.1.0', {
        'checksums': ['2921b3cd81a2288aaf2d63dbc0ce3c26dcd882e8c389cc505d6886bf7aa9a4eb'],
    }),
    ('pyct', '0.5.0', {
        'checksums': ['dd9f4ac5cbd8e37c352c04036062d3c5f67efec76d404761ef16b0cbf26aa6a0'],
    }),
    ('param', '2.1.1', {
        'checksums': ['3b1da14abafa75bfd908572378a58696826b3719a723bc31b40ffff2e9a5c852'],
    }),
    ('datashader', '0.18.2', {
        'checksums': ['53ef0bc35b9ba1034bdf290a2e28babf0fa2b075a3e5a822c79dcde12183d1ff'],
    }),
    ('pyviz_comms', '3.0.6', {  # source install requires node.js
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['4eba6238cd4a7f4add2d11879ce55411785b7d38a7c5dba42c7a0826ca53e6c2'],
    }),
    ('holoviews', '1.20.2', {
        'checksums': ['8c78b798601ce3af31523667c6d1cb40df8d781249ebebbdb2c5f6143565e6d8'],
    }),
    ('uc-micro-py', '1.0.3', {
        'modulename': 'uc_micro',
        'checksums': ['d321b92cff673ec58027c04015fcaa8bb1e005478643ff4a500882eaab88c48a'],
    }),
    ('linkify-it-py', '2.0.3', {
        'modulename': 'linkify_it',
        'checksums': ['68cda27e162e9215c17d786649d1da0021a451bdc436ef9e0fa0ba5234b9b048'],
    }),
    ('Markdown', '3.7', {
        'checksums': ['2ae2471477cfd02dbbf038d5d9bc226d40def84b4fe2986e49b59b6b472bbed2'],
    }),
    ('mdit_py_plugins', '0.5.0', {
        'checksums': ['f4918cb50119f50446560513a8e311d574ff6aaed72606ddae6d35716fe809c6'],
    }),
    ('panel', '1.7.5', {  # source install requires node.js
        'source_tmpl': '%(name)s-%(version)s-py3-none-any.whl',
        'checksums': ['1c3b4a335d56d5aa0cf5d6e1c3684a297e24a62cf99345c5e9eb8552837b97c3'],
    }),
    ('fastrlock', '0.8.3', {
        'checksums': ['4af6734d92eaa3ab4373e6c9a1dd0d5ad1304e172b1521733c6c3b3d73c8fa5d'],
    }),
    ('dask', '2025.7.0', {
        'checksums': ['c3a0d4e78882e85ea81dbc71e6459713e45676e2d17e776c2f3f19848039e4cf'],
    }),
    ('distributed', '2025.7.0', {
        'checksums': ['5f8ec20d3cdfb286452831c6f9ebee84527e9323256c20dd2938d9c6e62c5c18'],
    }),
    ('cachetools', '6.2.0', {
        'checksums': ['38b328c0889450f05f5e120f56ab68c8abaf424e1275522b138ffc93253f7e32'],
    }),
    ('treelite', '4.4.1', {
        'checksums': ['de9c28ff481317d9f4286ea781ba404e2506caa6995cdcb1867a7036124263de'],
    }),
]

# RAPIDS v24.4 only supports GPUs with NVIDIA Volta architecture or newer
# Sanity checks need a physical GPU device

moduleclass = 'ai'
